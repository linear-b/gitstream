<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Implement custom gitStream filter functions with JavaScript."><meta name=author content=LinearB><link href=../plugins-for-developers/ rel=prev><link href=../gitStream-playground/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.1.0"><title>Filter Function Plugin Library - gitStream Documentation</title><link rel=stylesheet href=../assets/stylesheets/main.402914a4.min.css><link rel=stylesheet href=../assets/stylesheets/palette.a0c5b2b5.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../stylesheets/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-WE4YLK8TT5"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-WE4YLK8TT5",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-WE4YLK8TT5",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#filter-function-plugin-library class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="gitStream Documentation" class="md-header__button md-logo" aria-label="gitStream Documentation" data-md-component=logo> <img src=../assets/gitstream-w.webp alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> gitStream Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Filter Function Plugin Library </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary data-md-color-accent aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary data-md-color-accent aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/linear-b/gitstream title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> linear-b/gitstream </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="gitStream Documentation" class="md-nav__button md-logo" aria-label="gitStream Documentation" data-md-component=logo> <img src=../assets/gitstream-w.webp alt=logo> </a> gitStream Documentation </label> <div class=md-nav__source> <a href=https://github.com/linear-b/gitstream title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> linear-b/gitstream </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Overview </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> Guide <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../github-installation/ class=md-nav__link> GitHub Setup </a> </li> <li class=md-nav__item> <a href=../custom-github-app/ class=md-nav__link> GitHub Server (Custom App) </a> </li> <li class=md-nav__item> <a href=../gitlab-installation/ class=md-nav__link> GitLab Setup </a> </li> <li class=md-nav__item> <a href=../bitbucket-installation/ class=md-nav__link> Bitbucket Cloud Setup </a> </li> <li class=md-nav__item> <a href=../managed-mode/ class=md-nav__link> Managed Mode </a> </li> <li class=md-nav__item> <a href=../how-it-works/ class=md-nav__link> How gitStream works </a> </li> <li class=md-nav__item> <a href=../quick-start/ class=md-nav__link> Your First Automation </a> </li> <li class=md-nav__item> <a href=../dry-run-mode/ class=md-nav__link> How to Test Your Automations </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../examples/ class=md-nav__link> Quickstart </a> </li> <li class=md-nav__item> <a href=../automations/automation-library/ class=md-nav__link> Automation Library </a> </li> <li class=md-nav__item> <a href=../integrations/ class=md-nav__link> Integrations </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> Reference <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../cm-file/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../execution-model/ class=md-nav__link> Trigger Control </a> </li> <li class=md-nav__item> <a href=../limits/ class=md-nav__link> Automation Limits </a> </li> <li class=md-nav__item> <a href=../context-variables/ class=md-nav__link> Context variables </a> </li> <li class=md-nav__item> <a href=../filter-functions/ class=md-nav__link> Filter functions </a> </li> <li class=md-nav__item> <a href=../automation-actions/ class=md-nav__link> Automation actions </a> </li> <li class=md-nav__item> <a href=../user-commands/ class=md-nav__link> User commands </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7 checked> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> Plugins <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=true> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Plugins </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../plugins/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../plugins-for-developers/ class=md-nav__link> Plugins Development </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Filter Functions Plugins List <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Filter Functions Plugins List </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#askai class=md-nav__link> askAI </a> </li> <li class=md-nav__item> <a href=#checklist class=md-nav__link> checklist </a> </li> <li class=md-nav__item> <a href=#comparemultisemver class=md-nav__link> compareMultiSemver </a> </li> <li class=md-nav__item> <a href=#comparesemver class=md-nav__link> compareSemver </a> </li> <li class=md-nav__item> <a href=#extractdependabotversionbump class=md-nav__link> extractDependabotVersionBump </a> </li> <li class=md-nav__item> <a href=#extractrenovateversionbump class=md-nav__link> extractRenovateVersionBump </a> </li> <li class=md-nav__item> <a href=#extractsnykversionbump class=md-nav__link> extractSnykVersionBump </a> </li> <li class=md-nav__item> <a href=#extractorcafindings class=md-nav__link> extractOrcaFindings </a> </li> <li class=md-nav__item> <a href=#generatedescription class=md-nav__link> generateDescription </a> </li> <li class=md-nav__item> <a href=#getcodeowners class=md-nav__link> getCodeowners </a> </li> <li class=md-nav__item> <a href=#hasjiraissue class=md-nav__link> hasJiraIssue </a> </li> <li class=md-nav__item> <a href=#isflaggeduser class=md-nav__link> isFlaggedUser </a> </li> <li class=md-nav__item> <a href=#readmarkdownwithlinks class=md-nav__link> readMarkdownWithLinks </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../gitStream-playground/ class=md-nav__link> Playground </a> </li> <li class=md-nav__item> <a href=../troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../faq/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=https://app.gitstream.cm/login class=md-nav__link> Login </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#askai class=md-nav__link> askAI </a> </li> <li class=md-nav__item> <a href=#checklist class=md-nav__link> checklist </a> </li> <li class=md-nav__item> <a href=#comparemultisemver class=md-nav__link> compareMultiSemver </a> </li> <li class=md-nav__item> <a href=#comparesemver class=md-nav__link> compareSemver </a> </li> <li class=md-nav__item> <a href=#extractdependabotversionbump class=md-nav__link> extractDependabotVersionBump </a> </li> <li class=md-nav__item> <a href=#extractrenovateversionbump class=md-nav__link> extractRenovateVersionBump </a> </li> <li class=md-nav__item> <a href=#extractsnykversionbump class=md-nav__link> extractSnykVersionBump </a> </li> <li class=md-nav__item> <a href=#extractorcafindings class=md-nav__link> extractOrcaFindings </a> </li> <li class=md-nav__item> <a href=#generatedescription class=md-nav__link> generateDescription </a> </li> <li class=md-nav__item> <a href=#getcodeowners class=md-nav__link> getCodeowners </a> </li> <li class=md-nav__item> <a href=#hasjiraissue class=md-nav__link> hasJiraIssue </a> </li> <li class=md-nav__item> <a href=#isflaggeduser class=md-nav__link> isFlaggedUser </a> </li> <li class=md-nav__item> <a href=#readmarkdownwithlinks class=md-nav__link> readMarkdownWithLinks </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/linear-b/gitstream/edit/main/docs/filter-function-plugins.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <h1 id=filter-function-plugin-library>Filter Function Plugin Library</h1> <p>JavaScript plugins that enable custom filter functions for gitStream. To learn how to use these examples, read our <a href=/plugins>guide on how to use gitStream plugins</a>.</p> <p><a name=module_generateDescription></a></p> <h2 id=askai>askAI</h2> <p>The AskAI plugin allows gitStream workflows to interact with external AI services, enabling advanced automation capabilities such as code analysis, test case generation, and PR summarization. This plugin requires a valid API token for the AI service, which must be securely provided as an environment variable.</p> <div class="admonition note"> <p class=admonition-title>Security note</p> <p>The <code>AskAI</code> plugin integrates with an external AI model and requires your API token for authorization. Ensure you provide a valid token through the <code>env.OPEN_AI_TOKEN</code> parameter or similar configuration. This may also incur API costs.</p> <p>When using the <code>AskAI</code> plugin, the provided <strong>context</strong> and <strong>prompt</strong> will be shared with the configured AI service. <strong>Ensure that no sensitive or proprietary information is included unless your organization's policies permit it</strong>. </p> </div> <p><img alt="Example PR description" src=../screenshots/askAI-describe-PR.png></p> <p><strong>Returns</strong>: <code>Object</code> - Returns the AI-generated response based on the provided context and prompt. <strong>License</strong>: MIT</p> <table> <thead> <tr> <th>Param</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>context</td> <td><code>Object</code></td> <td>The context that needs to be sent to the AI model for analysis.</td> </tr> <tr> <td>role</td> <td><code>string</code></td> <td>Free text. If not empty, Defines the role or persona for the AI to adopt while generating the response.</td> </tr> <tr> <td>prompt</td> <td><code>string</code></td> <td>The specific request or question you want the AI to respond to, after the context has been provided.</td> </tr> <tr> <td>token</td> <td><code>Object</code></td> <td>The token to the AI model</td> </tr> </tbody> </table> <p><strong>Example</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class="p p-Indicator">{{</span><span class=w> </span><span class=nv>source | askAI(&quot;QA tester&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;Based</span><span class=nv> </span><span class=s>on</span><span class=nv> </span><span class=s>the</span><span class=nv> </span><span class=s>given</span><span class=nv> </span><span class=s>context,</span><span class=nv> </span><span class=s>search</span><span class=nv> </span><span class=s>for</span><span class=nv> </span><span class=s>new</span><span class=nv> </span><span class=s>functions</span><span class=nv> </span><span class=s>without</span><span class=nv> </span><span class=s>tests</span><span class=nv> </span><span class=s>and</span><span class=nv> </span><span class=s>suggest</span><span class=nv> </span><span class=s>the</span><span class=nv> </span><span class=s>tests</span><span class=nv> </span><span class=s>to</span><span class=nv> </span><span class=s>add.</span><span class=err>Â </span><span class=s>If</span><span class=nv> </span><span class=s>all</span><span class=nv> </span><span class=s>functions</span><span class=nv> </span><span class=s>are</span><span class=nv> </span><span class=s>covered</span><span class=nv> </span><span class=s>completely,</span><span class=nv> </span><span class=s>return</span><span class=nv> </span><span class=s>&#39;no</span><span class=nv> </span><span class=s>tests</span><span class=nv> </span><span class=s>to</span><span class=nv> </span><span class=s>suggest.&#39;&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>env.OPEN_AI_TOKEN)</span><span class=w> </span><span class="p p-Indicator">}}</span>
</code></pre></div> <details class=note> <summary>Plugin Code: askAI</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=cm>/**</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=cm> * @module askAI</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=cm> * @description A gitStream plugin to interact with AI models. Currently works with `ChatGPR-4o-mini`.</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=cm> * @param {Object} context - The context that will be attached to the prompt .</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=cm> * @param {string} role - Role instructions for the conversation.</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=cm> * @param {string} prompt - The prompt string.</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=cm> * @param {Object} token - The token to the AI model.</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=cm> * @returns {Object} Returns the response from the AI model.</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=cm> * @example {{ branch | generateDescription(pr, repo, source) }}</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=cm> * @license MIT</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=cm> * */</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=kd>const</span><span class=w> </span><span class=nx>MAX_TOKENS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>4096</span><span class=p>;</span>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=kd>const</span><span class=w> </span><span class=nx>OPEN_AI_ENDPOINT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;https://api.openai.com/v1/chat/completions&#39;</span><span class=p>;</span>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=kd>const</span><span class=w> </span><span class=nx>LOCK_FILES</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=w>  </span><span class=s1>&#39;package-lock.json&#39;</span><span class=p>,</span>
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=w>  </span><span class=s1>&#39;yarn.lock&#39;</span><span class=p>,</span>
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=w>  </span><span class=s1>&#39;npm-shrinkwrap.json&#39;</span><span class=p>,</span>
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=w>  </span><span class=s1>&#39;Pipfile.lock&#39;</span><span class=p>,</span>
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=w>  </span><span class=s1>&#39;poetry.lock&#39;</span><span class=p>,</span>
<a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=w>  </span><span class=s1>&#39;conda-lock.yml&#39;</span><span class=p>,</span>
<a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=w>  </span><span class=s1>&#39;Gemfile.lock&#39;</span><span class=p>,</span>
<a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=w>  </span><span class=s1>&#39;composer.lock&#39;</span><span class=p>,</span>
<a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=w>  </span><span class=s1>&#39;packages.lock.json&#39;</span><span class=p>,</span>
<a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a><span class=w>  </span><span class=s1>&#39;project.assets.json&#39;</span><span class=p>,</span>
<a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=w>  </span><span class=s1>&#39;pom.xml&#39;</span><span class=p>,</span>
<a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a><span class=w>  </span><span class=s1>&#39;Cargo.lock&#39;</span><span class=p>,</span>
<a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a><span class=w>  </span><span class=s1>&#39;mix.lock&#39;</span><span class=p>,</span>
<a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a><span class=w>  </span><span class=s1>&#39;pubspec.lock&#39;</span><span class=p>,</span>
<a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a><span class=w>  </span><span class=s1>&#39;go.sum&#39;</span><span class=p>,</span>
<a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a><span class=w>  </span><span class=s1>&#39;stack.yaml.lock&#39;</span><span class=p>,</span>
<a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a><span class=w>  </span><span class=s1>&#39;vcpkg.json&#39;</span><span class=p>,</span>
<a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a><span class=w>  </span><span class=s1>&#39;conan.lock&#39;</span><span class=p>,</span>
<a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a><span class=w>  </span><span class=s1>&#39;ivy.xml&#39;</span><span class=p>,</span>
<a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a><span class=w>  </span><span class=s1>&#39;project.clj&#39;</span><span class=p>,</span>
<a id=__codelineno-1-36 name=__codelineno-1-36 href=#__codelineno-1-36></a><span class=w>  </span><span class=s1>&#39;Podfile.lock&#39;</span><span class=p>,</span>
<a id=__codelineno-1-37 name=__codelineno-1-37 href=#__codelineno-1-37></a><span class=w>  </span><span class=s1>&#39;Cartfile.resolved&#39;</span><span class=p>,</span>
<a id=__codelineno-1-38 name=__codelineno-1-38 href=#__codelineno-1-38></a><span class=w>  </span><span class=s1>&#39;flake.lock&#39;</span><span class=p>,</span>
<a id=__codelineno-1-39 name=__codelineno-1-39 href=#__codelineno-1-39></a><span class=w>  </span><span class=s1>&#39;pnpm-lock.yaml&#39;</span><span class=p>,</span>
<a id=__codelineno-1-40 name=__codelineno-1-40 href=#__codelineno-1-40></a><span class=w>  </span><span class=s1>&#39;uv.lock&#39;</span>
<a id=__codelineno-1-41 name=__codelineno-1-41 href=#__codelineno-1-41></a><span class=p>];</span>
<a id=__codelineno-1-42 name=__codelineno-1-42 href=#__codelineno-1-42></a><span class=kd>const</span><span class=w> </span><span class=nx>EXCLUDE_EXPRESSIONS_LIST</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
<a id=__codelineno-1-43 name=__codelineno-1-43 href=#__codelineno-1-43></a><span class=w>  </span><span class=s1>&#39;.*\\.(ini|csv|xls|xlsx|xlr|doc|docx|txt|pps|ppt|pptx|dot|dotx|log|tar|rtf|dat|ipynb|po|profile|object|obj|dxf|twb|bcsymbolmap|tfstate|pdf|rbi|pem|crt|svg|png|jpeg|jpg|ttf)$&#39;</span><span class=p>,</span>
<a id=__codelineno-1-44 name=__codelineno-1-44 href=#__codelineno-1-44></a><span class=w>  </span><span class=s1>&#39;.*(package-lock|packages\\.lock|package)\\.json$&#39;</span><span class=p>,</span>
<a id=__codelineno-1-45 name=__codelineno-1-45 href=#__codelineno-1-45></a><span class=w>  </span><span class=s1>&#39;.*(yarn|gemfile|podfile|cargo|composer|pipfile|gopkg)\\.lock$&#39;</span><span class=p>,</span>
<a id=__codelineno-1-46 name=__codelineno-1-46 href=#__codelineno-1-46></a><span class=w>  </span><span class=s1>&#39;.*gradle\\.lockfile$&#39;</span><span class=p>,</span>
<a id=__codelineno-1-47 name=__codelineno-1-47 href=#__codelineno-1-47></a><span class=w>  </span><span class=s1>&#39;.*lock\\.sbt$&#39;</span><span class=p>,</span>
<a id=__codelineno-1-48 name=__codelineno-1-48 href=#__codelineno-1-48></a><span class=w>  </span><span class=s1>&#39;.*dist/.*\\.js&#39;</span><span class=p>,</span>
<a id=__codelineno-1-49 name=__codelineno-1-49 href=#__codelineno-1-49></a><span class=w>  </span><span class=s1>&#39;.*public/assets/.*\\.js&#39;</span><span class=p>,</span>
<a id=__codelineno-1-50 name=__codelineno-1-50 href=#__codelineno-1-50></a><span class=w>  </span><span class=s1>&#39;.*ci\\.yml$&#39;</span>
<a id=__codelineno-1-51 name=__codelineno-1-51 href=#__codelineno-1-51></a><span class=p>];</span>
<a id=__codelineno-1-52 name=__codelineno-1-52 href=#__codelineno-1-52></a><span class=kd>const</span><span class=w> </span><span class=nx>IGNORE_FILES_REGEX_LIST</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
<a id=__codelineno-1-53 name=__codelineno-1-53 href=#__codelineno-1-53></a><span class=w>  </span><span class=p>...</span><span class=nx>LOCK_FILES</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>f</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>f</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;\\.&#39;</span><span class=p>)),</span>
<a id=__codelineno-1-54 name=__codelineno-1-54 href=#__codelineno-1-54></a><span class=w>  </span><span class=p>...</span><span class=nx>EXCLUDE_EXPRESSIONS_LIST</span>
<a id=__codelineno-1-55 name=__codelineno-1-55 href=#__codelineno-1-55></a><span class=p>];</span>
<a id=__codelineno-1-56 name=__codelineno-1-56 href=#__codelineno-1-56></a><span class=kd>const</span><span class=w> </span><span class=nx>EXCLUDE_PATTERN</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>RegExp</span><span class=p>(</span><span class=nx>IGNORE_FILES_REGEX_LIST</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=s1>&#39;|&#39;</span><span class=p>));</span>
<a id=__codelineno-1-57 name=__codelineno-1-57 href=#__codelineno-1-57></a>
<a id=__codelineno-1-58 name=__codelineno-1-58 href=#__codelineno-1-58></a><span class=cm>/**</span>
<a id=__codelineno-1-59 name=__codelineno-1-59 href=#__codelineno-1-59></a><span class=cm> * @description Check if a file should be excluded from the context like &quot;package-lock.json&quot;</span>
<a id=__codelineno-1-60 name=__codelineno-1-60 href=#__codelineno-1-60></a><span class=cm> * @param {*} fileObject</span>
<a id=__codelineno-1-61 name=__codelineno-1-61 href=#__codelineno-1-61></a><span class=cm> * @returns returns true if the file should be excluded</span>
<a id=__codelineno-1-62 name=__codelineno-1-62 href=#__codelineno-1-62></a><span class=cm> */</span>
<a id=__codelineno-1-63 name=__codelineno-1-63 href=#__codelineno-1-63></a><span class=kd>const</span><span class=w> </span><span class=nx>shouldExcludeFile</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>fileObject</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-64 name=__codelineno-1-64 href=#__codelineno-1-64></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>shouldExludeByName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>EXCLUDE_PATTERN</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>fileObject</span><span class=p>.</span><span class=nx>original_file</span><span class=p>);</span>
<a id=__codelineno-1-65 name=__codelineno-1-65 href=#__codelineno-1-65></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>shouldExludeBySize</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>fileObject</span><span class=p>.</span><span class=nx>diff</span><span class=o>?</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>).</span><span class=nx>length</span><span class=w> </span><span class=o>??</span><span class=w> </span><span class=mf>0</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>1000</span><span class=p>;</span>
<a id=__codelineno-1-66 name=__codelineno-1-66 href=#__codelineno-1-66></a>
<a id=__codelineno-1-67 name=__codelineno-1-67 href=#__codelineno-1-67></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>shouldExludeByName</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nx>shouldExludeBySize</span><span class=p>;</span>
<a id=__codelineno-1-68 name=__codelineno-1-68 href=#__codelineno-1-68></a><span class=p>};</span>
<a id=__codelineno-1-69 name=__codelineno-1-69 href=#__codelineno-1-69></a>
<a id=__codelineno-1-70 name=__codelineno-1-70 href=#__codelineno-1-70></a><span class=cm>/**</span>
<a id=__codelineno-1-71 name=__codelineno-1-71 href=#__codelineno-1-71></a><span class=cm> * @description Check if a file should be included in the context</span>
<a id=__codelineno-1-72 name=__codelineno-1-72 href=#__codelineno-1-72></a><span class=cm> * @param {*} fileObject</span>
<a id=__codelineno-1-73 name=__codelineno-1-73 href=#__codelineno-1-73></a><span class=cm> * @returns returns true if the file should be included</span>
<a id=__codelineno-1-74 name=__codelineno-1-74 href=#__codelineno-1-74></a><span class=cm> */</span>
<a id=__codelineno-1-75 name=__codelineno-1-75 href=#__codelineno-1-75></a><span class=kd>const</span><span class=w> </span><span class=nx>shouldIncludeFile</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>fileObject</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-76 name=__codelineno-1-76 href=#__codelineno-1-76></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=o>!</span><span class=nx>shouldExcludeFile</span><span class=p>(</span><span class=nx>fileObject</span><span class=p>);</span>
<a id=__codelineno-1-77 name=__codelineno-1-77 href=#__codelineno-1-77></a><span class=p>};</span>
<a id=__codelineno-1-78 name=__codelineno-1-78 href=#__codelineno-1-78></a>
<a id=__codelineno-1-79 name=__codelineno-1-79 href=#__codelineno-1-79></a><span class=kd>const</span><span class=w> </span><span class=nx>buildContextForGPT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>context</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-80 name=__codelineno-1-80 href=#__codelineno-1-80></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nb>Array</span><span class=p>.</span><span class=nx>isArray</span><span class=p>(</span><span class=nx>context</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-81 name=__codelineno-1-81 href=#__codelineno-1-81></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>element</span><span class=w> </span><span class=p>=&gt;</span>
<a id=__codelineno-1-82 name=__codelineno-1-82 href=#__codelineno-1-82></a><span class=w>      </span><span class=ow>typeof</span><span class=w> </span><span class=nx>element</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=s1>&#39;object&#39;</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>shouldIncludeFile</span><span class=p>)</span>
<a id=__codelineno-1-83 name=__codelineno-1-83 href=#__codelineno-1-83></a><span class=w>    </span><span class=p>);</span>
<a id=__codelineno-1-84 name=__codelineno-1-84 href=#__codelineno-1-84></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-1-85 name=__codelineno-1-85 href=#__codelineno-1-85></a>
<a id=__codelineno-1-86 name=__codelineno-1-86 href=#__codelineno-1-86></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>context</span><span class=o>?</span><span class=p>.</span><span class=nx>diff</span><span class=o>?</span><span class=p>.</span><span class=nx>files</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-87 name=__codelineno-1-87 href=#__codelineno-1-87></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>files</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>diff</span><span class=p>.</span><span class=nx>files</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>shouldIncludeFile</span><span class=p>);</span>
<a id=__codelineno-1-88 name=__codelineno-1-88 href=#__codelineno-1-88></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>files</span><span class=p>;</span>
<a id=__codelineno-1-89 name=__codelineno-1-89 href=#__codelineno-1-89></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-1-90 name=__codelineno-1-90 href=#__codelineno-1-90></a>
<a id=__codelineno-1-91 name=__codelineno-1-91 href=#__codelineno-1-91></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>context</span><span class=p>;</span>
<a id=__codelineno-1-92 name=__codelineno-1-92 href=#__codelineno-1-92></a><span class=p>};</span>
<a id=__codelineno-1-93 name=__codelineno-1-93 href=#__codelineno-1-93></a>
<a id=__codelineno-1-94 name=__codelineno-1-94 href=#__codelineno-1-94></a><span class=kd>const</span><span class=w> </span><span class=nx>askAI</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>(</span><span class=nx>context</span><span class=p>,</span><span class=w> </span><span class=nx>role</span><span class=p>,</span><span class=w> </span><span class=nx>prompt</span><span class=p>,</span><span class=w> </span><span class=nx>token</span><span class=p>,</span><span class=w> </span><span class=nx>callback</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-95 name=__codelineno-1-95 href=#__codelineno-1-95></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>formattedContext</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>buildContextForGPT</span><span class=p>(</span><span class=nx>context</span><span class=p>);</span>
<a id=__codelineno-1-96 name=__codelineno-1-96 href=#__codelineno-1-96></a>
<a id=__codelineno-1-97 name=__codelineno-1-97 href=#__codelineno-1-97></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>formattedContext</span><span class=o>?</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-98 name=__codelineno-1-98 href=#__codelineno-1-98></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sb>`There are no context files to analyze.\nAll </span><span class=si>${</span><span class=nx>context</span><span class=o>?</span><span class=p>.</span><span class=nx>diff</span><span class=o>?</span><span class=p>.</span><span class=nx>files</span><span class=o>?</span><span class=p>.</span><span class=nx>length</span><span class=si>}</span><span class=sb> files were excluded by pattern or size.`</span><span class=p>;</span>
<a id=__codelineno-1-99 name=__codelineno-1-99 href=#__codelineno-1-99></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>message</span><span class=p>);</span>
<a id=__codelineno-1-100 name=__codelineno-1-100 href=#__codelineno-1-100></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>callback</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=nx>message</span><span class=p>);</span>
<a id=__codelineno-1-101 name=__codelineno-1-101 href=#__codelineno-1-101></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-1-102 name=__codelineno-1-102 href=#__codelineno-1-102></a>
<a id=__codelineno-1-103 name=__codelineno-1-103 href=#__codelineno-1-103></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>fetch</span><span class=p>(</span><span class=nx>OPEN_AI_ENDPOINT</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-104 name=__codelineno-1-104 href=#__codelineno-1-104></a><span class=w>    </span><span class=nx>method</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;POST&#39;</span><span class=p>,</span>
<a id=__codelineno-1-105 name=__codelineno-1-105 href=#__codelineno-1-105></a><span class=w>    </span><span class=nx>headers</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-106 name=__codelineno-1-106 href=#__codelineno-1-106></a><span class=w>      </span><span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;application/json&#39;</span><span class=p>,</span>
<a id=__codelineno-1-107 name=__codelineno-1-107 href=#__codelineno-1-107></a><span class=w>      </span><span class=nx>Authorization</span><span class=o>:</span><span class=w> </span><span class=sb>`Bearer </span><span class=si>${</span><span class=nx>token</span><span class=si>}</span><span class=sb>`</span>
<a id=__codelineno-1-108 name=__codelineno-1-108 href=#__codelineno-1-108></a><span class=w>    </span><span class=p>},</span>
<a id=__codelineno-1-109 name=__codelineno-1-109 href=#__codelineno-1-109></a><span class=w>    </span><span class=nx>body</span><span class=o>:</span><span class=w> </span><span class=nb>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
<a id=__codelineno-1-110 name=__codelineno-1-110 href=#__codelineno-1-110></a><span class=w>      </span><span class=nx>model</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;gpt-4o-2024-08-06&#39;</span><span class=p>,</span>
<a id=__codelineno-1-111 name=__codelineno-1-111 href=#__codelineno-1-111></a><span class=w>      </span><span class=nx>messages</span><span class=o>:</span><span class=w> </span><span class=p>[</span>
<a id=__codelineno-1-112 name=__codelineno-1-112 href=#__codelineno-1-112></a><span class=w>        </span><span class=p>{</span>
<a id=__codelineno-1-113 name=__codelineno-1-113 href=#__codelineno-1-113></a><span class=w>          </span><span class=nx>role</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;system&#39;</span><span class=p>,</span>
<a id=__codelineno-1-114 name=__codelineno-1-114 href=#__codelineno-1-114></a><span class=w>          </span><span class=nx>content</span><span class=o>:</span><span class=w> </span><span class=sb>`You are a </span><span class=si>${</span><span class=nx>role</span><span class=si>}</span><span class=sb>. Answer only to the request, without any introductory or conclusion text.`</span>
<a id=__codelineno-1-115 name=__codelineno-1-115 href=#__codelineno-1-115></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-1-116 name=__codelineno-1-116 href=#__codelineno-1-116></a><span class=w>        </span><span class=p>{</span>
<a id=__codelineno-1-117 name=__codelineno-1-117 href=#__codelineno-1-117></a><span class=w>          </span><span class=nx>role</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;user&#39;</span><span class=p>,</span>
<a id=__codelineno-1-118 name=__codelineno-1-118 href=#__codelineno-1-118></a><span class=w>          </span><span class=nx>content</span><span class=o>:</span><span class=w> </span><span class=nb>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>formattedContext</span><span class=p>)</span>
<a id=__codelineno-1-119 name=__codelineno-1-119 href=#__codelineno-1-119></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-1-120 name=__codelineno-1-120 href=#__codelineno-1-120></a><span class=w>        </span><span class=p>{</span><span class=w> </span><span class=nx>role</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;user&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=o>:</span><span class=w> </span><span class=nx>prompt</span><span class=w> </span><span class=p>}</span>
<a id=__codelineno-1-121 name=__codelineno-1-121 href=#__codelineno-1-121></a><span class=w>      </span><span class=p>],</span>
<a id=__codelineno-1-122 name=__codelineno-1-122 href=#__codelineno-1-122></a><span class=w>      </span><span class=nx>max_tokens</span><span class=o>:</span><span class=w> </span><span class=nx>MAX_TOKENS</span>
<a id=__codelineno-1-123 name=__codelineno-1-123 href=#__codelineno-1-123></a><span class=w>    </span><span class=p>})</span>
<a id=__codelineno-1-124 name=__codelineno-1-124 href=#__codelineno-1-124></a><span class=w>  </span><span class=p>});</span>
<a id=__codelineno-1-125 name=__codelineno-1-125 href=#__codelineno-1-125></a>
<a id=__codelineno-1-126 name=__codelineno-1-126 href=#__codelineno-1-126></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
<a id=__codelineno-1-127 name=__codelineno-1-127 href=#__codelineno-1-127></a>
<a id=__codelineno-1-128 name=__codelineno-1-128 href=#__codelineno-1-128></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>data</span><span class=o>?</span><span class=p>.</span><span class=nx>error</span><span class=o>?</span><span class=p>.</span><span class=nx>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-129 name=__codelineno-1-129 href=#__codelineno-1-129></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
<a id=__codelineno-1-130 name=__codelineno-1-130 href=#__codelineno-1-130></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>callback</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
<a id=__codelineno-1-131 name=__codelineno-1-131 href=#__codelineno-1-131></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-1-132 name=__codelineno-1-132 href=#__codelineno-1-132></a>
<a id=__codelineno-1-133 name=__codelineno-1-133 href=#__codelineno-1-133></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>suggestion</span><span class=w> </span><span class=o>=</span>
<a id=__codelineno-1-134 name=__codelineno-1-134 href=#__codelineno-1-134></a><span class=w>    </span><span class=nx>data</span><span class=p>.</span><span class=nx>choices</span><span class=o>?</span><span class=p>.[</span><span class=mf>0</span><span class=p>]</span><span class=o>?</span><span class=p>.</span><span class=nx>message</span><span class=o>?</span><span class=p>.</span><span class=nx>content</span><span class=w> </span><span class=o>??</span>
<a id=__codelineno-1-135 name=__codelineno-1-135 href=#__codelineno-1-135></a><span class=w>    </span><span class=s1>&#39;context was too big for api, try with smaller context object&#39;</span><span class=p>;</span>
<a id=__codelineno-1-136 name=__codelineno-1-136 href=#__codelineno-1-136></a>
<a id=__codelineno-1-137 name=__codelineno-1-137 href=#__codelineno-1-137></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>callback</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=nx>suggestion</span><span class=p>);</span>
<a id=__codelineno-1-138 name=__codelineno-1-138 href=#__codelineno-1-138></a><span class=p>};</span>
<a id=__codelineno-1-139 name=__codelineno-1-139 href=#__codelineno-1-139></a>
<a id=__codelineno-1-140 name=__codelineno-1-140 href=#__codelineno-1-140></a><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-141 name=__codelineno-1-141 href=#__codelineno-1-141></a><span class=w>  </span><span class=k>async</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-1-142 name=__codelineno-1-142 href=#__codelineno-1-142></a><span class=w>  </span><span class=nx>filter</span><span class=o>:</span><span class=w> </span><span class=nx>askAI</span>
<a id=__codelineno-1-143 name=__codelineno-1-143 href=#__codelineno-1-143></a><span class=p>};</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <details class=example> <summary>gitStream CM Example: askAI</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=nt>triggers</span><span class=p>:</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=w>  </span><span class=nt>exclude</span><span class=p>:</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=w>    </span><span class=nt>branch</span><span class=p>:</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">r/dependabot/</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=nt>automations</span><span class=p>:</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=w>  </span><span class=nt>generate_pr_desc_on_new_pr</span><span class=p>:</span>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=w>    </span><span class=nt>on</span><span class=p>:</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">pr_created</span>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=w>    </span><span class=nt>if</span><span class=p>:</span>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">add-comment@v1</span>
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=w>          </span><span class=nt>comment</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a><span class=w>            </span><span class=cp>{{</span> <span class=nv>source</span> <span class=o>|</span> <span class=nf>askAI</span><span class=o>(</span><span class=s2>&quot;Experienced developer&quot;</span><span class=o>,</span> <span class=s2>&quot;Summarize in simple terms the changes in this PR using bullet points.&quot;</span><span class=o>,</span> <span class=nv>env.OPEN_AI_TOKEN</span><span class=o>)</span> <span class=cp>}}</span>
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a><span class=w>  </span><span class=nt>generate_pr_desc_on_ask_ai_label</span><span class=p>:</span>
<a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a><span class=w>    </span><span class=nt>on</span><span class=p>:</span>
<a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">label_added</span>
<a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a><span class=w>    </span><span class=nt>if</span><span class=p>:</span>
<a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=nv>pr.labels</span> <span class=o>|</span> <span class=nf>match</span><span class=o>(</span><span class=nv>term</span><span class=o>=</span><span class=s2>&quot;/ask-ai qa&quot;</span><span class=o>)</span> <span class=o>|</span> <span class=nf>some</span> <span class=cp>}}</span>
<a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span>
<a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">add-comment@v1</span>
<a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a><span class=w>          </span><span class=nt>comment</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a><span class=w>            </span><span class=cp>{{</span> <span class=nv>source</span> <span class=o>|</span> <span class=nf>askAI</span><span class=o>(</span><span class=s2>&quot;qa tester&quot;</span><span class=o>,</span> <span class=s2>&quot;Based on the given context, search for new functions without tests and suggest the tests to add.Â If all functions are covered completely, return &#39;no tests to suggest.&#39;&quot;</span><span class=o>,</span> <span class=nv>env.OPEN_AI_TOKEN</span><span class=o>)</span> <span class=cp>}}</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <p><a href=https://github.com/linear-b/gitstream/tree/main/plugins/filters/askAI>Download Source Code</a></p> <p><a name=module_checklist></a></p> <h2 id=checklist>checklist</h2> <p>Automatically check PRs against a checklist of conditions. This is useful if you want to ensure that PRs meet certain criteria before they can be merged.</p> <p><strong>Returns</strong>: <code>string</code> - Returns a formatted GitHub comment with a checklist of conditions that the PR meets.<br> <strong>License</strong>: MIT </p> <table> <thead> <tr> <th>Param</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>Input</td> <td><code>string</code></td> <td>A blank string (no input variable is required)</td> </tr> <tr> <td>branch</td> <td><code>object</code></td> <td>The branch context variable.</td> </tr> <tr> <td>files</td> <td><code>object</code></td> <td>The files context variable.</td> </tr> <tr> <td>pr</td> <td><code>object</code></td> <td>The pr context variable.</td> </tr> <tr> <td>repo</td> <td><code>object</code></td> <td>The repo context variable.</td> </tr> <tr> <td>env</td> <td><code>object</code></td> <td>The env context variable.</td> </tr> <tr> <td>source</td> <td><code>object</code></td> <td>The source context variable.</td> </tr> </tbody> </table> <p><strong>Example</strong><br> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=o>-</span><span class=w> </span><span class=nx>action</span><span class=o>:</span><span class=w> </span><span class=nx>add</span><span class=o>-</span><span class=nx>comment</span><span class=err>@</span><span class=nx>v1</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=w>        </span><span class=nx>args</span><span class=o>:</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=w>            </span><span class=nx>comment</span><span class=o>:</span><span class=w> </span><span class=p>{{</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=nx>checklist</span><span class=p>(</span><span class=nx>branch</span><span class=p>,</span><span class=w> </span><span class=nx>files</span><span class=p>,</span><span class=w> </span><span class=nx>pr</span><span class=p>,</span><span class=w> </span><span class=nx>repo</span><span class=p>,</span><span class=w> </span><span class=nx>env</span><span class=p>,</span><span class=w> </span><span class=nx>source</span><span class=p>)</span><span class=w> </span><span class=p>}}</span>
</code></pre></div></p> <p>With this plugin, you can easily customize the checklist using the object in the JavaScript code. To add a new check to the list, just add a new object with a descriptive <code>title</code> for your own benefit, a <code>label</code> that'll get posted in the comment, and the <code>condition</code> that, if true, would cause the entry in the checklist to be checked off.</p> <details class=note> <summary>Plugin Code: checklist</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=cm>/**</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=cm> * @module checklist</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=cm> * @description Automatically check PRs against a checklist of conditions.</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=cm> * This is useful if you want to ensure that PRs meet certain criteria before they can be merged. </span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=cm> * @param {string} Input - A blank string (no input variable is required)</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=cm> * @param {object} branch - The branch context variable.</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=cm> * @param {object} files - The files context variable.</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=cm> * @param {object} pr - The pr context variable.</span>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=cm> * @param {object} repo - The repo context variable.</span>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=cm> * @param {object} env - The env context variable.</span>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=cm> * @param {object} source - The source context variable.</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=cm> * @returns {string} Returns a formatted GitHub comment with a checklist of conditions that the PR meets.</span>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=cm> * @example       </span>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=cm> * - action: add-comment@v1</span>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=cm>        args:</span>
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=cm>            comment: {{ &quot;&quot; | checklist(branch, files, pr, repo, env, source) }}</span>
<a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=cm> * @license MIT</span>
<a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a><span class=cm>**/</span>
<a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a>
<a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a><span class=kd>const</span><span class=w> </span><span class=nx>checklistFilter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>(</span><span class=nx>empty</span><span class=p>,</span><span class=w> </span><span class=nx>branch</span><span class=p>,</span><span class=w> </span><span class=nx>files</span><span class=p>,</span><span class=w> </span><span class=nx>pr</span><span class=p>,</span><span class=w> </span><span class=nx>repo</span><span class=p>,</span><span class=w> </span><span class=nx>env</span><span class=p>,</span><span class=w> </span><span class=nx>source</span><span class=p>,</span><span class=w> </span><span class=nx>callback</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// made sync temporarily</span>
<a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>
<a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>checks</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
<a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a><span class=w>        </span><span class=p>{</span>
<a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a><span class=w>            </span><span class=nx>title</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;low-risk&quot;</span><span class=p>,</span>
<a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a><span class=w>            </span><span class=nx>label</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;The PR is a low-risk change&quot;</span><span class=p>,</span>
<a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a><span class=w>            </span><span class=c1>// our sample definition of a low-risk change is a docs-only PR from designated docs writers</span>
<a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a><span class=w>            </span><span class=nx>condition</span><span class=o>:</span><span class=w> </span><span class=nx>files</span><span class=p>.</span><span class=nx>every</span><span class=p>(</span><span class=nx>file</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=o>/</span><span class=nx>docs</span><span class=err>\</span><span class=c1>//.test(file)) &amp;&amp; pr.author_teams.includes(&quot;tech-writers&quot;)</span>
<a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a><span class=w>        </span><span class=p>{</span>
<a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a><span class=w>            </span><span class=nx>title</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;has-jira&quot;</span><span class=p>,</span>
<a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a><span class=w>            </span><span class=nx>label</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;The PR has a Jira reference in the title&quot;</span><span class=p>,</span>
<a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a><span class=w>            </span><span class=nx>condition</span><span class=o>:</span><span class=w> </span><span class=sr>/\b[A-Za-z]+-\d+\b/</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>pr</span><span class=p>.</span><span class=nx>title</span><span class=p>)</span>
<a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a><span class=w>        </span><span class=p>{</span>
<a id=__codelineno-4-35 name=__codelineno-4-35 href=#__codelineno-4-35></a><span class=w>            </span><span class=nx>title</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;updates-tests&quot;</span><span class=p>,</span>
<a id=__codelineno-4-36 name=__codelineno-4-36 href=#__codelineno-4-36></a><span class=w>            </span><span class=nx>label</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;The PR includes updates to tests&quot;</span><span class=p>,</span>
<a id=__codelineno-4-37 name=__codelineno-4-37 href=#__codelineno-4-37></a><span class=w>            </span><span class=nx>condition</span><span class=o>:</span><span class=w> </span><span class=nx>files</span><span class=p>.</span><span class=nx>some</span><span class=p>(</span><span class=nx>file</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=o>/</span><span class=p>[</span><span class=o>^</span><span class=nx>a</span><span class=o>-</span><span class=nx>zA</span><span class=o>-</span><span class=nx>Z0</span><span class=o>-</span><span class=mf>9</span><span class=p>](</span><span class=nx>spec</span><span class=o>|</span><span class=nx>test</span><span class=o>|</span><span class=nx>tests</span><span class=p>)[</span><span class=o>^</span><span class=nx>a</span><span class=o>-</span><span class=nx>zA</span><span class=o>-</span><span class=nx>Z0</span><span class=o>-</span><span class=mf>9</span><span class=p>]</span><span class=o>/</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>file</span><span class=p>))</span>
<a id=__codelineno-4-38 name=__codelineno-4-38 href=#__codelineno-4-38></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-4-39 name=__codelineno-4-39 href=#__codelineno-4-39></a><span class=w>        </span><span class=p>{</span>
<a id=__codelineno-4-40 name=__codelineno-4-40 href=#__codelineno-4-40></a><span class=w>            </span><span class=nx>title</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;includes-docs&quot;</span><span class=p>,</span>
<a id=__codelineno-4-41 name=__codelineno-4-41 href=#__codelineno-4-41></a><span class=w>            </span><span class=nx>label</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;The PR includes changes to the documentation&quot;</span><span class=p>,</span>
<a id=__codelineno-4-42 name=__codelineno-4-42 href=#__codelineno-4-42></a><span class=w>            </span><span class=nx>condition</span><span class=o>:</span><span class=w> </span><span class=nx>files</span><span class=p>.</span><span class=nx>some</span><span class=p>(</span><span class=nx>file</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=o>/</span><span class=nx>docs</span><span class=err>\</span><span class=c1>//.test(file))</span>
<a id=__codelineno-4-43 name=__codelineno-4-43 href=#__codelineno-4-43></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-4-44 name=__codelineno-4-44 href=#__codelineno-4-44></a><span class=w>        </span><span class=p>{</span>
<a id=__codelineno-4-45 name=__codelineno-4-45 href=#__codelineno-4-45></a><span class=w>            </span><span class=nx>title</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;first-time&quot;</span><span class=p>,</span>
<a id=__codelineno-4-46 name=__codelineno-4-46 href=#__codelineno-4-46></a><span class=w>            </span><span class=nx>label</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;The PR author is a first-time contributor&quot;</span><span class=p>,</span>
<a id=__codelineno-4-47 name=__codelineno-4-47 href=#__codelineno-4-47></a><span class=w>            </span><span class=nx>condition</span><span class=o>:</span><span class=w> </span><span class=nx>repo</span><span class=p>.</span><span class=nx>author_age</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mf>1</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>repo</span><span class=p>.</span><span class=nx>age</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>0</span><span class=w> </span><span class=c1>// if the PR author made their first contirbution on the current day</span>
<a id=__codelineno-4-48 name=__codelineno-4-48 href=#__codelineno-4-48></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-4-49 name=__codelineno-4-49 href=#__codelineno-4-49></a><span class=w>        </span><span class=p>{</span>
<a id=__codelineno-4-50 name=__codelineno-4-50 href=#__codelineno-4-50></a><span class=w>            </span><span class=nx>title</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;requires-opsec&quot;</span><span class=p>,</span>
<a id=__codelineno-4-51 name=__codelineno-4-51 href=#__codelineno-4-51></a><span class=w>            </span><span class=nx>label</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;The PR doesn&#39;t expose any secrets&quot;</span><span class=p>,</span>
<a id=__codelineno-4-52 name=__codelineno-4-52 href=#__codelineno-4-52></a><span class=w>            </span><span class=nx>condition</span><span class=o>:</span><span class=w> </span><span class=nx>source</span><span class=p>.</span><span class=nx>diff</span><span class=p>.</span><span class=nx>files</span>
<a id=__codelineno-4-53 name=__codelineno-4-53 href=#__codelineno-4-53></a><span class=w>                </span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>file</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>file</span><span class=p>.</span><span class=nx>new_content</span><span class=p>)</span>
<a id=__codelineno-4-54 name=__codelineno-4-54 href=#__codelineno-4-54></a><span class=w>                </span><span class=p>.</span><span class=nx>every</span><span class=p>(</span><span class=nx>file_content</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span>
<a id=__codelineno-4-55 name=__codelineno-4-55 href=#__codelineno-4-55></a><span class=w>                    </span><span class=p>[</span>
<a id=__codelineno-4-56 name=__codelineno-4-56 href=#__codelineno-4-56></a><span class=w>                        </span><span class=s2>&quot;MY_SECRET_ENVIRONMENT_VARIABLE&quot;</span>
<a id=__codelineno-4-57 name=__codelineno-4-57 href=#__codelineno-4-57></a><span class=w>                    </span><span class=p>].</span><span class=nx>every</span><span class=p>(</span><span class=nx>env_var</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=o>!</span><span class=nx>file_content</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>env_var</span><span class=p>))</span><span class=w> </span>
<a id=__codelineno-4-58 name=__codelineno-4-58 href=#__codelineno-4-58></a><span class=w>                       </span><span class=c1>// nothing added to any file during this comment contains any of the secret environment variables in this array</span>
<a id=__codelineno-4-59 name=__codelineno-4-59 href=#__codelineno-4-59></a><span class=w>                </span><span class=p>)</span>
<a id=__codelineno-4-60 name=__codelineno-4-60 href=#__codelineno-4-60></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-4-61 name=__codelineno-4-61 href=#__codelineno-4-61></a><span class=w>    </span><span class=p>];</span>
<a id=__codelineno-4-62 name=__codelineno-4-62 href=#__codelineno-4-62></a>
<a id=__codelineno-4-63 name=__codelineno-4-63 href=#__codelineno-4-63></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>comment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=nx>checks</span>
<a id=__codelineno-4-64 name=__codelineno-4-64 href=#__codelineno-4-64></a><span class=w>        </span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>check</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=sb>`- [</span><span class=si>${</span><span class=nx>check</span><span class=p>.</span><span class=nx>condition</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;x&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot; &quot;</span><span class=si>}</span><span class=sb>] </span><span class=si>${</span><span class=nx>check</span><span class=p>.</span><span class=nx>label</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
<a id=__codelineno-4-65 name=__codelineno-4-65 href=#__codelineno-4-65></a><span class=w>        </span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=s2>&quot;\n&quot;</span><span class=p>));</span>
<a id=__codelineno-4-66 name=__codelineno-4-66 href=#__codelineno-4-66></a>
<a id=__codelineno-4-67 name=__codelineno-4-67 href=#__codelineno-4-67></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>callback</span><span class=p>(</span>
<a id=__codelineno-4-68 name=__codelineno-4-68 href=#__codelineno-4-68></a><span class=w>        </span><span class=kc>null</span><span class=p>,</span><span class=w> </span>
<a id=__codelineno-4-69 name=__codelineno-4-69 href=#__codelineno-4-69></a><span class=w>        </span><span class=nb>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>comment</span><span class=p>)</span>
<a id=__codelineno-4-70 name=__codelineno-4-70 href=#__codelineno-4-70></a><span class=w>    </span><span class=p>);</span>
<a id=__codelineno-4-71 name=__codelineno-4-71 href=#__codelineno-4-71></a><span class=p>};</span>
<a id=__codelineno-4-72 name=__codelineno-4-72 href=#__codelineno-4-72></a>
<a id=__codelineno-4-73 name=__codelineno-4-73 href=#__codelineno-4-73></a><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-74 name=__codelineno-4-74 href=#__codelineno-4-74></a><span class=w>    </span><span class=k>async</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-4-75 name=__codelineno-4-75 href=#__codelineno-4-75></a><span class=w>    </span><span class=nx>filter</span><span class=o>:</span><span class=w> </span><span class=nx>checklistFilter</span>
<a id=__codelineno-4-76 name=__codelineno-4-76 href=#__codelineno-4-76></a><span class=p>}</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <details class=example> <summary>gitStream CM Example: checklist</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1># -*- mode: yaml -*-</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=nt>manifest</span><span class=p>:</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=nt>automations</span><span class=p>:</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>  </span><span class=nt>checklist</span><span class=p>:</span><span class=w> </span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>    </span><span class=nt>if</span><span class=p>:</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">add-comment@v1</span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=w>          </span><span class=nt>comment</span><span class=p>:</span><span class=w> </span><span class=cp>{{</span> <span class=s2>&quot;&quot;</span> <span class=o>|</span> <span class=nf>checklist</span><span class=o>(</span><span class=nv>branch</span><span class=o>,</span> <span class=nv>files</span><span class=o>,</span> <span class=nv>pr</span><span class=o>,</span> <span class=nv>repo</span><span class=o>,</span> <span class=nv>env</span><span class=o>,</span> <span class=nv>source</span><span class=o>)</span> <span class=cp>}}</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <p><a href=https://github.com/linear-b/gitstream/tree/main/plugins/filters/checklist>Download Source Code</a></p> <p><a name=module_compareSemver></a></p> <h2 id=comparemultisemver>compareMultiSemver</h2> <p>Processes a list of pairs of semantic version numbers and determines the most significant change among them.</p> <p><strong>Returns</strong>: <code>string</code> - It returns a string of either: 'major' if any pair has a major version increment. 'minor' if no pair has a major version increment but has a minor version increment. 'patch' if no pair has major or minor version increments but has a patch version increment. 'downgrade' if no pairs have a higher version. 'equal' if all pairs are equal. 'error' if the comparison is abnormal or cannot be determined.</p> <p><strong>License</strong>: MIT</p> <table> <thead> <tr> <th>Param</th> <th>Type</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>listOfPairs</td> <td><code>Array.&lt;Array&gt;</code></td> <td></td> <td>An array of version pairs, where each pair is an array of two semantic version strings.</td> </tr> </tbody> </table> <p><strong>Example</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=p>{{</span><span class=w> </span><span class=p>[[</span><span class=s2>&quot;1.2.3&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;0.2.1&quot;</span><span class=p>],</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;1.3.1&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;1.2.3&quot;</span><span class=p>]]</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=nx>compareMultiSemver</span><span class=w>  </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;major&quot;</span><span class=w> </span><span class=p>}}</span>
</code></pre></div></p> <details class=note> <summary>Plugin Code: compareMultiSemver</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=cm>/**</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=cm> * @module compareMultiSemver</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=cm> * @description Processes a list of pairs of semantic version numbers and determines the most significant change among them.</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=cm> * Each pair consists of two versions to be compared.</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=cm> * @param {string[][]} listOfPairs - An array of version pairs, where each pair is an array of two semantic version strings.</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=cm> * @returns {string} It returns a string of either:</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=cm> * &#39;major&#39; if any pair has a major version increment.</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=cm> * &#39;minor&#39; if no pair has a major version increment but has a minor version increment.</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=cm> * &#39;patch&#39; if no pair has major or minor version increments but has a patch version increment.</span>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=cm> * &#39;downgrade&#39; if no pairs have a higher version.</span>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=cm> * &#39;equal&#39; if all pairs are equal.</span>
<a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=cm> * &#39;error&#39; if the comparison is abnormal or cannot be determined.</span>
<a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=cm> * @example {{ [[&quot;1.2.3&quot;, &quot;1.2.1&quot;], [&quot;1.3.1&quot;, &quot;1.2.3&quot;]] | compareMultiSemver  == &quot;minor&quot; }}</span>
<a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=cm> * @license MIT</span>
<a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=cm> */</span>
<a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a>
<a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a>
<a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a><span class=kd>const</span><span class=w> </span><span class=nx>compareSemver</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../compareSemver/index.js&#39;</span><span class=p>);</span>
<a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a>
<a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>listOfPairs</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a>
<a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>priority</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a><span class=w>    </span><span class=s1>&#39;major&#39;</span><span class=o>:</span><span class=w> </span><span class=mf>3</span><span class=p>,</span>
<a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a><span class=w>    </span><span class=s1>&#39;minor&#39;</span><span class=o>:</span><span class=w> </span><span class=mf>2</span><span class=p>,</span>
<a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a><span class=w>    </span><span class=s1>&#39;patch&#39;</span><span class=o>:</span><span class=w> </span><span class=mf>1</span><span class=p>,</span>
<a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a><span class=w>    </span><span class=s1>&#39;downgrade&#39;</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span>
<a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a><span class=w>    </span><span class=s1>&#39;equal&#39;</span><span class=o>:</span><span class=w> </span><span class=o>-</span><span class=mf>1</span><span class=p>,</span>
<a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a><span class=w>    </span><span class=s1>&#39;error&#39;</span><span class=o>:</span><span class=w> </span><span class=o>-</span><span class=mf>2</span>
<a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a><span class=w>  </span><span class=p>};</span>
<a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a>
<a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a><span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=nx>mostSignificantChange</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;equal&#39;</span><span class=p>;</span>
<a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a>
<a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a><span class=w>  </span><span class=nx>listOfPairs</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>pair</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>compareSemver</span><span class=p>(</span><span class=nx>pair</span><span class=p>);</span>
<a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>priority</span><span class=p>[</span><span class=nx>result</span><span class=p>]</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=nx>priority</span><span class=p>[</span><span class=nx>mostSignificantChange</span><span class=p>])</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a><span class=w>      </span><span class=nx>mostSignificantChange</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>result</span><span class=p>;</span>
<a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-7-38 name=__codelineno-7-38 href=#__codelineno-7-38></a><span class=w>  </span><span class=p>});</span>
<a id=__codelineno-7-39 name=__codelineno-7-39 href=#__codelineno-7-39></a>
<a id=__codelineno-7-40 name=__codelineno-7-40 href=#__codelineno-7-40></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>mostSignificantChange</span><span class=p>;</span>
<a id=__codelineno-7-41 name=__codelineno-7-41 href=#__codelineno-7-41></a><span class=p>}</span>
<a id=__codelineno-7-42 name=__codelineno-7-42 href=#__codelineno-7-42></a>
<a id=__codelineno-7-43 name=__codelineno-7-43 href=#__codelineno-7-43></a>
<a id=__codelineno-7-44 name=__codelineno-7-44 href=#__codelineno-7-44></a><span class=kd>const</span><span class=w> </span><span class=nx>compareMultiSemver</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./index.js&#39;</span><span class=p>);</span>
<a id=__codelineno-7-45 name=__codelineno-7-45 href=#__codelineno-7-45></a><span class=nx>console</span><span class=p>.</span><span class=nx>assert</span><span class=p>(</span><span class=nx>compareMultiSemver</span><span class=p>([[</span><span class=s2>&quot;1.2.3&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;1.2.1&quot;</span><span class=p>],</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;1.3.1&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;1.2.3&quot;</span><span class=p>]])</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s1>&#39;minor&#39;</span><span class=p>,</span><span class=w> </span><span class=sb>`compareSemver([[&quot;1.2.3&quot;, &quot;1.2.1&quot;], [&quot;1.3.1&quot;, &quot;1.2.3&quot;]]) == &#39;minor&#39;`</span><span class=p>);</span>
<a id=__codelineno-7-46 name=__codelineno-7-46 href=#__codelineno-7-46></a><span class=nx>console</span><span class=p>.</span><span class=nx>assert</span><span class=p>(</span><span class=nx>compareMultiSemver</span><span class=p>([[</span><span class=s2>&quot;1.2.3&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;0.2.1&quot;</span><span class=p>],</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;1.3.1&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;1.2.3&quot;</span><span class=p>]])</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s1>&#39;major&#39;</span><span class=p>,</span><span class=w> </span><span class=sb>`compareMultiSemver([[&quot;1.2.3&quot;, &quot;0.2.1&quot;], [&quot;1.3.1&quot;, &quot;1.2.3&quot;]]) === &#39;major&#39;`</span><span class=p>);</span>
<a id=__codelineno-7-47 name=__codelineno-7-47 href=#__codelineno-7-47></a><span class=nx>console</span><span class=p>.</span><span class=nx>assert</span><span class=p>(</span><span class=nx>compareMultiSemver</span><span class=p>([[</span><span class=s2>&quot;2.2.3&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;0.2.1&quot;</span><span class=p>],</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;1.3.1&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;1.2.3&quot;</span><span class=p>]])</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s1>&#39;major&#39;</span><span class=p>,</span><span class=w> </span><span class=sb>`compareMultiSemver([[&quot;2.2.3&quot;, &quot;0.2.1&quot;], [&quot;1.3.1&quot;, &quot;1.2.3&quot;]]) === &#39;major&#39;`</span><span class=p>);</span>
<a id=__codelineno-7-48 name=__codelineno-7-48 href=#__codelineno-7-48></a><span class=nx>console</span><span class=p>.</span><span class=nx>assert</span><span class=p>(</span><span class=nx>compareMultiSemver</span><span class=p>([[</span><span class=s2>&quot;1.2.3&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;1.2.1&quot;</span><span class=p>],</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;1.2.4&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;1.2.3&quot;</span><span class=p>]])</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s1>&#39;patch&#39;</span><span class=p>,</span><span class=w> </span><span class=sb>`compareMultiSemver([[&quot;1.2.3&quot;, &quot;1.2.1&quot;], [&quot;1.2.4&quot;, &quot;1.2.3&quot;]]) === &#39;patch&#39;`</span><span class=p>);</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <details class=example> <summary>gitStream CM Example: compareMultiSemver</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=nt>manifest</span><span class=p>:</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=nt>automations</span><span class=p>:</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>  </span><span class=nt>bump_minor</span><span class=p>:</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=w>    </span><span class=nt>if</span><span class=p>:</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=nv>bump</span> <span class=o>==</span> <span class=s1>&#39;minor&#39;</span> <span class=cp>}}</span>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">approve@v1</span>
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">add-comment@v1</span>
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=w>          </span><span class=nt>comment</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=w>            </span><span class=no>bot `minor` version bumps are approved automatically.</span>
<a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a>
<a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a><span class=w>  </span><span class=nt>bump_patch</span><span class=p>:</span>
<a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=w>    </span><span class=nt>if</span><span class=p>:</span>
<a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=nv>bump</span> <span class=o>==</span> <span class=s1>&#39;patch&#39;</span> <span class=cp>}}</span>
<a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span>
<a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">approve@v1</span>
<a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">merge@v1</span>
<a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">add-comment@v1</span>
<a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a><span class=w>          </span><span class=nt>comment</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a><span class=w>            </span><span class=no>bot `patch` version bumps are approved and merged automatically.</span>
<a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a>
<a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a><span class=nt>bump</span><span class=p>:</span><span class=w> </span><span class=cp>{{</span> <span class=o>[[</span><span class=s2>&quot;1.2.3&quot;</span><span class=o>,</span> <span class=s2>&quot;1.2.1&quot;</span><span class=o>],</span> <span class=o>[</span><span class=s2>&quot;1.3.1&quot;</span><span class=o>,</span> <span class=s2>&quot;1.2.3&quot;</span><span class=o>]]</span> <span class=o>|</span> <span class=nf>compareMultiSemver</span> <span class=cp>}}</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <p><a href=https://github.com/linear-b/gitstream/tree/main/plugins/filters/compareMultiSemver>Download Source Code</a></p> <h2 id=comparesemver>compareSemver</h2> <div class="admonition note"> <p class=admonition-title>compareSemver â checkSemver</p> <p>This plugin is now supported by a native filter function <a href=/filter-functions/#checksemver><code>checkSemver</code></a>. The native implementation provides better performance and doesn't require plugin installation.</p> </div> <h2 id=extractdependabotversionbump>extractDependabotVersionBump</h2> <div class="admonition note"> <p class=admonition-title>extractDependabotVersionBump â checkDependabot</p> <p>This plugin is now supported by a native filter function <a href=/filter-functions/#checkdependabot><code>checkDependabot</code></a>. The native implementation provides better performance and doesn't require plugin installation.</p> </div> <p><a name=module_extractRenovateVersionBump></a></p> <h2 id=extractrenovateversionbump>extractRenovateVersionBump</h2> <p>Extract version bump information from Renovate PRs description</p> <p><strong>Returns</strong>: <code>Array.&lt;string&gt;</code> - V1 (to) and V2 (from) <strong>License</strong>: MIT</p> <table> <thead> <tr> <th>Param</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>description</td> <td><code>string</code></td> <td>the PR description</td> </tr> </tbody> </table> <p><strong>Example</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=p>{{</span><span class=w> </span><span class=nx>pr</span><span class=p>.</span><span class=nx>description</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=nx>extractRenovateVersionBump</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=nx>compareMultiSemver</span><span class=w> </span><span class=p>}}</span>
</code></pre></div></p> <details class=note> <summary>Plugin Code: extractRenovateVersionBump</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=cm>/**</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=cm> * @module extractRenovateVersionBump</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=cm> * @description Extract version bump information from Renovate PRs description</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=cm> * @param {string} description - the PR description</span>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=cm> * @returns {string[]} V1 (to) and V2 (from)</span>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=cm> * @example {{ pr.description | extractRenovateVersionBump | compareMultiSemver }}</span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=cm> * @license MIT</span>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=cm>**/</span>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>desc</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>results</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[];</span>
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>desc</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>desc</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=s1>&#39;&quot;&quot;&#39;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>desc</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=s2>&quot;&#39;&#39;&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>regex</span><span class=w> </span><span class=o>=</span>
<a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=w>      </span><span class=sr>/\[[\\]*`([\d\.]+[A-Za-zÎ±Ã]*)[\\]*` -&gt; [\\]*`([\d\.]+[A-Za-zÎ±Ã]*)[\\]*`\]/g</span><span class=p>;</span>
<a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=nx>matches</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span>
<a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=w>    </span><span class=k>do</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=w>      </span><span class=nx>matches</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>regex</span><span class=p>.</span><span class=nx>exec</span><span class=p>(</span><span class=nx>desc</span><span class=p>);</span>
<a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>matches</span><span class=o>?</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=mf>3</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=p>[</span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=kr>from</span><span class=p>,</span><span class=w> </span><span class=nx>to</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>matches</span><span class=p>;</span>
<a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a><span class=w>        </span><span class=c1>// remove trailing dot on to</span>
<a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>to</span><span class=p>.</span><span class=nx>at</span><span class=p>(</span><span class=o>-</span><span class=mf>1</span><span class=p>)</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s2>&quot;.&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a><span class=w>          </span><span class=nx>to</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>to</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mf>0</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mf>1</span><span class=p>);</span>
<a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a><span class=w>        </span><span class=nx>results</span><span class=p>.</span><span class=nx>push</span><span class=p>([</span><span class=nx>to</span><span class=p>,</span><span class=w> </span><span class=kr>from</span><span class=p>]);</span>
<a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a><span class=w>      </span><span class=p>}</span>
<a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=nx>matches</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=kc>null</span><span class=p>);</span>
<a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>results</span><span class=p>;</span>
<a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a><span class=p>}</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <details class=example> <summary>gitStream CM Example: extractRenovateVersionBump</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=nt>manifest</span><span class=p>:</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=nt>automations</span><span class=p>:</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=w>  </span><span class=nt>bump_minor</span><span class=p>:</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=w>    </span><span class=nt>if</span><span class=p>:</span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=nv>bump</span> <span class=o>==</span> <span class=s1>&#39;minor&#39;</span> <span class=cp>}}</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=nv>branch.name</span> <span class=o>|</span> <span class=nf>includes</span><span class=o>(</span><span class=nv>term</span><span class=o>=</span><span class=s2>&quot;renovate&quot;</span><span class=o>)</span> <span class=cp>}}</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=nv>branch.author</span> <span class=o>|</span> <span class=nf>includes</span><span class=o>(</span><span class=nv>term</span><span class=o>=</span><span class=s2>&quot;renovate&quot;</span><span class=o>)</span> <span class=cp>}}</span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">approve@v1</span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">add-comment@v1</span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=w>          </span><span class=nt>comment</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=w>            </span><span class=no>Renovate `minor` version bumps are approved automatically.</span>
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a>
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=w>  </span><span class=nt>bump_patch</span><span class=p>:</span>
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=w>    </span><span class=nt>if</span><span class=p>:</span>
<a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=nv>bump</span> <span class=o>==</span> <span class=s1>&#39;patch&#39;</span> <span class=cp>}}</span>
<a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=nv>branch.name</span> <span class=o>|</span> <span class=nf>includes</span><span class=o>(</span><span class=nv>term</span><span class=o>=</span><span class=s2>&quot;renovate&quot;</span><span class=o>)</span> <span class=cp>}}</span>
<a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=nv>branch.author</span> <span class=o>|</span> <span class=nf>includes</span><span class=o>(</span><span class=nv>term</span><span class=o>=</span><span class=s2>&quot;renovate&quot;</span><span class=o>)</span> <span class=cp>}}</span>
<a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span>
<a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">approve@v1</span>
<a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">merge@v1</span>
<a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">add-comment@v1</span>
<a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a><span class=w>          </span><span class=nt>comment</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a><span class=w>            </span><span class=no>Renovate `patch` version bumps are approved and merged automatically.</span>
<a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a>
<a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a><span class=nt>bump</span><span class=p>:</span><span class=w> </span><span class=cp>{{</span> <span class=nv>pr.description</span> <span class=o>|</span> <span class=nf>extractRenovateVersionBump</span> <span class=o>|</span> <span class=nf>compareMultiSemver</span> <span class=cp>}}</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <p><a href=https://github.com/linear-b/gitstream/tree/main/plugins/filters/extractRenovateVersionBump>Download Source Code</a></p> <p><a name=module_extractSnykVersionBump></a></p> <h2 id=extractsnykversionbump>extractSnykVersionBump</h2> <p>Extract version bump information from Snyk PRs description</p> <p><strong>Returns</strong>: <code>Array.&lt;string&gt;</code> - V1 (to) and V2 (from) <strong>License</strong>: MIT</p> <table> <thead> <tr> <th>Param</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>description</td> <td><code>string</code></td> <td>the PR description</td> </tr> </tbody> </table> <p><strong>Example</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=p>{{</span><span class=w> </span><span class=nx>pr</span><span class=p>.</span><span class=nx>description</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=nx>extractSnykVersionBump</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=nx>checkSemver</span><span class=w> </span><span class=p>}}</span>
</code></pre></div></p> <details class=note> <summary>Plugin Code: extractSnykVersionBump</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=cm>/**</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=cm> * @module extractSnykVersionBump</span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=cm> * @description Extract version bump information from Snyk PRs description</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=cm> * @param {string} description - the PR description</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=cm> * @returns {string[]} V1 (to) and V2 (from)</span>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=cm> * @example {{ pr.description | extractSnykVersionBump | checkSemver }}</span>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=cm> * @license MIT</span>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=cm>**/</span>
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a>
<a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>desc</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>desc</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>desc</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=s1>&#39;&quot;&quot;&#39;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>desc</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=s2>&quot;&#39;&#39;&quot;</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>matches</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sr>/Upgrade.*from ([\d\.]+[A-Za-zÎ±Ã]*) to ([\d\.]+[A-Za-zÎ±Ã]*)/</span><span class=p>.</span><span class=nx>exec</span><span class=p>(</span><span class=nx>desc</span><span class=p>);</span>
<a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>matches</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>matches</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mf>3</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=w>      </span><span class=kd>var</span><span class=w> </span><span class=p>[</span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=kr>from</span><span class=p>,</span><span class=w> </span><span class=nx>to</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>matches</span><span class=p>;</span>
<a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=w>      </span><span class=c1>// remove trailing dot on to</span>
<a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>to</span><span class=p>[</span><span class=nx>to</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mf>1</span><span class=p>]</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s2>&quot;.&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a><span class=w>        </span><span class=nx>to</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>to</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mf>0</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mf>1</span><span class=p>);</span>
<a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a><span class=w>      </span><span class=p>}</span>
<a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=p>[</span><span class=nx>to</span><span class=p>,</span><span class=w> </span><span class=kr>from</span><span class=p>];</span>
<a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a>
<a id=__codelineno-13-25 name=__codelineno-13-25 href=#__codelineno-13-25></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span>
<a id=__codelineno-13-26 name=__codelineno-13-26 href=#__codelineno-13-26></a><span class=p>}</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <details class=example> <summary>gitStream CM Example: extractSnykVersionBump</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=nt>manifest</span><span class=p>:</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=nt>automations</span><span class=p>:</span>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=w>  </span><span class=nt>bump_minor</span><span class=p>:</span>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=w>    </span><span class=nt>if</span><span class=p>:</span>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=nv>bump</span> <span class=o>==</span> <span class=s1>&#39;minor&#39;</span> <span class=cp>}}</span>
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=nv>branch.name</span> <span class=o>|</span> <span class=nf>includes</span><span class=o>(</span><span class=nv>term</span><span class=o>=</span><span class=s2>&quot;snyk-update&quot;&quot;) }}</span>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=s2>      - {{ branch.author | includes(term=&quot;</span><span class=nv>snyk-update</span><span class=s2>&quot;&quot;</span><span class=o>)</span> <span class=cp>}}</span>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span>
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">approve@v1</span>
<a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">add-comment@v1</span>
<a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=w>          </span><span class=nt>comment</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=w>            </span><span class=no>Snyk `minor` version bumps are approved automatically.</span>
<a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a>
<a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a><span class=w>  </span><span class=nt>bump_patch</span><span class=p>:</span>
<a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a><span class=w>    </span><span class=nt>if</span><span class=p>:</span>
<a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=nv>bump</span> <span class=o>==</span> <span class=s1>&#39;patch&#39;</span> <span class=cp>}}</span>
<a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=nv>branch.name</span> <span class=o>|</span> <span class=nf>includes</span><span class=o>(</span><span class=nv>term</span><span class=o>=</span><span class=s2>&quot;snyk-update&quot;&quot;) }}</span>
<a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a><span class=s2>      - {{ branch.author | includes(term=&quot;</span><span class=nv>snyk-update</span><span class=s2>&quot;&quot;</span><span class=o>)</span> <span class=cp>}}</span>
<a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span>
<a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">approve@v1</span>
<a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">merge@v1</span>
<a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">add-comment@v1</span>
<a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a><span class=w>          </span><span class=nt>comment</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a><span class=w>            </span><span class=no>Snyk `patch` version bumps are approved and merged automatically.</span>
<a id=__codelineno-14-29 name=__codelineno-14-29 href=#__codelineno-14-29></a>
<a id=__codelineno-14-30 name=__codelineno-14-30 href=#__codelineno-14-30></a><span class=nt>bump</span><span class=p>:</span><span class=w> </span><span class=cp>{{</span> <span class=nv>pr.description</span> <span class=o>|</span> <span class=nf>extractSnykVersionBump</span> <span class=o>|</span> <span class=nf>checkSemver</span> <span class=cp>}}</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <p><a href=https://github.com/linear-b/gitstream/tree/main/plugins/filters/extractSnykVersionBump>Download Source Code</a></p> <p><a name=module_extractOrcaFindings></a></p> <h2 id=extractorcafindings>extractOrcaFindings</h2> <p>Extract security issues information from Orca PR reviews</p> <p><strong>Returns</strong>: <code>Object</code> - Findings Findings.infrastructure_as_code: { count: null, priority: '' }, Findings.vulnerabilities: { count: null, priority: '' }, Findings.secrets: { count: null, priority: '' },<br> <strong>License</strong>: MIT </p> <table> <thead> <tr> <th>Param</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>PR</td> <td><code>Object</code></td> <td>the gitStream's PR context variable</td> </tr> </tbody> </table> <p><strong>Example</strong><br> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=p>{{</span><span class=w> </span><span class=nx>pr</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=nx>extractOrcaFindings</span><span class=w> </span><span class=p>}}</span>
</code></pre></div></p> <p>Usage example, that adds lables based on Orca Secuirty findings.</p> <details class=note> <summary>Plugin Code: extractOrcaFindings</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=cm>/**</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=cm> * @module extractOrcaFindings</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=cm> * @description Extract security issues information from Orca PR reviews</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=cm> * @param {Object} pr - the gitStream&#39;s PR context variable</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=cm> * @returns {Object} Findings</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=cm> * Findings.infrastructure_as_code: { count: null, priority: &#39;&#39; },</span>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=cm> * Findings.vulnerabilities: { count: null, priority: &#39;&#39; },</span>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=cm> * Findings.secrets: { count: null, priority: &#39;&#39; },</span>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=cm> * @example {{ pr | extractOrcaFindings }}</span>
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=cm> * @license MIT</span>
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=cm>**/</span>
<a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a>
<a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a>
<a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=kd>function</span><span class=w> </span><span class=nx>getOrcaPropertyRating</span><span class=p>(</span><span class=nx>lines</span><span class=p>,</span><span class=w> </span><span class=nx>lineIdentifierRegex</span><span class=p>,</span><span class=w> </span><span class=nx>findingsCellIndex</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>matches</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>lines</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>x</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>x</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=nx>lineIdentifierRegex</span><span class=p>));</span>
<a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>firstMatch</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>matches</span><span class=p>;</span>
<a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>cells</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>firstMatch</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;|&#39;</span><span class=p>);</span>
<a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>high</span><span class=p>,</span><span class=w> </span><span class=nx>medium</span><span class=p>,</span><span class=w> </span><span class=nx>low</span><span class=p>,</span><span class=w> </span><span class=nx>info</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sr>/&quot;High&quot;&gt; ([\d]+).*&quot;Medium&quot;&gt; ([\d]+).*&quot;Low&quot;&gt; ([\d]+).*&quot;Info&quot;&gt; ([\d]+)/</span>
<a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=w>    </span><span class=p>.</span><span class=nx>exec</span><span class=p>(</span><span class=nx>cells</span><span class=p>[</span><span class=nx>findingsCellIndex</span><span class=p>])</span>
<a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a><span class=w>    </span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>x</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nb>parseInt</span><span class=p>(</span><span class=nx>x</span><span class=p>));</span>
<a id=__codelineno-16-21 name=__codelineno-16-21 href=#__codelineno-16-21></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=p>{</span><span class=nx>high</span><span class=p>,</span><span class=w> </span><span class=nx>medium</span><span class=p>,</span><span class=w> </span><span class=nx>low</span><span class=p>,</span><span class=w> </span><span class=nx>info</span><span class=p>};</span>
<a id=__codelineno-16-22 name=__codelineno-16-22 href=#__codelineno-16-22></a><span class=p>}</span>
<a id=__codelineno-16-23 name=__codelineno-16-23 href=#__codelineno-16-23></a>
<a id=__codelineno-16-24 name=__codelineno-16-24 href=#__codelineno-16-24></a><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>pr</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-16-25 name=__codelineno-16-25 href=#__codelineno-16-25></a><span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=nx>orcaObject</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-16-26 name=__codelineno-16-26 href=#__codelineno-16-26></a><span class=w>    </span><span class=nx>infrastructure_as_code</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=nx>priority</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=p>},</span>
<a id=__codelineno-16-27 name=__codelineno-16-27 href=#__codelineno-16-27></a><span class=w>    </span><span class=nx>vulnerabilities</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=nx>priority</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=p>},</span>
<a id=__codelineno-16-28 name=__codelineno-16-28 href=#__codelineno-16-28></a><span class=w>    </span><span class=nx>secrets</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=nx>priority</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=p>},</span>
<a id=__codelineno-16-29 name=__codelineno-16-29 href=#__codelineno-16-29></a><span class=w>  </span><span class=p>};</span>
<a id=__codelineno-16-30 name=__codelineno-16-30 href=#__codelineno-16-30></a>
<a id=__codelineno-16-31 name=__codelineno-16-31 href=#__codelineno-16-31></a><span class=w>  </span><span class=c1>// Orca comments are added as PR review</span>
<a id=__codelineno-16-32 name=__codelineno-16-32 href=#__codelineno-16-32></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>orcaComment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>pr</span><span class=p>.</span><span class=nx>reviews</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>x</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>x</span><span class=p>.</span><span class=nx>commenter</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;orca-security&#39;</span><span class=p>));</span>
<a id=__codelineno-16-33 name=__codelineno-16-33 href=#__codelineno-16-33></a>
<a id=__codelineno-16-34 name=__codelineno-16-34 href=#__codelineno-16-34></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>orcaComment</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-16-35 name=__codelineno-16-35 href=#__codelineno-16-35></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>orcaCommentArray</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>orcaComment</span><span class=p>[</span><span class=nx>orcaComment</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mf>1</span><span class=p>].</span><span class=nx>content</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;\n&#39;</span><span class=p>);</span>
<a id=__codelineno-16-36 name=__codelineno-16-36 href=#__codelineno-16-36></a>
<a id=__codelineno-16-37 name=__codelineno-16-37 href=#__codelineno-16-37></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>priority</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>getOrcaPropertyRating</span><span class=p>(</span><span class=nx>orcaCommentArray</span><span class=p>,</span><span class=w> </span><span class=sr>/Infrastructure as Code/</span><span class=p>,</span><span class=w> </span><span class=mf>3</span><span class=p>);</span>
<a id=__codelineno-16-38 name=__codelineno-16-38 href=#__codelineno-16-38></a><span class=w>    </span><span class=nx>orcaObject</span><span class=p>.</span><span class=nx>infrastructure_as_code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-16-39 name=__codelineno-16-39 href=#__codelineno-16-39></a><span class=w>      </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=nx>priority</span><span class=p>.</span><span class=nx>high</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>priority</span><span class=p>.</span><span class=nx>medium</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>priority</span><span class=p>.</span><span class=nx>low</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>priority</span><span class=p>.</span><span class=nx>info</span><span class=p>,</span>
<a id=__codelineno-16-40 name=__codelineno-16-40 href=#__codelineno-16-40></a><span class=w>      </span><span class=nx>priority</span><span class=p>,</span>
<a id=__codelineno-16-41 name=__codelineno-16-41 href=#__codelineno-16-41></a><span class=w>    </span><span class=p>};</span>
<a id=__codelineno-16-42 name=__codelineno-16-42 href=#__codelineno-16-42></a>
<a id=__codelineno-16-43 name=__codelineno-16-43 href=#__codelineno-16-43></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>priority</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>getOrcaPropertyRating</span><span class=p>(</span><span class=nx>orcaCommentArray</span><span class=p>,</span><span class=w> </span><span class=sr>/Vulnerabilities/</span><span class=p>,</span><span class=w> </span><span class=mf>3</span><span class=p>);</span>
<a id=__codelineno-16-44 name=__codelineno-16-44 href=#__codelineno-16-44></a><span class=w>    </span><span class=nx>orcaObject</span><span class=p>.</span><span class=nx>vulnerabilities</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-16-45 name=__codelineno-16-45 href=#__codelineno-16-45></a><span class=w>      </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=nx>priority</span><span class=p>.</span><span class=nx>high</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>priority</span><span class=p>.</span><span class=nx>medium</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>priority</span><span class=p>.</span><span class=nx>low</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>priority</span><span class=p>.</span><span class=nx>info</span><span class=p>,</span>
<a id=__codelineno-16-46 name=__codelineno-16-46 href=#__codelineno-16-46></a><span class=w>      </span><span class=nx>priority</span><span class=p>,</span>
<a id=__codelineno-16-47 name=__codelineno-16-47 href=#__codelineno-16-47></a><span class=w>    </span><span class=p>};</span>
<a id=__codelineno-16-48 name=__codelineno-16-48 href=#__codelineno-16-48></a>
<a id=__codelineno-16-49 name=__codelineno-16-49 href=#__codelineno-16-49></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>priority</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>getOrcaPropertyRating</span><span class=p>(</span><span class=nx>orcaCommentArray</span><span class=p>,</span><span class=w> </span><span class=sr>/Secrets/</span><span class=p>,</span><span class=w> </span><span class=mf>3</span><span class=p>);</span>
<a id=__codelineno-16-50 name=__codelineno-16-50 href=#__codelineno-16-50></a><span class=w>    </span><span class=nx>orcaObject</span><span class=p>.</span><span class=nx>secrets</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-16-51 name=__codelineno-16-51 href=#__codelineno-16-51></a><span class=w>      </span><span class=nx>count</span><span class=o>:</span><span class=w> </span><span class=nx>priority</span><span class=p>.</span><span class=nx>high</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>priority</span><span class=p>.</span><span class=nx>medium</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>priority</span><span class=p>.</span><span class=nx>low</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>priority</span><span class=p>.</span><span class=nx>info</span><span class=p>,</span>
<a id=__codelineno-16-52 name=__codelineno-16-52 href=#__codelineno-16-52></a><span class=w>      </span><span class=nx>priority</span><span class=p>,</span>
<a id=__codelineno-16-53 name=__codelineno-16-53 href=#__codelineno-16-53></a><span class=w>    </span><span class=p>};</span>
<a id=__codelineno-16-54 name=__codelineno-16-54 href=#__codelineno-16-54></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-16-55 name=__codelineno-16-55 href=#__codelineno-16-55></a>
<a id=__codelineno-16-56 name=__codelineno-16-56 href=#__codelineno-16-56></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nb>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>orcaObject</span><span class=p>);</span>
<a id=__codelineno-16-57 name=__codelineno-16-57 href=#__codelineno-16-57></a><span class=p>}</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <details class=example> <summary>gitStream CM Example: extractOrcaFindings</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=c1># -*- mode: yaml -*-</span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=nt>manifest</span><span class=p>:</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=nt>automations</span><span class=p>:</span>
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=w>  </span><span class=cp>{%</span> <span class=k>for</span> <span class=nv>item</span> <span class=k>in</span> <span class=nv>reports</span> <span class=cp>%}</span>
<a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=w>  </span><span class=nt>label_orca_</span><span class=cp>{{</span> <span class=nv>item.name</span> <span class=cp>}}</span><span class=p>:</span>
<a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=w>    </span><span class=nt>if</span><span class=p>:</span>
<a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=nv>item.count</span> <span class=o>&gt;</span> <span class=m>0</span> <span class=cp>}}</span>
<a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span>
<a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">add-label@v1</span>
<a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=w>          </span><span class=nt>label</span><span class=p>:</span><span class=w> </span><span class=s>&#39;orca:</span><span class=cp>{{</span> <span class=nv>item.name</span> <span class=cp>}}</span><span class=s>&#39;</span>
<a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=w>  </span><span class=cp>{%</span> <span class=k>endfor</span> <span class=cp>%}</span>
<a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a>
<a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=nt>orca</span><span class=p>:</span><span class=w> </span><span class=cp>{{</span> <span class=nv>pr</span> <span class=o>|</span> <span class=nf>extractOrcaFindings</span> <span class=cp>}}</span>
<a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a>
<a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a><span class=nt>reports</span><span class=p>:</span>
<a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">introduced-cves</span>
<a id=__codelineno-17-21 name=__codelineno-17-21 href=#__codelineno-17-21></a><span class=w>    </span><span class=nt>count</span><span class=p>:</span><span class=w> </span><span class=cp>{{</span> <span class=nv>orca.vulnerabilities.count</span> <span class=cp>}}</span>
<a id=__codelineno-17-22 name=__codelineno-17-22 href=#__codelineno-17-22></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">iac-misconfigurations</span>
<a id=__codelineno-17-23 name=__codelineno-17-23 href=#__codelineno-17-23></a><span class=w>    </span><span class=nt>count</span><span class=p>:</span><span class=w> </span><span class=cp>{{</span> <span class=nv>orca.infrastructure_as_code.count</span> <span class=cp>}}</span>
<a id=__codelineno-17-24 name=__codelineno-17-24 href=#__codelineno-17-24></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">exposed-secrets</span><span class=w> </span>
<a id=__codelineno-17-25 name=__codelineno-17-25 href=#__codelineno-17-25></a><span class=w>    </span><span class=nt>count</span><span class=p>:</span><span class=w> </span><span class=cp>{{</span> <span class=nv>orca.secrets.count</span> <span class=cp>}}</span>
<a id=__codelineno-17-26 name=__codelineno-17-26 href=#__codelineno-17-26></a>
<a id=__codelineno-17-27 name=__codelineno-17-27 href=#__codelineno-17-27></a><span class=nt>colors</span><span class=p>:</span>
<a id=__codelineno-17-28 name=__codelineno-17-28 href=#__codelineno-17-28></a><span class=w>  </span><span class=nt>red</span><span class=p>:</span><span class=w> </span><span class=s>&#39;b60205&#39;</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <p><a href=https://github.com/linear-b/gitstream/tree/main/plugins/filters/extractOrcaFindings>Download Source Code</a></p> <p><a name=module_generateDescription></a></p> <h2 id=generatedescription>generateDescription</h2> <p>A gitStream plugin to auto-generate pull request descriptions based on commit messages and other criteria.</p> <p><img alt="Example PR description" src=../screenshots/generate-pr-description-example.png></p> <p><strong>Returns</strong>: <code>Object</code> - Returns the generated PR description. <strong>License</strong>: MIT</p> <table> <thead> <tr> <th>Param</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>branch</td> <td><code>Object</code></td> <td>The current branch object.</td> </tr> <tr> <td>pr</td> <td><code>Object</code></td> <td>The pull request object.</td> </tr> <tr> <td>repo</td> <td><code>Object</code></td> <td>The repository object.</td> </tr> <tr> <td>source</td> <td><code>Object</code></td> <td>The source object containing diff information.</td> </tr> <tr> <td>callback</td> <td><code>function</code></td> <td>The callback function.</td> </tr> </tbody> </table> <p><strong>Example</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=p>{{</span><span class=w> </span><span class=nx>branch</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=nx>generateDescription</span><span class=p>(</span><span class=nx>pr</span><span class=p>,</span><span class=w> </span><span class=nx>repo</span><span class=p>,</span><span class=w> </span><span class=nx>source</span><span class=p>)</span><span class=w> </span><span class=p>}}</span>
</code></pre></div></p> <details class=note> <summary>Plugin Code: generateDescription</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=cm>/**</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=cm> * @module generateDescription</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=cm> * @description A gitStream plugin to auto-generate pull request descriptions based on commit messages and other criteria.</span>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=cm> * @param {Object} branch - The current branch object.</span>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=cm> * @param {Object} pr - The pull request object.</span>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=cm> * @param {Object} repo - The repository object.</span>
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=cm> * @param {Object} source - The source object containing diff information.</span>
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=cm> * @param {function} callback - The callback function.</span>
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=cm> * @returns {Object} Returns the generated PR description.</span>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=cm> * @example {{ branch | generateDescription(pr, repo, source) }}</span>
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=cm> * @license MIT</span>
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=cm>**/</span>
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a>
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a>
<a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a><span class=c1>// Parse commit messages</span>
<a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a><span class=kd>function</span><span class=w> </span><span class=nx>parseCommitMessages</span><span class=p>(</span><span class=nx>messages</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>commitTypes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a><span class=w>    </span><span class=nx>feat</span><span class=o>:</span><span class=w> </span><span class=p>[],</span>
<a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a><span class=w>    </span><span class=nx>fix</span><span class=o>:</span><span class=w> </span><span class=p>[],</span>
<a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a><span class=w>    </span><span class=nx>chore</span><span class=o>:</span><span class=w> </span><span class=p>[],</span>
<a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a><span class=w>    </span><span class=nx>docs</span><span class=o>:</span><span class=w> </span><span class=p>[],</span>
<a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a><span class=w>    </span><span class=nx>style</span><span class=o>:</span><span class=w> </span><span class=p>[],</span>
<a id=__codelineno-19-23 name=__codelineno-19-23 href=#__codelineno-19-23></a><span class=w>    </span><span class=nx>refactor</span><span class=o>:</span><span class=w> </span><span class=p>[],</span>
<a id=__codelineno-19-24 name=__codelineno-19-24 href=#__codelineno-19-24></a><span class=w>    </span><span class=nx>perf</span><span class=o>:</span><span class=w> </span><span class=p>[],</span>
<a id=__codelineno-19-25 name=__codelineno-19-25 href=#__codelineno-19-25></a><span class=w>    </span><span class=nx>test</span><span class=o>:</span><span class=w> </span><span class=p>[],</span>
<a id=__codelineno-19-26 name=__codelineno-19-26 href=#__codelineno-19-26></a><span class=w>    </span><span class=nx>build</span><span class=o>:</span><span class=w> </span><span class=p>[],</span>
<a id=__codelineno-19-27 name=__codelineno-19-27 href=#__codelineno-19-27></a><span class=w>    </span><span class=nx>ci</span><span class=o>:</span><span class=w> </span><span class=p>[],</span>
<a id=__codelineno-19-28 name=__codelineno-19-28 href=#__codelineno-19-28></a><span class=w>    </span><span class=nx>other</span><span class=o>:</span><span class=w> </span><span class=p>[],</span>
<a id=__codelineno-19-29 name=__codelineno-19-29 href=#__codelineno-19-29></a><span class=w>  </span><span class=p>};</span>
<a id=__codelineno-19-30 name=__codelineno-19-30 href=#__codelineno-19-30></a>
<a id=__codelineno-19-31 name=__codelineno-19-31 href=#__codelineno-19-31></a><span class=w>  </span><span class=nx>messages</span>
<a id=__codelineno-19-32 name=__codelineno-19-32 href=#__codelineno-19-32></a><span class=w>    </span><span class=p>.</span><span class=nx>filter</span><span class=p>((</span><span class=nx>message</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=o>!</span><span class=nx>message</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s2>&quot;Merge branch&quot;</span><span class=p>))</span>
<a id=__codelineno-19-33 name=__codelineno-19-33 href=#__codelineno-19-33></a><span class=w>    </span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>message</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-19-34 name=__codelineno-19-34 href=#__codelineno-19-34></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>match</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>message</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span>
<a id=__codelineno-19-35 name=__codelineno-19-35 href=#__codelineno-19-35></a><span class=w>        </span><span class=sr>/^(feat|fix|chore|docs|style|refactor|perf|test|build|ci):/</span><span class=p>,</span>
<a id=__codelineno-19-36 name=__codelineno-19-36 href=#__codelineno-19-36></a><span class=w>      </span><span class=p>);</span>
<a id=__codelineno-19-37 name=__codelineno-19-37 href=#__codelineno-19-37></a><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>match</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-19-38 name=__codelineno-19-38 href=#__codelineno-19-38></a><span class=w>        </span><span class=nx>commitTypes</span><span class=p>[</span><span class=nx>match</span><span class=p>[</span><span class=mf>1</span><span class=p>]].</span><span class=nx>push</span><span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>match</span><span class=p>[</span><span class=mf>1</span><span class=p>]</span><span class=si>}</span><span class=sb>:`</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=p>).</span><span class=nx>trim</span><span class=p>());</span>
<a id=__codelineno-19-39 name=__codelineno-19-39 href=#__codelineno-19-39></a><span class=w>      </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-19-40 name=__codelineno-19-40 href=#__codelineno-19-40></a><span class=w>        </span><span class=nx>commitTypes</span><span class=p>.</span><span class=nx>other</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>message</span><span class=p>);</span>
<a id=__codelineno-19-41 name=__codelineno-19-41 href=#__codelineno-19-41></a><span class=w>      </span><span class=p>}</span>
<a id=__codelineno-19-42 name=__codelineno-19-42 href=#__codelineno-19-42></a><span class=w>    </span><span class=p>});</span>
<a id=__codelineno-19-43 name=__codelineno-19-43 href=#__codelineno-19-43></a>
<a id=__codelineno-19-44 name=__codelineno-19-44 href=#__codelineno-19-44></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>commitTypes</span><span class=p>;</span>
<a id=__codelineno-19-45 name=__codelineno-19-45 href=#__codelineno-19-45></a><span class=p>}</span>
<a id=__codelineno-19-46 name=__codelineno-19-46 href=#__codelineno-19-46></a>
<a id=__codelineno-19-47 name=__codelineno-19-47 href=#__codelineno-19-47></a><span class=c1>// Format commit section</span>
<a id=__codelineno-19-48 name=__codelineno-19-48 href=#__codelineno-19-48></a><span class=kd>function</span><span class=w> </span><span class=nx>formatCommitSection</span><span class=p>(</span><span class=nx>type</span><span class=p>,</span><span class=w> </span><span class=nx>commits</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-19-49 name=__codelineno-19-49 href=#__codelineno-19-49></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>commits</span><span class=p>.</span><span class=nx>length</span>
<a id=__codelineno-19-50 name=__codelineno-19-50 href=#__codelineno-19-50></a><span class=w>    </span><span class=o>?</span><span class=w> </span><span class=sb>`&gt; - **</span><span class=si>${</span><span class=nx>type</span><span class=si>}</span><span class=sb>:**\n</span><span class=si>${</span><span class=nx>commits</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>msg</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=sb>`&gt;     - </span><span class=si>${</span><span class=nx>msg</span><span class=si>}</span><span class=sb>`</span><span class=p>).</span><span class=nx>join</span><span class=p>(</span><span class=s2>&quot;\n&quot;</span><span class=p>)</span><span class=si>}</span><span class=sb>\n`</span>
<a id=__codelineno-19-51 name=__codelineno-19-51 href=#__codelineno-19-51></a><span class=w>    </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=p>;</span>
<a id=__codelineno-19-52 name=__codelineno-19-52 href=#__codelineno-19-52></a><span class=p>}</span>
<a id=__codelineno-19-53 name=__codelineno-19-53 href=#__codelineno-19-53></a>
<a id=__codelineno-19-54 name=__codelineno-19-54 href=#__codelineno-19-54></a><span class=kd>function</span><span class=w> </span><span class=nx>containsNewTests</span><span class=p>(</span><span class=nx>files</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-19-55 name=__codelineno-19-55 href=#__codelineno-19-55></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>testPattern</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sr>/(test_|spec_|__tests__|_test|_tests|\.test|\.spec)/i</span><span class=p>;</span>
<a id=__codelineno-19-56 name=__codelineno-19-56 href=#__codelineno-19-56></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>testDirectoryPattern</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sr>/[\\/]?(tests|test|__tests__)[\\/]/i</span><span class=p>;</span>
<a id=__codelineno-19-57 name=__codelineno-19-57 href=#__codelineno-19-57></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>testKeywords</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sr>/describe\(|it\(|test\(|expect\(/i</span><span class=p>;</span><span class=w> </span><span class=c1>// Common test keywords for JavaScript</span>
<a id=__codelineno-19-58 name=__codelineno-19-58 href=#__codelineno-19-58></a>
<a id=__codelineno-19-59 name=__codelineno-19-59 href=#__codelineno-19-59></a><span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kd>const</span><span class=w> </span><span class=nx>file</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=nx>files</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-19-60 name=__codelineno-19-60 href=#__codelineno-19-60></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>new_file</span><span class=p>,</span><span class=w> </span><span class=nx>diff</span><span class=p>,</span><span class=w> </span><span class=nx>new_content</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>file</span><span class=p>;</span>
<a id=__codelineno-19-61 name=__codelineno-19-61 href=#__codelineno-19-61></a>
<a id=__codelineno-19-62 name=__codelineno-19-62 href=#__codelineno-19-62></a><span class=w>    </span><span class=c1>// Check if the filename indicates it&#39;s a test file</span>
<a id=__codelineno-19-63 name=__codelineno-19-63 href=#__codelineno-19-63></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>testPattern</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>new_file</span><span class=p>)</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nx>testDirectoryPattern</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>new_file</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-19-64 name=__codelineno-19-64 href=#__codelineno-19-64></a><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span>
<a id=__codelineno-19-65 name=__codelineno-19-65 href=#__codelineno-19-65></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-19-66 name=__codelineno-19-66 href=#__codelineno-19-66></a>
<a id=__codelineno-19-67 name=__codelineno-19-67 href=#__codelineno-19-67></a><span class=w>    </span><span class=c1>// Check if the diff or new content contains test-related code</span>
<a id=__codelineno-19-68 name=__codelineno-19-68 href=#__codelineno-19-68></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>testKeywords</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>diff</span><span class=p>)</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nx>testKeywords</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>new_content</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-19-69 name=__codelineno-19-69 href=#__codelineno-19-69></a><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span>
<a id=__codelineno-19-70 name=__codelineno-19-70 href=#__codelineno-19-70></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-19-71 name=__codelineno-19-71 href=#__codelineno-19-71></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-19-72 name=__codelineno-19-72 href=#__codelineno-19-72></a>
<a id=__codelineno-19-73 name=__codelineno-19-73 href=#__codelineno-19-73></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>
<a id=__codelineno-19-74 name=__codelineno-19-74 href=#__codelineno-19-74></a><span class=p>}</span>
<a id=__codelineno-19-75 name=__codelineno-19-75 href=#__codelineno-19-75></a>
<a id=__codelineno-19-76 name=__codelineno-19-76 href=#__codelineno-19-76></a><span class=kd>function</span><span class=w> </span><span class=nx>extractUserAdditions</span><span class=p>(</span><span class=nx>description</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-19-77 name=__codelineno-19-77 href=#__codelineno-19-77></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>match</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>description</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span>
<a id=__codelineno-19-78 name=__codelineno-19-78 href=#__codelineno-19-78></a><span class=w>    </span><span class=sr>/&lt;!--- user additions start ---&gt;([\s\S]*?)&lt;!--- user additions end ---&gt;/</span><span class=p>,</span>
<a id=__codelineno-19-79 name=__codelineno-19-79 href=#__codelineno-19-79></a><span class=w>  </span><span class=p>);</span>
<a id=__codelineno-19-80 name=__codelineno-19-80 href=#__codelineno-19-80></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>match</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=nx>match</span><span class=p>[</span><span class=mf>1</span><span class=p>].</span><span class=nx>trim</span><span class=p>()</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=nx>description</span><span class=p>.</span><span class=nx>trim</span><span class=p>();</span>
<a id=__codelineno-19-81 name=__codelineno-19-81 href=#__codelineno-19-81></a><span class=p>}</span>
<a id=__codelineno-19-82 name=__codelineno-19-82 href=#__codelineno-19-82></a>
<a id=__codelineno-19-83 name=__codelineno-19-83 href=#__codelineno-19-83></a><span class=c1>// Generate PR description</span>
<a id=__codelineno-19-84 name=__codelineno-19-84 href=#__codelineno-19-84></a><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>generateDescription</span><span class=p>(</span><span class=nx>branch</span><span class=p>,</span><span class=w> </span><span class=nx>pr</span><span class=p>,</span><span class=w> </span><span class=nx>repo</span><span class=p>,</span><span class=w> </span><span class=nx>source</span><span class=p>,</span><span class=w> </span><span class=nx>callback</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-19-85 name=__codelineno-19-85 href=#__codelineno-19-85></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>[</span><span class=nx>__filename</span><span class=p>])</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-19-86 name=__codelineno-19-86 href=#__codelineno-19-86></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>callback</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>[</span><span class=nx>__filename</span><span class=p>]);</span>
<a id=__codelineno-19-87 name=__codelineno-19-87 href=#__codelineno-19-87></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-19-88 name=__codelineno-19-88 href=#__codelineno-19-88></a>
<a id=__codelineno-19-89 name=__codelineno-19-89 href=#__codelineno-19-89></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>commitTypes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>parseCommitMessages</span><span class=p>(</span><span class=nx>branch</span><span class=p>.</span><span class=nx>commits</span><span class=p>.</span><span class=nx>messages</span><span class=p>);</span>
<a id=__codelineno-19-90 name=__codelineno-19-90 href=#__codelineno-19-90></a>
<a id=__codelineno-19-91 name=__codelineno-19-91 href=#__codelineno-19-91></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>addTests</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>containsNewTests</span><span class=p>(</span><span class=nx>source</span><span class=p>.</span><span class=nx>diff</span><span class=p>.</span><span class=nx>files</span><span class=p>)</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;X&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot; &quot;</span><span class=p>;</span>
<a id=__codelineno-19-92 name=__codelineno-19-92 href=#__codelineno-19-92></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>codeApproved</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>pr</span><span class=p>.</span><span class=nx>approvals</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>0</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;X&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot; &quot;</span><span class=p>;</span>
<a id=__codelineno-19-93 name=__codelineno-19-93 href=#__codelineno-19-93></a>
<a id=__codelineno-19-94 name=__codelineno-19-94 href=#__codelineno-19-94></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>changes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>commitTypes</span><span class=p>)</span>
<a id=__codelineno-19-95 name=__codelineno-19-95 href=#__codelineno-19-95></a><span class=w>    </span><span class=p>.</span><span class=nx>map</span><span class=p>(([</span><span class=nx>type</span><span class=p>,</span><span class=w> </span><span class=nx>commits</span><span class=p>])</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>formatCommitSection</span><span class=p>(</span><span class=nx>type</span><span class=p>,</span><span class=w> </span><span class=nx>commits</span><span class=p>))</span>
<a id=__codelineno-19-96 name=__codelineno-19-96 href=#__codelineno-19-96></a><span class=w>    </span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>);</span>
<a id=__codelineno-19-97 name=__codelineno-19-97 href=#__codelineno-19-97></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>changesWithoutLastBr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>changes</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mf>0</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mf>1</span><span class=p>);</span>
<a id=__codelineno-19-98 name=__codelineno-19-98 href=#__codelineno-19-98></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>userAdditions</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>extractUserAdditions</span><span class=p>(</span><span class=nx>pr</span><span class=p>.</span><span class=nx>description</span><span class=p>);</span>
<a id=__codelineno-19-99 name=__codelineno-19-99 href=#__codelineno-19-99></a>
<a id=__codelineno-19-100 name=__codelineno-19-100 href=#__codelineno-19-100></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sb>`</span>
<a id=__codelineno-19-101 name=__codelineno-19-101 href=#__codelineno-19-101></a><span class=sb>&lt;!--- user additions start ---&gt;</span>
<a id=__codelineno-19-102 name=__codelineno-19-102 href=#__codelineno-19-102></a><span class=si>${</span><span class=nx>userAdditions</span><span class=si>}</span>
<a id=__codelineno-19-103 name=__codelineno-19-103 href=#__codelineno-19-103></a><span class=sb>&lt;!--- user additions end ---&gt;</span>
<a id=__codelineno-19-104 name=__codelineno-19-104 href=#__codelineno-19-104></a>
<a id=__codelineno-19-105 name=__codelineno-19-105 href=#__codelineno-19-105></a>
<a id=__codelineno-19-106 name=__codelineno-19-106 href=#__codelineno-19-106></a><span class=sb>**PR description below is managed by gitStream**</span>
<a id=__codelineno-19-107 name=__codelineno-19-107 href=#__codelineno-19-107></a><span class=sb>&lt;!--- Auto-generated by gitStream---&gt;</span>
<a id=__codelineno-19-108 name=__codelineno-19-108 href=#__codelineno-19-108></a><span class=sb>&gt; #### Commits Summary</span>
<a id=__codelineno-19-109 name=__codelineno-19-109 href=#__codelineno-19-109></a><span class=sb>&gt; This pull request includes the following changes:</span>
<a id=__codelineno-19-110 name=__codelineno-19-110 href=#__codelineno-19-110></a><span class=si>${</span><span class=nx>changesWithoutLastBr</span><span class=si>}</span>
<a id=__codelineno-19-111 name=__codelineno-19-111 href=#__codelineno-19-111></a><span class=sb>&gt; #### Checklist</span>
<a id=__codelineno-19-112 name=__codelineno-19-112 href=#__codelineno-19-112></a><span class=sb>&gt; - [</span><span class=si>${</span><span class=nx>addTests</span><span class=si>}</span><span class=sb>] Add tests</span>
<a id=__codelineno-19-113 name=__codelineno-19-113 href=#__codelineno-19-113></a><span class=sb>&gt; - [</span><span class=si>${</span><span class=nx>codeApproved</span><span class=si>}</span><span class=sb>] Code Reviewed and approved</span>
<a id=__codelineno-19-114 name=__codelineno-19-114 href=#__codelineno-19-114></a><span class=sb>&lt;!--- Auto-generated by gitStream end ---&gt;</span>
<a id=__codelineno-19-115 name=__codelineno-19-115 href=#__codelineno-19-115></a><span class=sb>`</span><span class=p>;</span>
<a id=__codelineno-19-116 name=__codelineno-19-116 href=#__codelineno-19-116></a>
<a id=__codelineno-19-117 name=__codelineno-19-117 href=#__codelineno-19-117></a><span class=w>  </span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>[</span><span class=nx>__filename</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>result</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&quot;\n&quot;</span><span class=p>).</span><span class=nx>join</span><span class=p>(</span><span class=s2>&quot;\n            &quot;</span><span class=p>);</span>
<a id=__codelineno-19-118 name=__codelineno-19-118 href=#__codelineno-19-118></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>callback</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>[</span><span class=nx>__filename</span><span class=p>]);</span>
<a id=__codelineno-19-119 name=__codelineno-19-119 href=#__codelineno-19-119></a><span class=p>}</span>
<a id=__codelineno-19-120 name=__codelineno-19-120 href=#__codelineno-19-120></a>
<a id=__codelineno-19-121 name=__codelineno-19-121 href=#__codelineno-19-121></a><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>filter</span><span class=o>:</span><span class=w> </span><span class=nx>generateDescription</span><span class=p>,</span><span class=w> </span><span class=k>async</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=p>};</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <details class=example> <summary>gitStream CM Example: generateDescription</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=nt>triggers</span><span class=p>:</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=w>  </span><span class=nt>exclude</span><span class=p>:</span>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=w>    </span><span class=nt>branch</span><span class=p>:</span>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">r/dependabot/</span>
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a>
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=nt>automations</span><span class=p>:</span>
<a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=w>  </span><span class=nt>generate_pr_desc</span><span class=p>:</span>
<a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=w>    </span><span class=nt>if</span><span class=p>:</span>
<a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span>
<a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">update-description@v1</span>
<a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=w>          </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=w>            </span><span class=cp>{{</span> <span class=nv>branch</span> <span class=o>|</span> <span class=nf>generateDescription</span><span class=o>(</span><span class=nv>pr</span><span class=o>,</span> <span class=nv>repo</span><span class=o>,</span> <span class=nv>source</span><span class=o>)</span> <span class=cp>}}</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <p><a href=https://github.com/linear-b/gitstream/tree/main/plugins/filters/generateDescription>Download Source Code</a></p> <p><a name=module_getCodeowners></a></p> <h2 id=getcodeowners>getCodeowners</h2> <p>Resolves the PR's code owners based on the repository's CODEOWNERS file</p> <p><strong>Returns</strong>: <code>Array.&lt;string&gt;</code> - user names<br> <strong>License</strong>: MIT </p> <table> <thead> <tr> <th>Param</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>files</td> <td><code>Array.&lt;string&gt;</code></td> <td>the gitStream's files context variable</td> </tr> <tr> <td>pr</td> <td><code>Object</code></td> <td>the gitStream's pr context variable</td> </tr> <tr> <td>token</td> <td><code>string</code></td> <td>access token with repo:read scope, used to read the CODEOWNERS file</td> </tr> </tbody> </table> <p><strong>Example</strong><br> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=p>{{</span><span class=w> </span><span class=nx>files</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=nx>getCodeowners</span><span class=p>(</span><span class=nx>pr</span><span class=p>,</span><span class=w> </span><span class=nx>env</span><span class=p>.</span><span class=nx>CODEOWNERS_TOKEN</span><span class=p>)</span><span class=w> </span><span class=p>}}</span>
</code></pre></div></p> <p>When used, create a secret TOKEN, and add it to the workflow file, in GitHub:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>jobs:
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>  gitStream:
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>    ...
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>    env:
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>      CODEOWNERS: ${{ secrets.GITSTREAM_CODEOWNERS }}
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>    steps:
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>      - name: Evaluate Rules
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>        uses: linear-b/gitstream-github-action@v2
</code></pre></div> <details class=note> <summary>Plugin Code: getCodeowners</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=cm>/**</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=cm> * @module getCodeowners</span>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=cm> * @description Resolves the PR&#39;s code owners based on the repository&#39;s CODEOWNERS file</span>
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=cm> * @param {string[]} files - the gitStream&#39;s files context variable</span>
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=cm> * @param {Object} pr - the gitStream&#39;s pr context variable</span>
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=cm> * @param {string} token - access token with repo:read scope, used to read the CODEOWNERS file</span>
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=cm> * @returns {string[]} user names</span>
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=cm> * @example {{ files | getCodeowners(pr, env.CODEOWNERS_TOKEN) }}</span>
<a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=cm> * @license MIT</span>
<a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=cm>**/</span>
<a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a>
<a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a>
<a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>Octokit</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s2>&quot;@octokit/rest&quot;</span><span class=p>);</span>
<a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a><span class=kd>const</span><span class=w> </span><span class=nx>ignore</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./ignore/index.js&#39;</span><span class=p>);</span>
<a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a>
<a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>loadCodeownersFile</span><span class=p>(</span><span class=nx>owner</span><span class=p>,</span><span class=w> </span><span class=nx>repo</span><span class=p>,</span><span class=w> </span><span class=nx>auth</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>octokit</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>Octokit</span><span class=p>({</span>
<a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a><span class=w>    </span><span class=nx>request</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>fetch</span><span class=w> </span><span class=p>},</span>
<a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a><span class=w>    </span><span class=nx>auth</span><span class=p>,</span>
<a id=__codelineno-23-20 name=__codelineno-23-20 href=#__codelineno-23-20></a><span class=w>  </span><span class=p>});</span>
<a id=__codelineno-23-21 name=__codelineno-23-21 href=#__codelineno-23-21></a>
<a id=__codelineno-23-22 name=__codelineno-23-22 href=#__codelineno-23-22></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>res</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>octokit</span><span class=p>.</span><span class=nx>repos</span><span class=p>.</span><span class=nx>getContent</span><span class=p>({</span>
<a id=__codelineno-23-23 name=__codelineno-23-23 href=#__codelineno-23-23></a><span class=w>    </span><span class=nx>owner</span><span class=p>,</span>
<a id=__codelineno-23-24 name=__codelineno-23-24 href=#__codelineno-23-24></a><span class=w>    </span><span class=nx>repo</span><span class=p>,</span>
<a id=__codelineno-23-25 name=__codelineno-23-25 href=#__codelineno-23-25></a><span class=w>    </span><span class=nx>path</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;CODEOWNERS&#39;</span>
<a id=__codelineno-23-26 name=__codelineno-23-26 href=#__codelineno-23-26></a><span class=w>  </span><span class=p>});</span>
<a id=__codelineno-23-27 name=__codelineno-23-27 href=#__codelineno-23-27></a>
<a id=__codelineno-23-28 name=__codelineno-23-28 href=#__codelineno-23-28></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>Buffer</span><span class=p>.</span><span class=kr>from</span><span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>content</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;base64&#39;</span><span class=p>).</span><span class=nx>toString</span><span class=p>()</span>
<a id=__codelineno-23-29 name=__codelineno-23-29 href=#__codelineno-23-29></a><span class=p>}</span>
<a id=__codelineno-23-30 name=__codelineno-23-30 href=#__codelineno-23-30></a>
<a id=__codelineno-23-31 name=__codelineno-23-31 href=#__codelineno-23-31></a><span class=kd>function</span><span class=w> </span><span class=nx>codeownersMapping</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-23-32 name=__codelineno-23-32 href=#__codelineno-23-32></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>data</span>
<a id=__codelineno-23-33 name=__codelineno-23-33 href=#__codelineno-23-33></a><span class=w>    </span><span class=p>.</span><span class=nx>toString</span><span class=p>()</span>
<a id=__codelineno-23-34 name=__codelineno-23-34 href=#__codelineno-23-34></a><span class=w>    </span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;\n&#39;</span><span class=p>)</span>
<a id=__codelineno-23-35 name=__codelineno-23-35 href=#__codelineno-23-35></a><span class=w>    </span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>x</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>x</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>!</span><span class=nx>x</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=s1>&#39;#&#39;</span><span class=p>))</span>
<a id=__codelineno-23-36 name=__codelineno-23-36 href=#__codelineno-23-36></a><span class=w>    </span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>x</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>x</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&quot;#&quot;</span><span class=p>)[</span><span class=mf>0</span><span class=p>])</span>
<a id=__codelineno-23-37 name=__codelineno-23-37 href=#__codelineno-23-37></a><span class=w>    </span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>x</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-23-38 name=__codelineno-23-38 href=#__codelineno-23-38></a><span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>line</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>x</span><span class=p>.</span><span class=nx>trim</span><span class=p>();</span>
<a id=__codelineno-23-39 name=__codelineno-23-39 href=#__codelineno-23-39></a><span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>path</span><span class=p>,</span><span class=w> </span><span class=p>...</span><span class=nx>owners</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>line</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=sr>/\s+/</span><span class=p>);</span>
<a id=__codelineno-23-40 name=__codelineno-23-40 href=#__codelineno-23-40></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>{</span><span class=nx>path</span><span class=p>,</span><span class=w> </span><span class=nx>owners</span><span class=p>};</span>
<a id=__codelineno-23-41 name=__codelineno-23-41 href=#__codelineno-23-41></a><span class=w>    </span><span class=p>});</span>
<a id=__codelineno-23-42 name=__codelineno-23-42 href=#__codelineno-23-42></a><span class=p>}</span>
<a id=__codelineno-23-43 name=__codelineno-23-43 href=#__codelineno-23-43></a>
<a id=__codelineno-23-44 name=__codelineno-23-44 href=#__codelineno-23-44></a><span class=kd>function</span><span class=w> </span><span class=nx>resolveCodeowner</span><span class=p>(</span><span class=nx>mapping</span><span class=p>,</span><span class=w> </span><span class=nx>file</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-23-45 name=__codelineno-23-45 href=#__codelineno-23-45></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>match</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>mapping</span>
<a id=__codelineno-23-46 name=__codelineno-23-46 href=#__codelineno-23-46></a><span class=w>      </span><span class=p>.</span><span class=nx>slice</span><span class=p>()</span>
<a id=__codelineno-23-47 name=__codelineno-23-47 href=#__codelineno-23-47></a><span class=w>      </span><span class=p>.</span><span class=nx>reverse</span><span class=p>()</span>
<a id=__codelineno-23-48 name=__codelineno-23-48 href=#__codelineno-23-48></a><span class=w>      </span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=nx>x</span><span class=w> </span><span class=p>=&gt;</span>
<a id=__codelineno-23-49 name=__codelineno-23-49 href=#__codelineno-23-49></a><span class=w>          </span><span class=nx>ignore</span><span class=p>()</span>
<a id=__codelineno-23-50 name=__codelineno-23-50 href=#__codelineno-23-50></a><span class=w>              </span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>x</span><span class=p>.</span><span class=nx>path</span><span class=p>)</span>
<a id=__codelineno-23-51 name=__codelineno-23-51 href=#__codelineno-23-51></a><span class=w>              </span><span class=p>.</span><span class=nx>ignores</span><span class=p>(</span><span class=nx>file</span><span class=p>)</span>
<a id=__codelineno-23-52 name=__codelineno-23-52 href=#__codelineno-23-52></a><span class=w>      </span><span class=p>);</span>
<a id=__codelineno-23-53 name=__codelineno-23-53 href=#__codelineno-23-53></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>match</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>
<a id=__codelineno-23-54 name=__codelineno-23-54 href=#__codelineno-23-54></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>match</span><span class=p>.</span><span class=nx>owners</span><span class=p>;</span>
<a id=__codelineno-23-55 name=__codelineno-23-55 href=#__codelineno-23-55></a><span class=p>}</span>
<a id=__codelineno-23-56 name=__codelineno-23-56 href=#__codelineno-23-56></a>
<a id=__codelineno-23-57 name=__codelineno-23-57 href=#__codelineno-23-57></a><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-23-58 name=__codelineno-23-58 href=#__codelineno-23-58></a><span class=w>   </span><span class=k>async</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-23-59 name=__codelineno-23-59 href=#__codelineno-23-59></a><span class=w>   </span><span class=nx>filter</span><span class=o>:</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>(</span><span class=nx>files</span><span class=p>,</span><span class=w> </span><span class=nx>pr</span><span class=p>,</span><span class=w> </span><span class=nx>token</span><span class=p>,</span><span class=w> </span><span class=nx>callback</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-23-60 name=__codelineno-23-60 href=#__codelineno-23-60></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>fileData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>loadCodeownersFile</span><span class=p>(</span><span class=nx>pr</span><span class=p>.</span><span class=nx>author</span><span class=p>,</span><span class=w> </span><span class=nx>pr</span><span class=p>.</span><span class=nx>repo</span><span class=p>,</span><span class=w> </span><span class=nx>token</span><span class=p>);</span>
<a id=__codelineno-23-61 name=__codelineno-23-61 href=#__codelineno-23-61></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>mapping</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>codeownersMapping</span><span class=p>(</span><span class=nx>fileData</span><span class=p>);</span>
<a id=__codelineno-23-62 name=__codelineno-23-62 href=#__codelineno-23-62></a>
<a id=__codelineno-23-63 name=__codelineno-23-63 href=#__codelineno-23-63></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>resolved</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>files</span>
<a id=__codelineno-23-64 name=__codelineno-23-64 href=#__codelineno-23-64></a><span class=w>      </span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>f</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>resolveCodeowner</span><span class=p>(</span><span class=nx>mapping</span><span class=p>,</span><span class=w> </span><span class=nx>f</span><span class=p>))</span>
<a id=__codelineno-23-65 name=__codelineno-23-65 href=#__codelineno-23-65></a><span class=w>      </span><span class=p>.</span><span class=nx>flat</span><span class=p>()</span>
<a id=__codelineno-23-66 name=__codelineno-23-66 href=#__codelineno-23-66></a><span class=w>      </span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>i</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=ow>typeof</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s1>&#39;string&#39;</span><span class=p>)</span>
<a id=__codelineno-23-67 name=__codelineno-23-67 href=#__codelineno-23-67></a><span class=w>      </span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>u</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>u</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/^@/</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=p>));</span>
<a id=__codelineno-23-68 name=__codelineno-23-68 href=#__codelineno-23-68></a>
<a id=__codelineno-23-69 name=__codelineno-23-69 href=#__codelineno-23-69></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>unique</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[...</span><span class=ow>new</span><span class=w> </span><span class=nb>Set</span><span class=p>(</span><span class=nx>resolved</span><span class=p>)];</span>
<a id=__codelineno-23-70 name=__codelineno-23-70 href=#__codelineno-23-70></a>
<a id=__codelineno-23-71 name=__codelineno-23-71 href=#__codelineno-23-71></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>callback</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=nx>unique</span><span class=p>);</span><span class=w> </span>
<a id=__codelineno-23-72 name=__codelineno-23-72 href=#__codelineno-23-72></a><span class=w>  </span><span class=p>},</span>
<a id=__codelineno-23-73 name=__codelineno-23-73 href=#__codelineno-23-73></a><span class=p>}</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <details class=example> <summary>gitStream CM Example: getCodeowners</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1># -*- mode: yaml -*-</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=nt>manifest</span><span class=p>:</span>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=nt>automations</span><span class=p>:</span>
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=w>  </span><span class=nt>senior_review</span><span class=p>:</span>
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=w>    </span><span class=nt>if</span><span class=p>:</span>
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span>
<a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">explain-code-experts@v1</span>
<a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a><span class=w>          </span><span class=nt>gt</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">add-reviewers@v1</span>
<a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a><span class=w>          </span><span class=nt>reviewers</span><span class=p>:</span><span class=w> </span><span class=cp>{{</span> <span class=nv>experts</span> <span class=o>|</span> <span class=nf>intersection</span><span class=o>(</span><span class=nv>list</span><span class=o>=</span><span class=nv>owners</span><span class=o>)</span> <span class=cp>}}</span>
<a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a>
<a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a><span class=nt>experts</span><span class=p>:</span><span class=w> </span><span class=cp>{{</span> <span class=nv>repo</span> <span class=o>|</span> <span class=nf>codeExperts</span><span class=o>(</span><span class=nv>gt</span><span class=o>=</span><span class=m>10</span><span class=o>)</span> <span class=cp>}}</span>
<a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a><span class=nt>owners</span><span class=p>:</span><span class=w> </span><span class=cp>{{</span> <span class=nv>files</span> <span class=o>|</span> <span class=nf>getCodeowners</span><span class=o>(</span><span class=nv>pr</span><span class=o>,</span> <span class=nv>env.CODEOWNERS</span><span class=o>)</span> <span class=cp>}}</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <p><a href=https://github.com/linear-b/gitstream/tree/main/plugins/filters/getCodeowners>Download Source Code</a></p> <p><a name=module_hasJiraIssue></a></p> <h2 id=hasjiraissue>hasJiraIssue</h2> <p>Check to see if the input string matches a specified field for one or more Jira issues.</p> <p><strong>Returns</strong>: <code>boolean</code> - Returns true if the input string matches a Jira task title.<br> <strong>License</strong>: MIT </p> <table> <thead> <tr> <th>Param</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>input</td> <td><code>string</code></td> <td>The string to search for a Jira task title.</td> </tr> <tr> <td>password</td> <td><code>string</code></td> <td>Your Jira API token</td> </tr> <tr> <td>key</td> <td><code>string</code></td> <td>The Jira key to search for matches against the input string.</td> </tr> <tr> <td>jiraSpaceName</td> <td><code>string</code></td> <td>The name of the Jira space to search for tasks.</td> </tr> <tr> <td>email</td> <td><code>string</code></td> <td>The email address associated with the Jira API token.</td> </tr> </tbody> </table> <p><strong>Example</strong><br> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=p>{{</span><span class=w> </span><span class=s2>&quot;https://github.com/{{ repo.owner }}/{{ repo.name }}/pull/{{ pr.number }}&quot;</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=nx>hasJiraIssue</span><span class=p>(</span><span class=nx>password</span><span class=p>,</span><span class=w> </span><span class=nx>key</span><span class=p>,</span><span class=w> </span><span class=nx>jiraSpaceName</span><span class=p>,</span><span class=w> </span><span class=nx>email</span><span class=p>)</span><span class=w> </span><span class=p>}}</span>
</code></pre></div></p> <div class="admonition warning"> <p class=admonition-title>Prerequisite Configuration</p> <p>You will need to complete the following steps to use this plugin:</p> <ol> <li><a href=https://support.atlassian.com/atlassian-account/docs/manage-api-tokens-for-your-atlassian-account/ >Create an API token</a> for your Jira account.</li> <li>Make the token available to gitStream via an <a href=https://docs.gitstream.cm/context-variables/#env>environment variable</a>.</li> </ol> </div> <details class=note> <summary>Plugin Code: hasJiraIssue</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=cm>/**</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=cm> * @module hasJiraIssue</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=cm> * @description Check to see if the input string matches a specified field for one or more Jira issues.</span>
<a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=cm> * @param {string} input - The string to search for a Jira task title.</span>
<a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=cm> * @param {string} password - Your Jira API token</span>
<a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=cm> * @param {string} key - The Jira key to search for matches against the input string.</span>
<a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=cm> * @param {string} jiraSpaceName - The name of the Jira space to search for tasks.</span>
<a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=cm> * @param {string} email - The email address associated with the Jira API token.</span>
<a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=cm> * @returns {boolean} Returns true if the input string matches a Jira task title. </span>
<a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=cm> * @example {{ &quot;https://github.com/{{ repo.owner }}/{{ repo.name }}/pull/{{ pr.number }}&quot; | hasJiraIssue(password, key, jiraSpaceName, email) }}</span>
<a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=cm> * @license MIT</span>
<a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=cm> */</span>
<a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a><span class=w>    </span><span class=k>async</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=w>    </span><span class=nx>filter</span><span class=o>:</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>(</span><span class=nx>inputString</span><span class=p>,</span><span class=w> </span><span class=nx>password</span><span class=p>,</span><span class=w> </span><span class=nx>key</span><span class=p>,</span><span class=w> </span><span class=nx>jiraSpaceName</span><span class=p>,</span><span class=w> </span><span class=nx>email</span><span class=p>,</span><span class=w> </span><span class=nx>callback</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a><span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>jql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sb>`&quot;</span><span class=si>${</span><span class=nx>key</span><span class=si>}</span><span class=sb>&quot; = &quot;</span><span class=si>${</span><span class=nx>inputString</span><span class=si>}</span><span class=sb>&quot;`</span><span class=p>;</span>
<a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a>
<a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>resp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>fetch</span><span class=p>(</span><span class=sb>`https://</span><span class=si>${</span><span class=nx>jiraSpaceName</span><span class=si>}</span><span class=sb>.atlassian.net/rest/api/2/search`</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a><span class=w>            </span><span class=nx>method</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;POST&#39;</span><span class=p>,</span>
<a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a><span class=w>            </span><span class=nx>headers</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a><span class=w>                </span><span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;application/json&#39;</span><span class=p>,</span>
<a id=__codelineno-26-22 name=__codelineno-26-22 href=#__codelineno-26-22></a><span class=w>                </span><span class=s1>&#39;Authorization&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Basic &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>btoa</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>email</span><span class=si>}</span><span class=sb>:</span><span class=si>${</span><span class=nx>password</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
<a id=__codelineno-26-23 name=__codelineno-26-23 href=#__codelineno-26-23></a><span class=w>            </span><span class=p>},</span>
<a id=__codelineno-26-24 name=__codelineno-26-24 href=#__codelineno-26-24></a><span class=w>            </span><span class=nx>body</span><span class=o>:</span><span class=w> </span><span class=nb>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
<a id=__codelineno-26-25 name=__codelineno-26-25 href=#__codelineno-26-25></a><span class=w>                </span><span class=s1>&#39;jql&#39;</span><span class=o>:</span><span class=w> </span><span class=nx>jql</span><span class=p>,</span>
<a id=__codelineno-26-26 name=__codelineno-26-26 href=#__codelineno-26-26></a><span class=w>                </span><span class=s1>&#39;maxResults&#39;</span><span class=o>:</span><span class=w> </span><span class=mf>1</span><span class=p>,</span>
<a id=__codelineno-26-27 name=__codelineno-26-27 href=#__codelineno-26-27></a><span class=w>                </span><span class=s2>&quot;fieldsByKeys&quot;</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-26-28 name=__codelineno-26-28 href=#__codelineno-26-28></a><span class=w>                </span><span class=s1>&#39;fields&#39;</span><span class=o>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s1>&#39;assignee&#39;</span><span class=w> </span><span class=p>]</span>
<a id=__codelineno-26-29 name=__codelineno-26-29 href=#__codelineno-26-29></a><span class=w>            </span><span class=p>})</span>
<a id=__codelineno-26-30 name=__codelineno-26-30 href=#__codelineno-26-30></a><span class=w>        </span><span class=p>});</span>
<a id=__codelineno-26-31 name=__codelineno-26-31 href=#__codelineno-26-31></a><span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>results</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>resp</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
<a id=__codelineno-26-32 name=__codelineno-26-32 href=#__codelineno-26-32></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>callback</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=w>  </span><span class=o>!!</span><span class=nx>results</span><span class=p>.</span><span class=nx>issues</span><span class=o>?</span><span class=p>.</span><span class=nx>length</span><span class=p>);</span>
<a id=__codelineno-26-33 name=__codelineno-26-33 href=#__codelineno-26-33></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-26-34 name=__codelineno-26-34 href=#__codelineno-26-34></a><span class=p>}</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <details class=example> <summary>gitStream CM Example: hasJiraIssue</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1># -*- mode: yaml -*-</span>
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=nt>manifest</span><span class=p>:</span>
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a>
<a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=c1>###### ** Configure This Section ** ######</span>
<a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a>
<a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=c1># Configure this for your Jira instance and the email associated with your API key.</span>
<a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=c1># You can safely use these values because only your API key is sensitive. </span>
<a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=nt>jiraSpaceName</span><span class=p>:</span><span class=w> </span><span class=s>&quot;my-company&quot;</span><span class=w> </span><span class=c1># e.g. my-company.atlassian.net</span>
<a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=nt>email</span><span class=p>:</span><span class=w> </span><span class=s>&quot;my.email@example.com&quot;</span>
<a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=c1># If you&#39;re concerned about exposing this information,</span>
<a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=c1># we recommend using environment variables for your production environment.</span>
<a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a>
<a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=c1># -----------</span>
<a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a>
<a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a><span class=c1># Pass the API token associated with the email above to gitStream via an environment variable.</span>
<a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a><span class=nt>jiraAuth</span><span class=p>:</span><span class=w> </span><span class=cp>{{</span> <span class=nv>env.JIRA_API_TOKEN</span> <span class=cp>}}</span>
<a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a><span class=c1># Learn more about env: https://docs.gitstream.cm/context-variables/#env</span>
<a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a>
<a id=__codelineno-27-21 name=__codelineno-27-21 href=#__codelineno-27-21></a><span class=c1># -----------</span>
<a id=__codelineno-27-22 name=__codelineno-27-22 href=#__codelineno-27-22></a>
<a id=__codelineno-27-23 name=__codelineno-27-23 href=#__codelineno-27-23></a><span class=c1># Change this to the Jira field you want to match the input string against.</span>
<a id=__codelineno-27-24 name=__codelineno-27-24 href=#__codelineno-27-24></a><span class=nt>jiraField</span><span class=p>:</span><span class=w> </span><span class=s>&quot;myField&quot;</span>
<a id=__codelineno-27-25 name=__codelineno-27-25 href=#__codelineno-27-25></a><span class=c1># If you want to search a custom field, you should provide the ID like so:</span>
<a id=__codelineno-27-26 name=__codelineno-27-26 href=#__codelineno-27-26></a><span class=c1># jiraField: &quot;cf[XXXXX]&quot;</span>
<a id=__codelineno-27-27 name=__codelineno-27-27 href=#__codelineno-27-27></a><span class=c1># Replace XXXXX with the ID of the custom field you want to search.</span>
<a id=__codelineno-27-28 name=__codelineno-27-28 href=#__codelineno-27-28></a><span class=c1># More information:</span>
<a id=__codelineno-27-29 name=__codelineno-27-29 href=#__codelineno-27-29></a><span class=c1># Using JQL to search the Jira API: https://support.atlassian.com/jira-service-management-cloud/docs/jql-fields/</span>
<a id=__codelineno-27-30 name=__codelineno-27-30 href=#__codelineno-27-30></a><span class=c1># How to find the ID of a custom field: https://confluence.atlassian.com/jirakb/how-to-find-any-custom-field-s-ids-744522503.html</span>
<a id=__codelineno-27-31 name=__codelineno-27-31 href=#__codelineno-27-31></a>
<a id=__codelineno-27-32 name=__codelineno-27-32 href=#__codelineno-27-32></a><span class=c1># -----------</span>
<a id=__codelineno-27-33 name=__codelineno-27-33 href=#__codelineno-27-33></a>
<a id=__codelineno-27-34 name=__codelineno-27-34 href=#__codelineno-27-34></a>
<a id=__codelineno-27-35 name=__codelineno-27-35 href=#__codelineno-27-35></a><span class=nt>prUrl</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://github.com/</span><span class=cp>{{</span> <span class=nv>repo.owner</span> <span class=cp>}}</span><span class=s>/</span><span class=cp>{{</span> <span class=nv>repo.name</span> <span class=cp>}}</span><span class=s>/pull/</span><span class=cp>{{</span> <span class=nv>pr.number</span> <span class=cp>}}</span><span class=s>&quot;</span>
<a id=__codelineno-27-36 name=__codelineno-27-36 href=#__codelineno-27-36></a><span class=nt>has_jira_issue</span><span class=p>:</span><span class=w> </span><span class=cp>{{</span> <span class=nv>prUrl</span>  <span class=o>|</span> <span class=nf>hasJiraIssue</span><span class=o>(</span><span class=nv>jiraAuth</span><span class=o>,</span> <span class=nv>jiraField</span><span class=o>,</span> <span class=nv>jiraSpaceName</span><span class=o>,</span> <span class=nv>email</span><span class=o>)</span> <span class=cp>}}</span>
<a id=__codelineno-27-37 name=__codelineno-27-37 href=#__codelineno-27-37></a>
<a id=__codelineno-27-38 name=__codelineno-27-38 href=#__codelineno-27-38></a><span class=nt>automations</span><span class=p>:</span>
<a id=__codelineno-27-39 name=__codelineno-27-39 href=#__codelineno-27-39></a><span class=w>  </span><span class=nt>has_jira_issue</span><span class=p>:</span><span class=w> </span>
<a id=__codelineno-27-40 name=__codelineno-27-40 href=#__codelineno-27-40></a><span class=w>    </span><span class=nt>if</span><span class=p>:</span>
<a id=__codelineno-27-41 name=__codelineno-27-41 href=#__codelineno-27-41></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=k>not</span> <span class=nv>has_jira_issue</span> <span class=cp>}}</span>
<a id=__codelineno-27-42 name=__codelineno-27-42 href=#__codelineno-27-42></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span>
<a id=__codelineno-27-43 name=__codelineno-27-43 href=#__codelineno-27-43></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">add-comment@v1</span>
<a id=__codelineno-27-44 name=__codelineno-27-44 href=#__codelineno-27-44></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-27-45 name=__codelineno-27-45 href=#__codelineno-27-45></a><span class=w>          </span><span class=nt>comment</span><span class=p>:</span><span class=w> </span><span class=s>&quot;This</span><span class=nv> </span><span class=s>PR</span><span class=nv> </span><span class=s>is</span><span class=nv> </span><span class=s>missing</span><span class=nv> </span><span class=s>a</span><span class=nv> </span><span class=s>related</span><span class=nv> </span><span class=s>issue</span><span class=nv> </span><span class=s>in</span><span class=nv> </span><span class=s>Jira.</span><span class=nv> </span><span class=s>Please</span><span class=nv> </span><span class=s>create</span><span class=nv> </span><span class=s>a</span><span class=nv> </span><span class=s>Jira</span><span class=nv> </span><span class=s>task.&quot;</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <p><a href=https://github.com/linear-b/gitstream/tree/main/plugins/filters/hasJiraIssue>Download Source Code</a></p> <p><a name=module_isFlaggedUser></a></p> <h2 id=isflaggeduser>isFlaggedUser</h2> <p>Returns true if the username that is passed to this function is specified in a predefined list of users. This is useful if you want gitStream automations to run only for specified users.</p> <p><strong>Returns</strong>: <code>boolean</code> - Returns true if the user is specified in the flaggedUsers list, otherwise false.<br> <strong>License</strong>: MIT </p> <table> <thead> <tr> <th>Param</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>Input</td> <td><code>string</code></td> <td>The GitHub username to check.</td> </tr> </tbody> </table> <p><strong>Example</strong><br> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=p>{{</span><span class=w> </span><span class=nx>pr</span><span class=p>.</span><span class=nx>author</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=nx>isFlaggedUser</span><span class=w> </span><span class=p>}}</span>
</code></pre></div></p> <details class=note> <summary>Plugin Code: isFlaggedUser</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=c1>// Add users who you want to add to the flag list.</span>
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=kd>const</span><span class=w> </span><span class=nx>flaggedUsers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;user1&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;user2&quot;</span><span class=p>];</span>
<a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=cm>/**</span>
<a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=cm> * @module isFlaggedUser</span>
<a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=cm> * @description Returns true if the username that is passed to this function is specified in a predefined list of users. </span>
<a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=cm> * This is useful if you want gitStream automations to run only for specified users.</span>
<a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=cm> * @param {string} Input - The GitHub username to check.</span>
<a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=cm> * @returns {boolean} Returns true if the user is specified in the flaggedUsers list, otherwise false.</span>
<a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a><span class=cm> * @example {{ pr.author | isFlaggedUser }}</span>
<a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=cm> * @license MIT</span>
<a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a><span class=cm> */</span>
<a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a><span class=kd>function</span><span class=w> </span><span class=nx>isFlaggedUser</span><span class=p>(</span><span class=nx>username</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>flaggedUsers</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>username</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span>
<a id=__codelineno-29-15 name=__codelineno-29-15 href=#__codelineno-29-15></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-29-16 name=__codelineno-29-16 href=#__codelineno-29-16></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>
<a id=__codelineno-29-17 name=__codelineno-29-17 href=#__codelineno-29-17></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-29-18 name=__codelineno-29-18 href=#__codelineno-29-18></a><span class=p>};</span>
<a id=__codelineno-29-19 name=__codelineno-29-19 href=#__codelineno-29-19></a>
<a id=__codelineno-29-20 name=__codelineno-29-20 href=#__codelineno-29-20></a><span class=kd>function</span><span class=w> </span><span class=nx>containsString</span><span class=p>(</span><span class=nx>arr</span><span class=p>,</span><span class=w> </span><span class=nx>str</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-29-21 name=__codelineno-29-21 href=#__codelineno-29-21></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>arr</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>str</span><span class=p>);</span>
<a id=__codelineno-29-22 name=__codelineno-29-22 href=#__codelineno-29-22></a><span class=p>};</span>
<a id=__codelineno-29-23 name=__codelineno-29-23 href=#__codelineno-29-23></a>
<a id=__codelineno-29-24 name=__codelineno-29-24 href=#__codelineno-29-24></a><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>isFlaggedUser</span><span class=p>;</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <details class=example> <summary>gitStream CM Example: isFlaggedUser</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=c1># -*- mode: yaml -*-</span>
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=nt>manifest</span><span class=p>:</span>
<a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a>
<a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a><span class=nt>automations</span><span class=p>:</span>
<a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=w>  </span><span class=nt>detect_flagged_user</span><span class=p>:</span>
<a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=w>    </span><span class=nt>if</span><span class=p>:</span>
<a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=nv>pr.author</span> <span class=o>|</span> <span class=nf>isFlaggedUser</span> <span class=cp>}}</span>
<a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span>
<a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">add-comment@v1</span>
<a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a><span class=w>          </span><span class=nt>comment</span><span class=p>:</span><span class=w> </span><span class=cp>{{</span> <span class=nv>pr.author</span> <span class=cp>}}</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">is a gitStream user.</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <p><a href=https://github.com/linear-b/gitstream/tree/main/plugins/filters/isFlaggedUser>Download Source Code</a></p> <p><a name=module_readMarkdownWithLinks></a></p> <h2 id=readmarkdownwithlinks>readMarkdownWithLinks</h2> <p>Reads a markdown file and follows internal links to create a comprehensive document view. Prevents circular references and supports configurable depth limits.</p> <p><strong>Returns</strong>: <code>string</code> - Combined content of the file and all linked files with headers, or structured object if structured option is true<br> <strong>License</strong>: MIT </p> <table> <thead> <tr> <th>Param</th> <th>Type</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>filePath</td> <td><code>string</code></td> <td></td> <td>Path to the markdown file to read</td> </tr> <tr> <td>[options]</td> <td><code>Object</code></td> <td><code>{}</code></td> <td>Configuration options for link following</td> </tr> <tr> <td>[options.followLinks]</td> <td><code>boolean</code></td> <td><code>true</code></td> <td>Whether to follow internal markdown links</td> </tr> <tr> <td>[options.maxDepth]</td> <td><code>number</code></td> <td><code>3</code></td> <td>Maximum depth to follow links to prevent excessive recursion</td> </tr> <tr> <td>[options.structured]</td> <td><code>boolean</code></td> <td><code>false</code></td> <td>Return structured data instead of combined text</td> </tr> </tbody> </table> <p><strong>Example</strong><br> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=p>{{</span><span class=w> </span><span class=s2>&quot;docs/README.md&quot;</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=nx>readMarkdownWithLinks</span><span class=w> </span><span class=p>}}</span>
</code></pre></div> <strong>Example</strong><br> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=p>{{</span><span class=w> </span><span class=s2>&quot;docs/README.md&quot;</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=nx>readMarkdownWithLinks</span><span class=p>(</span><span class=nx>maxDepth</span><span class=o>=</span><span class=mf>2</span><span class=p>)</span><span class=w> </span><span class=p>}}</span>
</code></pre></div></p> <details class=note> <summary>Plugin Code: readMarkdownWithLinks</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>);</span>
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=kd>const</span><span class=w> </span><span class=nx>path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>);</span>
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>
<a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=cm>/**</span>
<a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=cm> * Safely read file with path traversal protection</span>
<a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=cm> * @param {string} filePath - Path to file to read</span>
<a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=cm> * @returns {string|null} File content or null if error/invalid path</span>
<a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=cm> */</span>
<a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a><span class=kd>function</span><span class=w> </span><span class=nx>readFile</span><span class=p>(</span><span class=nx>filePath</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=w>  </span><span class=c1>// Whitelist: only allow relative paths within current directory</span>
<a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>normalizedPath</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>path</span><span class=p>.</span><span class=nx>normalize</span><span class=p>(</span><span class=nx>filePath</span><span class=p>);</span>
<a id=__codelineno-33-12 name=__codelineno-33-12 href=#__codelineno-33-12></a>
<a id=__codelineno-33-13 name=__codelineno-33-13 href=#__codelineno-33-13></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>path</span><span class=p>.</span><span class=nx>isAbsolute</span><span class=p>(</span><span class=nx>normalizedPath</span><span class=p>)</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nx>normalizedPath</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;..&#39;</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-14 name=__codelineno-33-14 href=#__codelineno-33-14></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Invalid path: </span><span class=si>${</span><span class=nx>filePath</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
<a id=__codelineno-33-15 name=__codelineno-33-15 href=#__codelineno-33-15></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span>
<a id=__codelineno-33-16 name=__codelineno-33-16 href=#__codelineno-33-16></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-33-17 name=__codelineno-33-17 href=#__codelineno-33-17></a>
<a id=__codelineno-33-18 name=__codelineno-33-18 href=#__codelineno-33-18></a><span class=w>  </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-19 name=__codelineno-33-19 href=#__codelineno-33-19></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>fs</span><span class=p>.</span><span class=nx>readFileSync</span><span class=p>(</span><span class=nx>normalizedPath</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;utf8&#39;</span><span class=p>);</span>
<a id=__codelineno-33-20 name=__codelineno-33-20 href=#__codelineno-33-20></a><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-21 name=__codelineno-33-21 href=#__codelineno-33-21></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Error reading file </span><span class=si>${</span><span class=nx>filePath</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
<a id=__codelineno-33-22 name=__codelineno-33-22 href=#__codelineno-33-22></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span>
<a id=__codelineno-33-23 name=__codelineno-33-23 href=#__codelineno-33-23></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-33-24 name=__codelineno-33-24 href=#__codelineno-33-24></a><span class=p>}</span>
<a id=__codelineno-33-25 name=__codelineno-33-25 href=#__codelineno-33-25></a>
<a id=__codelineno-33-26 name=__codelineno-33-26 href=#__codelineno-33-26></a><span class=cm>/**</span>
<a id=__codelineno-33-27 name=__codelineno-33-27 href=#__codelineno-33-27></a><span class=cm> * Extract internal markdown links from content</span>
<a id=__codelineno-33-28 name=__codelineno-33-28 href=#__codelineno-33-28></a><span class=cm> * Matches patterns like [text](./file.md) or [text](../file.md) or [text](file.md)</span>
<a id=__codelineno-33-29 name=__codelineno-33-29 href=#__codelineno-33-29></a><span class=cm> * @param {string} content - The markdown content to scan for links</span>
<a id=__codelineno-33-30 name=__codelineno-33-30 href=#__codelineno-33-30></a><span class=cm> * @param {string} basePath - Base directory path for resolving relative links</span>
<a id=__codelineno-33-31 name=__codelineno-33-31 href=#__codelineno-33-31></a><span class=cm> * @returns {Array} Array of link objects with text, path, and resolvedPath</span>
<a id=__codelineno-33-32 name=__codelineno-33-32 href=#__codelineno-33-32></a><span class=cm> */</span>
<a id=__codelineno-33-33 name=__codelineno-33-33 href=#__codelineno-33-33></a><span class=kd>function</span><span class=w> </span><span class=nx>extractInternalLinks</span><span class=p>(</span><span class=nx>content</span><span class=p>,</span><span class=w> </span><span class=nx>basePath</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-34 name=__codelineno-33-34 href=#__codelineno-33-34></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>linkRegex</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sr>/\[([^\]]+)\]\(([^)]+)\)/g</span><span class=p>;</span>
<a id=__codelineno-33-35 name=__codelineno-33-35 href=#__codelineno-33-35></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>internalLinks</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[];</span>
<a id=__codelineno-33-36 name=__codelineno-33-36 href=#__codelineno-33-36></a><span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=nx>match</span><span class=p>;</span>
<a id=__codelineno-33-37 name=__codelineno-33-37 href=#__codelineno-33-37></a>
<a id=__codelineno-33-38 name=__codelineno-33-38 href=#__codelineno-33-38></a><span class=w>  </span><span class=k>while</span><span class=w> </span><span class=p>((</span><span class=nx>match</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>linkRegex</span><span class=p>.</span><span class=nx>exec</span><span class=p>(</span><span class=nx>content</span><span class=p>))</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-39 name=__codelineno-33-39 href=#__codelineno-33-39></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>linkText</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>match</span><span class=p>[</span><span class=mf>1</span><span class=p>];</span>
<a id=__codelineno-33-40 name=__codelineno-33-40 href=#__codelineno-33-40></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>linkPath</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>match</span><span class=p>[</span><span class=mf>2</span><span class=p>];</span>
<a id=__codelineno-33-41 name=__codelineno-33-41 href=#__codelineno-33-41></a>
<a id=__codelineno-33-42 name=__codelineno-33-42 href=#__codelineno-33-42></a><span class=w>    </span><span class=c1>// Check if it&#39;s an internal link (not http/https and ends with .md)</span>
<a id=__codelineno-33-43 name=__codelineno-33-43 href=#__codelineno-33-43></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>linkPath</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>)</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>linkPath</span><span class=p>.</span><span class=nx>endsWith</span><span class=p>(</span><span class=s1>&#39;.md&#39;</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-44 name=__codelineno-33-44 href=#__codelineno-33-44></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>resolvedPath</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=nx>basePath</span><span class=p>,</span><span class=w> </span><span class=nx>linkPath</span><span class=p>);</span>
<a id=__codelineno-33-45 name=__codelineno-33-45 href=#__codelineno-33-45></a><span class=w>      </span><span class=nx>internalLinks</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span>
<a id=__codelineno-33-46 name=__codelineno-33-46 href=#__codelineno-33-46></a><span class=w>        </span><span class=nx>text</span><span class=o>:</span><span class=w> </span><span class=nx>linkText</span><span class=p>,</span>
<a id=__codelineno-33-47 name=__codelineno-33-47 href=#__codelineno-33-47></a><span class=w>        </span><span class=nx>path</span><span class=o>:</span><span class=w> </span><span class=nx>linkPath</span><span class=p>,</span>
<a id=__codelineno-33-48 name=__codelineno-33-48 href=#__codelineno-33-48></a><span class=w>        </span><span class=nx>resolvedPath</span><span class=o>:</span><span class=w> </span><span class=nx>resolvedPath</span>
<a id=__codelineno-33-49 name=__codelineno-33-49 href=#__codelineno-33-49></a><span class=w>      </span><span class=p>});</span>
<a id=__codelineno-33-50 name=__codelineno-33-50 href=#__codelineno-33-50></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-33-51 name=__codelineno-33-51 href=#__codelineno-33-51></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-33-52 name=__codelineno-33-52 href=#__codelineno-33-52></a>
<a id=__codelineno-33-53 name=__codelineno-33-53 href=#__codelineno-33-53></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>internalLinks</span><span class=p>;</span>
<a id=__codelineno-33-54 name=__codelineno-33-54 href=#__codelineno-33-54></a><span class=p>}</span>
<a id=__codelineno-33-55 name=__codelineno-33-55 href=#__codelineno-33-55></a>
<a id=__codelineno-33-56 name=__codelineno-33-56 href=#__codelineno-33-56></a><span class=cm>/**</span>
<a id=__codelineno-33-57 name=__codelineno-33-57 href=#__codelineno-33-57></a><span class=cm> * Read markdown file and follow internal links</span>
<a id=__codelineno-33-58 name=__codelineno-33-58 href=#__codelineno-33-58></a><span class=cm> * @param {string} filePath - Path to the markdown file</span>
<a id=__codelineno-33-59 name=__codelineno-33-59 href=#__codelineno-33-59></a><span class=cm> * @param {Object} options - Configuration options</span>
<a id=__codelineno-33-60 name=__codelineno-33-60 href=#__codelineno-33-60></a><span class=cm> * @param {boolean} options.followLinks - Whether to follow internal links (default: true)</span>
<a id=__codelineno-33-61 name=__codelineno-33-61 href=#__codelineno-33-61></a><span class=cm> * @param {number} options.maxDepth - Maximum depth to follow links (default: 3)</span>
<a id=__codelineno-33-62 name=__codelineno-33-62 href=#__codelineno-33-62></a><span class=cm> * @param {Set} options.visited - Internal set to track visited files (prevent cycles)</span>
<a id=__codelineno-33-63 name=__codelineno-33-63 href=#__codelineno-33-63></a><span class=cm> * @param {number} options.currentDepth - Current depth (internal)</span>
<a id=__codelineno-33-64 name=__codelineno-33-64 href=#__codelineno-33-64></a><span class=cm> * @returns {Object} Object containing content and linked files</span>
<a id=__codelineno-33-65 name=__codelineno-33-65 href=#__codelineno-33-65></a><span class=cm> */</span>
<a id=__codelineno-33-66 name=__codelineno-33-66 href=#__codelineno-33-66></a><span class=kd>function</span><span class=w> </span><span class=nx>readMarkdown</span><span class=p>(</span><span class=nx>filePath</span><span class=p>,</span><span class=w> </span><span class=nx>options</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{})</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-67 name=__codelineno-33-67 href=#__codelineno-33-67></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-68 name=__codelineno-33-68 href=#__codelineno-33-68></a><span class=w>    </span><span class=nx>followLinks</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-33-69 name=__codelineno-33-69 href=#__codelineno-33-69></a><span class=w>    </span><span class=nx>maxDepth</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>3</span><span class=p>,</span>
<a id=__codelineno-33-70 name=__codelineno-33-70 href=#__codelineno-33-70></a><span class=w>    </span><span class=nx>visited</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Set</span><span class=p>(),</span>
<a id=__codelineno-33-71 name=__codelineno-33-71 href=#__codelineno-33-71></a><span class=w>    </span><span class=nx>currentDepth</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0</span>
<a id=__codelineno-33-72 name=__codelineno-33-72 href=#__codelineno-33-72></a><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>options</span><span class=p>;</span>
<a id=__codelineno-33-73 name=__codelineno-33-73 href=#__codelineno-33-73></a>
<a id=__codelineno-33-74 name=__codelineno-33-74 href=#__codelineno-33-74></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>normalizedPath</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>path</span><span class=p>.</span><span class=nx>normalize</span><span class=p>(</span><span class=nx>filePath</span><span class=p>);</span>
<a id=__codelineno-33-75 name=__codelineno-33-75 href=#__codelineno-33-75></a>
<a id=__codelineno-33-76 name=__codelineno-33-76 href=#__codelineno-33-76></a><span class=w>  </span><span class=c1>// Check if we&#39;ve already visited this file (prevent cycles)</span>
<a id=__codelineno-33-77 name=__codelineno-33-77 href=#__codelineno-33-77></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>visited</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>normalizedPath</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-78 name=__codelineno-33-78 href=#__codelineno-33-78></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-79 name=__codelineno-33-79 href=#__codelineno-33-79></a><span class=w>      </span><span class=nx>path</span><span class=o>:</span><span class=w> </span><span class=nx>normalizedPath</span><span class=p>,</span>
<a id=__codelineno-33-80 name=__codelineno-33-80 href=#__codelineno-33-80></a><span class=w>      </span><span class=nx>content</span><span class=o>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
<a id=__codelineno-33-81 name=__codelineno-33-81 href=#__codelineno-33-81></a><span class=w>      </span><span class=nx>error</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Circular reference detected&#39;</span><span class=p>,</span>
<a id=__codelineno-33-82 name=__codelineno-33-82 href=#__codelineno-33-82></a><span class=w>      </span><span class=nx>linkedFiles</span><span class=o>:</span><span class=w> </span><span class=p>[]</span>
<a id=__codelineno-33-83 name=__codelineno-33-83 href=#__codelineno-33-83></a><span class=w>    </span><span class=p>};</span>
<a id=__codelineno-33-84 name=__codelineno-33-84 href=#__codelineno-33-84></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-33-85 name=__codelineno-33-85 href=#__codelineno-33-85></a>
<a id=__codelineno-33-86 name=__codelineno-33-86 href=#__codelineno-33-86></a><span class=w>  </span><span class=c1>// Check depth limit</span>
<a id=__codelineno-33-87 name=__codelineno-33-87 href=#__codelineno-33-87></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>currentDepth</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=nx>maxDepth</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-88 name=__codelineno-33-88 href=#__codelineno-33-88></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-89 name=__codelineno-33-89 href=#__codelineno-33-89></a><span class=w>      </span><span class=nx>path</span><span class=o>:</span><span class=w> </span><span class=nx>normalizedPath</span><span class=p>,</span>
<a id=__codelineno-33-90 name=__codelineno-33-90 href=#__codelineno-33-90></a><span class=w>      </span><span class=nx>content</span><span class=o>:</span><span class=w> </span><span class=nx>readFile</span><span class=p>(</span><span class=nx>normalizedPath</span><span class=p>),</span>
<a id=__codelineno-33-91 name=__codelineno-33-91 href=#__codelineno-33-91></a><span class=w>      </span><span class=nx>error</span><span class=o>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
<a id=__codelineno-33-92 name=__codelineno-33-92 href=#__codelineno-33-92></a><span class=w>      </span><span class=nx>linkedFiles</span><span class=o>:</span><span class=w> </span><span class=p>[],</span>
<a id=__codelineno-33-93 name=__codelineno-33-93 href=#__codelineno-33-93></a><span class=w>      </span><span class=nx>depthLimitReached</span><span class=o>:</span><span class=w> </span><span class=kc>true</span>
<a id=__codelineno-33-94 name=__codelineno-33-94 href=#__codelineno-33-94></a><span class=w>    </span><span class=p>};</span>
<a id=__codelineno-33-95 name=__codelineno-33-95 href=#__codelineno-33-95></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-33-96 name=__codelineno-33-96 href=#__codelineno-33-96></a>
<a id=__codelineno-33-97 name=__codelineno-33-97 href=#__codelineno-33-97></a><span class=w>  </span><span class=c1>// Mark this file as visited</span>
<a id=__codelineno-33-98 name=__codelineno-33-98 href=#__codelineno-33-98></a><span class=w>  </span><span class=nx>visited</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>normalizedPath</span><span class=p>);</span>
<a id=__codelineno-33-99 name=__codelineno-33-99 href=#__codelineno-33-99></a>
<a id=__codelineno-33-100 name=__codelineno-33-100 href=#__codelineno-33-100></a><span class=w>  </span><span class=c1>// Read the main file content</span>
<a id=__codelineno-33-101 name=__codelineno-33-101 href=#__codelineno-33-101></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>readFile</span><span class=p>(</span><span class=nx>normalizedPath</span><span class=p>);</span>
<a id=__codelineno-33-102 name=__codelineno-33-102 href=#__codelineno-33-102></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>content</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-103 name=__codelineno-33-103 href=#__codelineno-33-103></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-104 name=__codelineno-33-104 href=#__codelineno-33-104></a><span class=w>      </span><span class=nx>path</span><span class=o>:</span><span class=w> </span><span class=nx>normalizedPath</span><span class=p>,</span>
<a id=__codelineno-33-105 name=__codelineno-33-105 href=#__codelineno-33-105></a><span class=w>      </span><span class=nx>content</span><span class=o>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
<a id=__codelineno-33-106 name=__codelineno-33-106 href=#__codelineno-33-106></a><span class=w>      </span><span class=nx>error</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;File not found or could not be read&#39;</span><span class=p>,</span>
<a id=__codelineno-33-107 name=__codelineno-33-107 href=#__codelineno-33-107></a><span class=w>      </span><span class=nx>linkedFiles</span><span class=o>:</span><span class=w> </span><span class=p>[]</span>
<a id=__codelineno-33-108 name=__codelineno-33-108 href=#__codelineno-33-108></a><span class=w>    </span><span class=p>};</span>
<a id=__codelineno-33-109 name=__codelineno-33-109 href=#__codelineno-33-109></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-33-110 name=__codelineno-33-110 href=#__codelineno-33-110></a>
<a id=__codelineno-33-111 name=__codelineno-33-111 href=#__codelineno-33-111></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-112 name=__codelineno-33-112 href=#__codelineno-33-112></a><span class=w>    </span><span class=nx>path</span><span class=o>:</span><span class=w> </span><span class=nx>normalizedPath</span><span class=p>,</span>
<a id=__codelineno-33-113 name=__codelineno-33-113 href=#__codelineno-33-113></a><span class=w>    </span><span class=nx>content</span><span class=o>:</span><span class=w> </span><span class=nx>content</span><span class=p>,</span>
<a id=__codelineno-33-114 name=__codelineno-33-114 href=#__codelineno-33-114></a><span class=w>    </span><span class=nx>error</span><span class=o>:</span><span class=w> </span><span class=kc>null</span><span class=p>,</span>
<a id=__codelineno-33-115 name=__codelineno-33-115 href=#__codelineno-33-115></a><span class=w>    </span><span class=nx>linkedFiles</span><span class=o>:</span><span class=w> </span><span class=p>[]</span>
<a id=__codelineno-33-116 name=__codelineno-33-116 href=#__codelineno-33-116></a><span class=w>  </span><span class=p>};</span>
<a id=__codelineno-33-117 name=__codelineno-33-117 href=#__codelineno-33-117></a>
<a id=__codelineno-33-118 name=__codelineno-33-118 href=#__codelineno-33-118></a><span class=w>  </span><span class=c1>// If we should follow links, extract and process them</span>
<a id=__codelineno-33-119 name=__codelineno-33-119 href=#__codelineno-33-119></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>followLinks</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-120 name=__codelineno-33-120 href=#__codelineno-33-120></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>basePath</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>path</span><span class=p>.</span><span class=nx>dirname</span><span class=p>(</span><span class=nx>normalizedPath</span><span class=p>);</span>
<a id=__codelineno-33-121 name=__codelineno-33-121 href=#__codelineno-33-121></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>internalLinks</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>extractInternalLinks</span><span class=p>(</span><span class=nx>content</span><span class=p>,</span><span class=w> </span><span class=nx>basePath</span><span class=p>);</span>
<a id=__codelineno-33-122 name=__codelineno-33-122 href=#__codelineno-33-122></a>
<a id=__codelineno-33-123 name=__codelineno-33-123 href=#__codelineno-33-123></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kd>const</span><span class=w> </span><span class=nx>link</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=nx>internalLinks</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-124 name=__codelineno-33-124 href=#__codelineno-33-124></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>linkedFileResult</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>readMarkdown</span><span class=p>(</span><span class=nx>link</span><span class=p>.</span><span class=nx>resolvedPath</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-125 name=__codelineno-33-125 href=#__codelineno-33-125></a><span class=w>        </span><span class=nx>followLinks</span><span class=p>,</span>
<a id=__codelineno-33-126 name=__codelineno-33-126 href=#__codelineno-33-126></a><span class=w>        </span><span class=nx>maxDepth</span><span class=p>,</span>
<a id=__codelineno-33-127 name=__codelineno-33-127 href=#__codelineno-33-127></a><span class=w>        </span><span class=nx>visited</span><span class=o>:</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Set</span><span class=p>(</span><span class=nx>visited</span><span class=p>),</span><span class=w> </span><span class=c1>// Create a new set for each branch</span>
<a id=__codelineno-33-128 name=__codelineno-33-128 href=#__codelineno-33-128></a><span class=w>        </span><span class=nx>currentDepth</span><span class=o>:</span><span class=w> </span><span class=nx>currentDepth</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>1</span>
<a id=__codelineno-33-129 name=__codelineno-33-129 href=#__codelineno-33-129></a><span class=w>      </span><span class=p>});</span>
<a id=__codelineno-33-130 name=__codelineno-33-130 href=#__codelineno-33-130></a>
<a id=__codelineno-33-131 name=__codelineno-33-131 href=#__codelineno-33-131></a><span class=w>      </span><span class=nx>result</span><span class=p>.</span><span class=nx>linkedFiles</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span>
<a id=__codelineno-33-132 name=__codelineno-33-132 href=#__codelineno-33-132></a><span class=w>        </span><span class=nx>linkText</span><span class=o>:</span><span class=w> </span><span class=nx>link</span><span class=p>.</span><span class=nx>text</span><span class=p>,</span>
<a id=__codelineno-33-133 name=__codelineno-33-133 href=#__codelineno-33-133></a><span class=w>        </span><span class=nx>originalPath</span><span class=o>:</span><span class=w> </span><span class=nx>link</span><span class=p>.</span><span class=nx>path</span><span class=p>,</span>
<a id=__codelineno-33-134 name=__codelineno-33-134 href=#__codelineno-33-134></a><span class=w>        </span><span class=p>...</span><span class=nx>linkedFileResult</span>
<a id=__codelineno-33-135 name=__codelineno-33-135 href=#__codelineno-33-135></a><span class=w>      </span><span class=p>});</span>
<a id=__codelineno-33-136 name=__codelineno-33-136 href=#__codelineno-33-136></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-33-137 name=__codelineno-33-137 href=#__codelineno-33-137></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-33-138 name=__codelineno-33-138 href=#__codelineno-33-138></a>
<a id=__codelineno-33-139 name=__codelineno-33-139 href=#__codelineno-33-139></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>result</span><span class=p>;</span>
<a id=__codelineno-33-140 name=__codelineno-33-140 href=#__codelineno-33-140></a><span class=p>}</span>
<a id=__codelineno-33-141 name=__codelineno-33-141 href=#__codelineno-33-141></a>
<a id=__codelineno-33-142 name=__codelineno-33-142 href=#__codelineno-33-142></a><span class=cm>/**</span>
<a id=__codelineno-33-143 name=__codelineno-33-143 href=#__codelineno-33-143></a><span class=cm> * @module readMarkdownWithLinks</span>
<a id=__codelineno-33-144 name=__codelineno-33-144 href=#__codelineno-33-144></a><span class=cm> * @description Reads a markdown file and follows internal links to create a comprehensive document view. </span>
<a id=__codelineno-33-145 name=__codelineno-33-145 href=#__codelineno-33-145></a><span class=cm> * Prevents circular references and supports configurable depth limits.</span>
<a id=__codelineno-33-146 name=__codelineno-33-146 href=#__codelineno-33-146></a><span class=cm> * @param {string} filePath - Path to the markdown file to read</span>
<a id=__codelineno-33-147 name=__codelineno-33-147 href=#__codelineno-33-147></a><span class=cm> * @param {Object} [options={}] - Configuration options for link following</span>
<a id=__codelineno-33-148 name=__codelineno-33-148 href=#__codelineno-33-148></a><span class=cm> * @param {boolean} [options.followLinks=true] - Whether to follow internal links</span>
<a id=__codelineno-33-149 name=__codelineno-33-149 href=#__codelineno-33-149></a><span class=cm> * @param {number} [options.maxDepth=3] - Maximum depth to follow links  </span>
<a id=__codelineno-33-150 name=__codelineno-33-150 href=#__codelineno-33-150></a><span class=cm> * @param {boolean} [options.structured=false] - Return structured data instead of combined text</span>
<a id=__codelineno-33-151 name=__codelineno-33-151 href=#__codelineno-33-151></a><span class=cm> * @returns {string} Combined content of the file and all linked files with headers</span>
<a id=__codelineno-33-152 name=__codelineno-33-152 href=#__codelineno-33-152></a><span class=cm> * @example {{ &quot;docs/README.md&quot; | readMarkdownWithLinks }}</span>
<a id=__codelineno-33-153 name=__codelineno-33-153 href=#__codelineno-33-153></a><span class=cm> * @example {{ &quot;docs/README.md&quot; | readMarkdownWithLinks(maxDepth=2) }}</span>
<a id=__codelineno-33-154 name=__codelineno-33-154 href=#__codelineno-33-154></a><span class=cm> * @license MIT</span>
<a id=__codelineno-33-155 name=__codelineno-33-155 href=#__codelineno-33-155></a><span class=cm> */</span>
<a id=__codelineno-33-156 name=__codelineno-33-156 href=#__codelineno-33-156></a><span class=kd>function</span><span class=w> </span><span class=nx>readMarkdownWithLinks</span><span class=p>(</span><span class=nx>filePath</span><span class=p>,</span><span class=w> </span><span class=nx>options</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{})</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-157 name=__codelineno-33-157 href=#__codelineno-33-157></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-158 name=__codelineno-33-158 href=#__codelineno-33-158></a><span class=w>    </span><span class=nx>followLinks</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-33-159 name=__codelineno-33-159 href=#__codelineno-33-159></a><span class=w>    </span><span class=nx>maxDepth</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>3</span><span class=p>,</span>
<a id=__codelineno-33-160 name=__codelineno-33-160 href=#__codelineno-33-160></a><span class=w>    </span><span class=nx>structured</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span>
<a id=__codelineno-33-161 name=__codelineno-33-161 href=#__codelineno-33-161></a><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>options</span><span class=p>;</span>
<a id=__codelineno-33-162 name=__codelineno-33-162 href=#__codelineno-33-162></a>
<a id=__codelineno-33-163 name=__codelineno-33-163 href=#__codelineno-33-163></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>readMarkdown</span><span class=p>(</span><span class=nx>filePath</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-164 name=__codelineno-33-164 href=#__codelineno-33-164></a><span class=w>    </span><span class=nx>followLinks</span><span class=p>,</span>
<a id=__codelineno-33-165 name=__codelineno-33-165 href=#__codelineno-33-165></a><span class=w>    </span><span class=nx>maxDepth</span><span class=p>,</span>
<a id=__codelineno-33-166 name=__codelineno-33-166 href=#__codelineno-33-166></a><span class=w>    </span><span class=nx>visited</span><span class=o>:</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Set</span><span class=p>(),</span>
<a id=__codelineno-33-167 name=__codelineno-33-167 href=#__codelineno-33-167></a><span class=w>    </span><span class=nx>currentDepth</span><span class=o>:</span><span class=w> </span><span class=mf>0</span>
<a id=__codelineno-33-168 name=__codelineno-33-168 href=#__codelineno-33-168></a><span class=w>  </span><span class=p>});</span>
<a id=__codelineno-33-169 name=__codelineno-33-169 href=#__codelineno-33-169></a>
<a id=__codelineno-33-170 name=__codelineno-33-170 href=#__codelineno-33-170></a><span class=w>  </span><span class=c1>// Return structured data if requested</span>
<a id=__codelineno-33-171 name=__codelineno-33-171 href=#__codelineno-33-171></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>structured</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-172 name=__codelineno-33-172 href=#__codelineno-33-172></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>result</span><span class=p>;</span>
<a id=__codelineno-33-173 name=__codelineno-33-173 href=#__codelineno-33-173></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-33-174 name=__codelineno-33-174 href=#__codelineno-33-174></a>
<a id=__codelineno-33-175 name=__codelineno-33-175 href=#__codelineno-33-175></a><span class=w>  </span><span class=c1>// Otherwise return combined content</span>
<a id=__codelineno-33-176 name=__codelineno-33-176 href=#__codelineno-33-176></a><span class=w>  </span><span class=kd>function</span><span class=w> </span><span class=nx>combineContent</span><span class=p>(</span><span class=nx>fileResult</span><span class=p>,</span><span class=w> </span><span class=nx>depth</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-177 name=__codelineno-33-177 href=#__codelineno-33-177></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>indent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;  &#39;</span><span class=p>.</span><span class=nx>repeat</span><span class=p>(</span><span class=nx>depth</span><span class=p>);</span>
<a id=__codelineno-33-178 name=__codelineno-33-178 href=#__codelineno-33-178></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=nx>combined</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>;</span>
<a id=__codelineno-33-179 name=__codelineno-33-179 href=#__codelineno-33-179></a>
<a id=__codelineno-33-180 name=__codelineno-33-180 href=#__codelineno-33-180></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>fileResult</span><span class=p>.</span><span class=nx>content</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-181 name=__codelineno-33-181 href=#__codelineno-33-181></a><span class=w>      </span><span class=nx>combined</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=sb>`</span><span class=si>${</span><span class=nx>indent</span><span class=si>}</span><span class=sb>=== </span><span class=si>${</span><span class=nx>path</span><span class=p>.</span><span class=nx>basename</span><span class=p>(</span><span class=nx>fileResult</span><span class=p>.</span><span class=nx>path</span><span class=p>)</span><span class=si>}</span><span class=sb> ===\n`</span><span class=p>;</span>
<a id=__codelineno-33-182 name=__codelineno-33-182 href=#__codelineno-33-182></a><span class=w>      </span><span class=nx>combined</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=nx>fileResult</span><span class=p>.</span><span class=nx>content</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;\n\n&#39;</span><span class=p>;</span>
<a id=__codelineno-33-183 name=__codelineno-33-183 href=#__codelineno-33-183></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-33-184 name=__codelineno-33-184 href=#__codelineno-33-184></a>
<a id=__codelineno-33-185 name=__codelineno-33-185 href=#__codelineno-33-185></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>fileResult</span><span class=p>.</span><span class=nx>linkedFiles</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-186 name=__codelineno-33-186 href=#__codelineno-33-186></a><span class=w>      </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kd>const</span><span class=w> </span><span class=nx>linkedFile</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=nx>fileResult</span><span class=p>.</span><span class=nx>linkedFiles</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-187 name=__codelineno-33-187 href=#__codelineno-33-187></a><span class=w>        </span><span class=nx>combined</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=nx>combineContent</span><span class=p>(</span><span class=nx>linkedFile</span><span class=p>,</span><span class=w> </span><span class=nx>depth</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>1</span><span class=p>);</span>
<a id=__codelineno-33-188 name=__codelineno-33-188 href=#__codelineno-33-188></a><span class=w>      </span><span class=p>}</span>
<a id=__codelineno-33-189 name=__codelineno-33-189 href=#__codelineno-33-189></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-33-190 name=__codelineno-33-190 href=#__codelineno-33-190></a>
<a id=__codelineno-33-191 name=__codelineno-33-191 href=#__codelineno-33-191></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>combined</span><span class=p>;</span>
<a id=__codelineno-33-192 name=__codelineno-33-192 href=#__codelineno-33-192></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-33-193 name=__codelineno-33-193 href=#__codelineno-33-193></a>
<a id=__codelineno-33-194 name=__codelineno-33-194 href=#__codelineno-33-194></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>combineContent</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>
<a id=__codelineno-33-195 name=__codelineno-33-195 href=#__codelineno-33-195></a><span class=p>}</span>
<a id=__codelineno-33-196 name=__codelineno-33-196 href=#__codelineno-33-196></a>
<a id=__codelineno-33-197 name=__codelineno-33-197 href=#__codelineno-33-197></a><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>readMarkdownWithLinks</span><span class=p>;</span>
<a id=__codelineno-33-198 name=__codelineno-33-198 href=#__codelineno-33-198></a>
<a id=__codelineno-33-199 name=__codelineno-33-199 href=#__codelineno-33-199></a>
<a id=__codelineno-33-200 name=__codelineno-33-200 href=#__codelineno-33-200></a>
<a id=__codelineno-33-201 name=__codelineno-33-201 href=#__codelineno-33-201></a>
<a id=__codelineno-33-202 name=__codelineno-33-202 href=#__codelineno-33-202></a><span class=c1>// ============================================================================</span>
<a id=__codelineno-33-203 name=__codelineno-33-203 href=#__codelineno-33-203></a><span class=c1>// TESTS (for local development only)</span>
<a id=__codelineno-33-204 name=__codelineno-33-204 href=#__codelineno-33-204></a><span class=c1>// ============================================================================</span>
<a id=__codelineno-33-205 name=__codelineno-33-205 href=#__codelineno-33-205></a><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>require</span><span class=p>.</span><span class=nx>main</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=nx>module</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-206 name=__codelineno-33-206 href=#__codelineno-33-206></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>fs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>);</span>
<a id=__codelineno-33-207 name=__codelineno-33-207 href=#__codelineno-33-207></a>
<a id=__codelineno-33-208 name=__codelineno-33-208 href=#__codelineno-33-208></a><span class=w>  </span><span class=kd>function</span><span class=w> </span><span class=nx>assert</span><span class=p>(</span><span class=nx>condition</span><span class=p>,</span><span class=w> </span><span class=nx>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-33-209 name=__codelineno-33-209 href=#__codelineno-33-209></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>condition</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`â </span><span class=si>${</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span><span class=w> </span><span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mf>1</span><span class=p>);</span><span class=w> </span><span class=p>}</span>
<a id=__codelineno-33-210 name=__codelineno-33-210 href=#__codelineno-33-210></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`â </span><span class=si>${</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
<a id=__codelineno-33-211 name=__codelineno-33-211 href=#__codelineno-33-211></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-33-212 name=__codelineno-33-212 href=#__codelineno-33-212></a>
<a id=__codelineno-33-213 name=__codelineno-33-213 href=#__codelineno-33-213></a><span class=w>  </span><span class=c1>// Setup</span>
<a id=__codelineno-33-214 name=__codelineno-33-214 href=#__codelineno-33-214></a><span class=w>  </span><span class=nx>fs</span><span class=p>.</span><span class=nx>mkdirSync</span><span class=p>(</span><span class=s1>&#39;./test-files/sub&#39;</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>recursive</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=p>});</span>
<a id=__codelineno-33-215 name=__codelineno-33-215 href=#__codelineno-33-215></a><span class=w>  </span><span class=nx>fs</span><span class=p>.</span><span class=nx>writeFileSync</span><span class=p>(</span><span class=s1>&#39;./test-files/main.md&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;# Main\n[Related](./related.md)\n[Another](./another.md)\n[External](https://example.com)&#39;</span><span class=p>);</span>
<a id=__codelineno-33-216 name=__codelineno-33-216 href=#__codelineno-33-216></a><span class=w>  </span><span class=nx>fs</span><span class=p>.</span><span class=nx>writeFileSync</span><span class=p>(</span><span class=s1>&#39;./test-files/related.md&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;# Related\n[Sub](./sub/subdoc.md)&#39;</span><span class=p>);</span>
<a id=__codelineno-33-217 name=__codelineno-33-217 href=#__codelineno-33-217></a><span class=w>  </span><span class=nx>fs</span><span class=p>.</span><span class=nx>writeFileSync</span><span class=p>(</span><span class=s1>&#39;./test-files/another.md&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;# Another&#39;</span><span class=p>);</span>
<a id=__codelineno-33-218 name=__codelineno-33-218 href=#__codelineno-33-218></a><span class=w>  </span><span class=nx>fs</span><span class=p>.</span><span class=nx>writeFileSync</span><span class=p>(</span><span class=s1>&#39;./test-files/sub/subdoc.md&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;# Sub\n[Main](../main.md)&#39;</span><span class=p>);</span>
<a id=__codelineno-33-219 name=__codelineno-33-219 href=#__codelineno-33-219></a>
<a id=__codelineno-33-220 name=__codelineno-33-220 href=#__codelineno-33-220></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;ð§ª Running tests\n&#39;</span><span class=p>);</span>
<a id=__codelineno-33-221 name=__codelineno-33-221 href=#__codelineno-33-221></a>
<a id=__codelineno-33-222 name=__codelineno-33-222 href=#__codelineno-33-222></a><span class=w>  </span><span class=c1>// Test 1: Basic reading</span>
<a id=__codelineno-33-223 name=__codelineno-33-223 href=#__codelineno-33-223></a><span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=nx>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>readMarkdown</span><span class=p>(</span><span class=s1>&#39;./test-files/main.md&#39;</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>followLinks</span><span class=o>:</span><span class=w> </span><span class=kc>false</span><span class=w> </span><span class=p>});</span>
<a id=__codelineno-33-224 name=__codelineno-33-224 href=#__codelineno-33-224></a><span class=w>  </span><span class=nx>assert</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>content</span><span class=o>?</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;# Main&#39;</span><span class=p>),</span><span class=w> </span><span class=s1>&#39;Basic file reading&#39;</span><span class=p>);</span>
<a id=__codelineno-33-225 name=__codelineno-33-225 href=#__codelineno-33-225></a>
<a id=__codelineno-33-226 name=__codelineno-33-226 href=#__codelineno-33-226></a><span class=w>  </span><span class=c1>// Test 2: Link following</span>
<a id=__codelineno-33-227 name=__codelineno-33-227 href=#__codelineno-33-227></a><span class=w>  </span><span class=nx>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>readMarkdown</span><span class=p>(</span><span class=s1>&#39;./test-files/main.md&#39;</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>maxDepth</span><span class=o>:</span><span class=w> </span><span class=mf>2</span><span class=w> </span><span class=p>});</span>
<a id=__codelineno-33-228 name=__codelineno-33-228 href=#__codelineno-33-228></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>linkedFiles</span><span class=p>[</span><span class=mf>0</span><span class=p>])</span>
<a id=__codelineno-33-229 name=__codelineno-33-229 href=#__codelineno-33-229></a><span class=w>  </span><span class=nx>assert</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>linkedFiles</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=mf>2</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Follows 2 links&#39;</span><span class=p>);</span><span class=w>  </span>
<a id=__codelineno-33-230 name=__codelineno-33-230 href=#__codelineno-33-230></a><span class=w>  </span><span class=nx>assert</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>linkedFiles</span><span class=p>[</span><span class=mf>0</span><span class=p>].</span><span class=nx>linkedFiles</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=mf>1</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Nested link following&#39;</span><span class=p>);</span>
<a id=__codelineno-33-231 name=__codelineno-33-231 href=#__codelineno-33-231></a>
<a id=__codelineno-33-232 name=__codelineno-33-232 href=#__codelineno-33-232></a><span class=w>  </span><span class=c1>// Test 3: Circular reference</span>
<a id=__codelineno-33-233 name=__codelineno-33-233 href=#__codelineno-33-233></a><span class=w>  </span><span class=nx>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>readMarkdown</span><span class=p>(</span><span class=s1>&#39;./test-files/main.md&#39;</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>maxDepth</span><span class=o>:</span><span class=w> </span><span class=mf>5</span><span class=w> </span><span class=p>});</span>
<a id=__codelineno-33-234 name=__codelineno-33-234 href=#__codelineno-33-234></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>circularRef</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>linkedFiles</span><span class=p>[</span><span class=mf>0</span><span class=p>].</span><span class=nx>linkedFiles</span><span class=p>[</span><span class=mf>0</span><span class=p>].</span><span class=nx>linkedFiles</span><span class=p>[</span><span class=mf>0</span><span class=p>];</span>
<a id=__codelineno-33-235 name=__codelineno-33-235 href=#__codelineno-33-235></a><span class=w>  </span><span class=nx>assert</span><span class=p>(</span><span class=nx>circularRef</span><span class=o>?</span><span class=p>.</span><span class=nx>error</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s1>&#39;Circular reference detected&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Circular reference detection&#39;</span><span class=p>);</span>
<a id=__codelineno-33-236 name=__codelineno-33-236 href=#__codelineno-33-236></a>
<a id=__codelineno-33-237 name=__codelineno-33-237 href=#__codelineno-33-237></a><span class=w>  </span><span class=c1>// Test 4: Depth limit</span>
<a id=__codelineno-33-238 name=__codelineno-33-238 href=#__codelineno-33-238></a><span class=w>  </span><span class=nx>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>readMarkdown</span><span class=p>(</span><span class=s1>&#39;./test-files/main.md&#39;</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>maxDepth</span><span class=o>:</span><span class=w> </span><span class=mf>1</span><span class=w> </span><span class=p>});</span>
<a id=__codelineno-33-239 name=__codelineno-33-239 href=#__codelineno-33-239></a><span class=w>  </span><span class=nx>assert</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>linkedFiles</span><span class=p>[</span><span class=mf>0</span><span class=p>].</span><span class=nx>linkedFiles</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=mf>0</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Depth limit respected&#39;</span><span class=p>);</span>
<a id=__codelineno-33-240 name=__codelineno-33-240 href=#__codelineno-33-240></a>
<a id=__codelineno-33-241 name=__codelineno-33-241 href=#__codelineno-33-241></a><span class=w>  </span><span class=c1>// Test 5: Non-existent file</span>
<a id=__codelineno-33-242 name=__codelineno-33-242 href=#__codelineno-33-242></a><span class=w>  </span><span class=nx>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>readMarkdown</span><span class=p>(</span><span class=s1>&#39;./test-files/missing.md&#39;</span><span class=p>);</span>
<a id=__codelineno-33-243 name=__codelineno-33-243 href=#__codelineno-33-243></a><span class=w>  </span><span class=nx>assert</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>error</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s1>&#39;File not found or could not be read&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Non-existent file handling&#39;</span><span class=p>);</span>
<a id=__codelineno-33-244 name=__codelineno-33-244 href=#__codelineno-33-244></a>
<a id=__codelineno-33-245 name=__codelineno-33-245 href=#__codelineno-33-245></a><span class=w>  </span><span class=c1>// Test 6: Combined output</span>
<a id=__codelineno-33-246 name=__codelineno-33-246 href=#__codelineno-33-246></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>combined</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>readMarkdownWithLinks</span><span class=p>(</span><span class=s1>&#39;./test-files/main.md&#39;</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>maxDepth</span><span class=o>:</span><span class=w> </span><span class=mf>1</span><span class=w> </span><span class=p>});</span>
<a id=__codelineno-33-247 name=__codelineno-33-247 href=#__codelineno-33-247></a><span class=w>  </span><span class=nx>assert</span><span class=p>(</span><span class=nx>combined</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;=== main.md ===&#39;</span><span class=p>),</span><span class=w> </span><span class=s1>&#39;Combined format includes headers&#39;</span><span class=p>);</span>
<a id=__codelineno-33-248 name=__codelineno-33-248 href=#__codelineno-33-248></a><span class=w>  </span><span class=nx>assert</span><span class=p>(</span><span class=nx>combined</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;  === related.md ===&#39;</span><span class=p>),</span><span class=w> </span><span class=s1>&#39;Nested files indented&#39;</span><span class=p>);</span>
<a id=__codelineno-33-249 name=__codelineno-33-249 href=#__codelineno-33-249></a>
<a id=__codelineno-33-250 name=__codelineno-33-250 href=#__codelineno-33-250></a><span class=w>  </span><span class=c1>// Test 7: Path traversal blocked</span>
<a id=__codelineno-33-251 name=__codelineno-33-251 href=#__codelineno-33-251></a><span class=w>  </span><span class=nx>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>readMarkdown</span><span class=p>(</span><span class=s1>&#39;../../../etc/passwd&#39;</span><span class=p>);</span>
<a id=__codelineno-33-252 name=__codelineno-33-252 href=#__codelineno-33-252></a><span class=w>  </span><span class=nx>assert</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>content</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Path traversal blocked&#39;</span><span class=p>);</span>
<a id=__codelineno-33-253 name=__codelineno-33-253 href=#__codelineno-33-253></a><span class=w>  </span><span class=nx>assert</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>error</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s1>&#39;File not found or could not be read&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Path traversal returns error&#39;</span><span class=p>);</span>
<a id=__codelineno-33-254 name=__codelineno-33-254 href=#__codelineno-33-254></a>
<a id=__codelineno-33-255 name=__codelineno-33-255 href=#__codelineno-33-255></a><span class=w>  </span><span class=c1>// Test 8: Absolute path blocked</span>
<a id=__codelineno-33-256 name=__codelineno-33-256 href=#__codelineno-33-256></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>content1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>readFile</span><span class=p>(</span><span class=s1>&#39;/etc/passwd&#39;</span><span class=p>);</span>
<a id=__codelineno-33-257 name=__codelineno-33-257 href=#__codelineno-33-257></a><span class=w>  </span><span class=nx>assert</span><span class=p>(</span><span class=nx>content1</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Absolute Unix path blocked&#39;</span><span class=p>);</span>
<a id=__codelineno-33-258 name=__codelineno-33-258 href=#__codelineno-33-258></a>
<a id=__codelineno-33-259 name=__codelineno-33-259 href=#__codelineno-33-259></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>content2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>readFile</span><span class=p>(</span><span class=s1>&#39;C:\\Windows\\System32\\config&#39;</span><span class=p>);</span>
<a id=__codelineno-33-260 name=__codelineno-33-260 href=#__codelineno-33-260></a><span class=w>  </span><span class=nx>assert</span><span class=p>(</span><span class=nx>content2</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Absolute Windows path blocked&#39;</span><span class=p>);</span>
<a id=__codelineno-33-261 name=__codelineno-33-261 href=#__codelineno-33-261></a>
<a id=__codelineno-33-262 name=__codelineno-33-262 href=#__codelineno-33-262></a><span class=w>  </span><span class=c1>// Test 9: Empty file handling</span>
<a id=__codelineno-33-263 name=__codelineno-33-263 href=#__codelineno-33-263></a><span class=w>  </span><span class=nx>fs</span><span class=p>.</span><span class=nx>writeFileSync</span><span class=p>(</span><span class=s1>&#39;./test-files/empty.md&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>);</span>
<a id=__codelineno-33-264 name=__codelineno-33-264 href=#__codelineno-33-264></a><span class=w>  </span><span class=nx>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>readMarkdown</span><span class=p>(</span><span class=s1>&#39;./test-files/empty.md&#39;</span><span class=p>);</span>
<a id=__codelineno-33-265 name=__codelineno-33-265 href=#__codelineno-33-265></a><span class=w>  </span><span class=nx>assert</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>content</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Empty file handled&#39;</span><span class=p>);</span>
<a id=__codelineno-33-266 name=__codelineno-33-266 href=#__codelineno-33-266></a><span class=w>  </span><span class=nx>assert</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>linkedFiles</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=mf>0</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Empty file has no links&#39;</span><span class=p>);</span>
<a id=__codelineno-33-267 name=__codelineno-33-267 href=#__codelineno-33-267></a>
<a id=__codelineno-33-268 name=__codelineno-33-268 href=#__codelineno-33-268></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;\nð All tests passed!&#39;</span><span class=p>);</span>
<a id=__codelineno-33-269 name=__codelineno-33-269 href=#__codelineno-33-269></a><span class=w>  </span><span class=nx>fs</span><span class=p>.</span><span class=nx>rmSync</span><span class=p>(</span><span class=s1>&#39;./test-files&#39;</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>recursive</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=p>});</span>
<a id=__codelineno-33-270 name=__codelineno-33-270 href=#__codelineno-33-270></a><span class=p>}</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <details class=example> <summary>gitStream CM Example: readMarkdownWithLinks</summary> <p><div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=c1># -*- mode: yaml -*-</span>
<a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=c1># Example gitStream configuration using readMarkdownWithLinks for LinearB AI code reviews</span>
<a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=c1># This shows how to enhance AI code reviews with comprehensive documentation context</span>
<a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a>
<a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a><span class=nt>manifest</span><span class=p>:</span>
<a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a>
<a id=__codelineno-34-8 name=__codelineno-34-8 href=#__codelineno-34-8></a><span class=nt>automations</span><span class=p>:</span>
<a id=__codelineno-34-9 name=__codelineno-34-9 href=#__codelineno-34-9></a><span class=w>  </span><span class=c1># Enhanced AI code review with comprehensive documentation context</span>
<a id=__codelineno-34-10 name=__codelineno-34-10 href=#__codelineno-34-10></a><span class=w>  </span><span class=nt>ai_review_with_full_docs</span><span class=p>:</span>
<a id=__codelineno-34-11 name=__codelineno-34-11 href=#__codelineno-34-11></a><span class=w>    </span><span class=nt>if</span><span class=p>:</span>
<a id=__codelineno-34-12 name=__codelineno-34-12 href=#__codelineno-34-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=k>not</span> <span class=nv>pr.draft</span> <span class=cp>}}</span>
<a id=__codelineno-34-13 name=__codelineno-34-13 href=#__codelineno-34-13></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=nv>pr.files</span> <span class=o>|</span> <span class=nf>match</span><span class=o>(</span><span class=nv>regex</span><span class=o>=</span><span class=nv>r</span><span class=s2>&quot;.*\.(js|ts|py|go|java|cpp|cs)&quot;</span><span class=o>)</span> <span class=o>|</span> <span class=nf>some</span> <span class=cp>}}</span>
<a id=__codelineno-34-14 name=__codelineno-34-14 href=#__codelineno-34-14></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span>
<a id=__codelineno-34-15 name=__codelineno-34-15 href=#__codelineno-34-15></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">code-review@v1</span>
<a id=__codelineno-34-16 name=__codelineno-34-16 href=#__codelineno-34-16></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-34-17 name=__codelineno-34-17 href=#__codelineno-34-17></a><span class=w>          </span><span class=nt>guidelines</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<a id=__codelineno-34-18 name=__codelineno-34-18 href=#__codelineno-34-18></a><span class=w>            </span><span class=no>Code Review Guidelines:</span>
<a id=__codelineno-34-19 name=__codelineno-34-19 href=#__codelineno-34-19></a><span class=w>            </span><span class=cp>{{</span> <span class=s2>&quot;REVIEW_RULES.md&quot;</span> <span class=o>|</span> <span class=nf>readMarkdownWithLinks</span> <span class=o>|</span> <span class=nf>dump</span> <span class=cp>}}</span>
<a id=__codelineno-34-20 name=__codelineno-34-20 href=#__codelineno-34-20></a>
<a id=__codelineno-34-21 name=__codelineno-34-21 href=#__codelineno-34-21></a><span class=w>            </span><span class=no>Project Documentation Context:</span>
<a id=__codelineno-34-22 name=__codelineno-34-22 href=#__codelineno-34-22></a><span class=w>            </span><span class=cp>{{</span> <span class=s2>&quot;README.md&quot;</span> <span class=o>|</span> <span class=nf>readMarkdownWithLinks</span><span class=o>(</span><span class=nv>maxDepth</span><span class=o>=</span><span class=m>2</span><span class=o>)</span> <span class=o>|</span> <span class=nf>dump</span> <span class=cp>}}</span>
<a id=__codelineno-34-23 name=__codelineno-34-23 href=#__codelineno-34-23></a>
<a id=__codelineno-34-24 name=__codelineno-34-24 href=#__codelineno-34-24></a><span class=w>            </span><span class=no>Architecture and Design:</span>
<a id=__codelineno-34-25 name=__codelineno-34-25 href=#__codelineno-34-25></a><span class=w>            </span><span class=cp>{{</span> <span class=s2>&quot;docs/ARCHITECTURE.md&quot;</span> <span class=o>|</span> <span class=nf>readMarkdownWithLinks</span><span class=o>(</span><span class=nv>maxDepth</span><span class=o>=</span><span class=m>1</span><span class=o>)</span> <span class=o>|</span> <span class=nf>dump</span> <span class=cp>}}</span>
<a id=__codelineno-34-26 name=__codelineno-34-26 href=#__codelineno-34-26></a>
<a id=__codelineno-34-27 name=__codelineno-34-27 href=#__codelineno-34-27></a><span class=w>  </span><span class=c1># Context-aware reviews based on changed file areas</span>
<a id=__codelineno-34-28 name=__codelineno-34-28 href=#__codelineno-34-28></a><span class=w>  </span><span class=nt>contextual_ai_review</span><span class=p>:</span>
<a id=__codelineno-34-29 name=__codelineno-34-29 href=#__codelineno-34-29></a><span class=w>    </span><span class=nt>if</span><span class=p>:</span>
<a id=__codelineno-34-30 name=__codelineno-34-30 href=#__codelineno-34-30></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=k>not</span> <span class=nv>pr.draft</span> <span class=cp>}}</span>
<a id=__codelineno-34-31 name=__codelineno-34-31 href=#__codelineno-34-31></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span>
<a id=__codelineno-34-32 name=__codelineno-34-32 href=#__codelineno-34-32></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">code-review@v1</span>
<a id=__codelineno-34-33 name=__codelineno-34-33 href=#__codelineno-34-33></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-34-34 name=__codelineno-34-34 href=#__codelineno-34-34></a><span class=w>          </span><span class=nt>guidelines</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<a id=__codelineno-34-35 name=__codelineno-34-35 href=#__codelineno-34-35></a><span class=w>            </span><span class=no>Base Review Guidelines:</span>
<a id=__codelineno-34-36 name=__codelineno-34-36 href=#__codelineno-34-36></a><span class=w>            </span><span class=cp>{{</span> <span class=s2>&quot;REVIEW_RULES.md&quot;</span> <span class=o>|</span> <span class=nf>readMarkdownWithLinks</span> <span class=o>|</span> <span class=nf>dump</span> <span class=cp>}}</span>
<a id=__codelineno-34-37 name=__codelineno-34-37 href=#__codelineno-34-37></a>
<a id=__codelineno-34-38 name=__codelineno-34-38 href=#__codelineno-34-38></a><span class=w>            </span><span class=cp>{%</span> <span class=k>if</span> <span class=nv>pr.files</span> <span class=o>|</span> <span class=nf>match</span><span class=o>(</span><span class=nv>regex</span><span class=o>=</span><span class=nv>r</span><span class=s2>&quot;src/api/.*&quot;</span><span class=o>)</span> <span class=o>|</span> <span class=nf>some</span> <span class=cp>%}</span>
<a id=__codelineno-34-39 name=__codelineno-34-39 href=#__codelineno-34-39></a><span class=w>            </span><span class=no>API-Specific Guidelines and Documentation:</span>
<a id=__codelineno-34-40 name=__codelineno-34-40 href=#__codelineno-34-40></a><span class=w>            </span><span class=cp>{{</span> <span class=s2>&quot;docs/api/README.md&quot;</span> <span class=o>|</span> <span class=nf>readMarkdownWithLinks</span> <span class=o>|</span> <span class=nf>dump</span> <span class=cp>}}</span>
<a id=__codelineno-34-41 name=__codelineno-34-41 href=#__codelineno-34-41></a><span class=w>            </span><span class=cp>{%</span> <span class=k>endif</span> <span class=cp>%}</span>
<a id=__codelineno-34-42 name=__codelineno-34-42 href=#__codelineno-34-42></a>
<a id=__codelineno-34-43 name=__codelineno-34-43 href=#__codelineno-34-43></a><span class=w>            </span><span class=cp>{%</span> <span class=k>if</span> <span class=nv>pr.files</span> <span class=o>|</span> <span class=nf>match</span><span class=o>(</span><span class=nv>regex</span><span class=o>=</span><span class=nv>r</span><span class=s2>&quot;.*test.*&quot;</span><span class=o>)</span> <span class=o>|</span> <span class=nf>some</span> <span class=cp>%}</span>
<a id=__codelineno-34-44 name=__codelineno-34-44 href=#__codelineno-34-44></a><span class=w>            </span><span class=no>Testing Standards and Guidelines:</span>
<a id=__codelineno-34-45 name=__codelineno-34-45 href=#__codelineno-34-45></a><span class=w>            </span><span class=cp>{{</span> <span class=s2>&quot;docs/testing/README.md&quot;</span> <span class=o>|</span> <span class=nf>readMarkdownWithLinks</span> <span class=o>|</span> <span class=nf>dump</span> <span class=cp>}}</span>
<a id=__codelineno-34-46 name=__codelineno-34-46 href=#__codelineno-34-46></a><span class=w>            </span><span class=cp>{%</span> <span class=k>endif</span> <span class=cp>%}</span>
<a id=__codelineno-34-47 name=__codelineno-34-47 href=#__codelineno-34-47></a>
<a id=__codelineno-34-48 name=__codelineno-34-48 href=#__codelineno-34-48></a><span class=w>            </span><span class=cp>{%</span> <span class=k>if</span> <span class=nv>pr.files</span> <span class=o>|</span> <span class=nf>match</span><span class=o>(</span><span class=nv>regex</span><span class=o>=</span><span class=nv>r</span><span class=s2>&quot;.*security.*&quot;</span><span class=o>)</span> <span class=o>|</span> <span class=nf>some</span> <span class=cp>%}</span>
<a id=__codelineno-34-49 name=__codelineno-34-49 href=#__codelineno-34-49></a><span class=w>            </span><span class=no>Security Guidelines:</span>
<a id=__codelineno-34-50 name=__codelineno-34-50 href=#__codelineno-34-50></a><span class=w>            </span><span class=cp>{{</span> <span class=s2>&quot;docs/security/GUIDELINES.md&quot;</span> <span class=o>|</span> <span class=nf>readMarkdownWithLinks</span> <span class=o>|</span> <span class=nf>dump</span> <span class=cp>}}</span>
<a id=__codelineno-34-51 name=__codelineno-34-51 href=#__codelineno-34-51></a><span class=w>            </span><span class=cp>{%</span> <span class=k>endif</span> <span class=cp>%}</span>
<a id=__codelineno-34-52 name=__codelineno-34-52 href=#__codelineno-34-52></a>
<a id=__codelineno-34-53 name=__codelineno-34-53 href=#__codelineno-34-53></a><span class=w>  </span><span class=c1># Large PR reviews with extensive context</span>
<a id=__codelineno-34-54 name=__codelineno-34-54 href=#__codelineno-34-54></a><span class=w>  </span><span class=nt>comprehensive_review_large_prs</span><span class=p>:</span>
<a id=__codelineno-34-55 name=__codelineno-34-55 href=#__codelineno-34-55></a><span class=w>    </span><span class=nt>if</span><span class=p>:</span>
<a id=__codelineno-34-56 name=__codelineno-34-56 href=#__codelineno-34-56></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=k>not</span> <span class=nv>pr.draft</span> <span class=cp>}}</span>
<a id=__codelineno-34-57 name=__codelineno-34-57 href=#__codelineno-34-57></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=cp>{{</span> <span class=nv>pr.files</span> <span class=o>|</span> <span class=nf>length</span> <span class=o>&gt;</span> <span class=m>10</span> <span class=cp>}}</span><span class=w>  </span><span class=c1># Large changes</span>
<a id=__codelineno-34-58 name=__codelineno-34-58 href=#__codelineno-34-58></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span>
<a id=__codelineno-34-59 name=__codelineno-34-59 href=#__codelineno-34-59></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">code-review@v1</span>
<a id=__codelineno-34-60 name=__codelineno-34-60 href=#__codelineno-34-60></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-34-61 name=__codelineno-34-61 href=#__codelineno-34-61></a><span class=w>          </span><span class=nt>guidelines</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<a id=__codelineno-34-62 name=__codelineno-34-62 href=#__codelineno-34-62></a><span class=w>            </span><span class=no>Comprehensive Review Guidelines for Large Changes:</span>
<a id=__codelineno-34-63 name=__codelineno-34-63 href=#__codelineno-34-63></a><span class=w>            </span><span class=cp>{{</span> <span class=s2>&quot;REVIEW_RULES.md&quot;</span> <span class=o>|</span> <span class=nf>readMarkdownWithLinks</span> <span class=o>|</span> <span class=nf>dump</span> <span class=cp>}}</span>
<a id=__codelineno-34-64 name=__codelineno-34-64 href=#__codelineno-34-64></a>
<a id=__codelineno-34-65 name=__codelineno-34-65 href=#__codelineno-34-65></a><span class=w>            </span><span class=no>Full Project Context:</span>
<a id=__codelineno-34-66 name=__codelineno-34-66 href=#__codelineno-34-66></a><span class=w>            </span><span class=cp>{{</span> <span class=s2>&quot;README.md&quot;</span> <span class=o>|</span> <span class=nf>readMarkdownWithLinks</span><span class=o>(</span><span class=nv>maxDepth</span><span class=o>=</span><span class=m>1</span><span class=o>)</span> <span class=o>|</span> <span class=nf>dump</span> <span class=cp>}}</span>
<a id=__codelineno-34-67 name=__codelineno-34-67 href=#__codelineno-34-67></a>
<a id=__codelineno-34-68 name=__codelineno-34-68 href=#__codelineno-34-68></a><span class=w>            </span><span class=no>Contributing Guidelines:</span>
<a id=__codelineno-34-69 name=__codelineno-34-69 href=#__codelineno-34-69></a><span class=w>            </span><span class=cp>{{</span> <span class=s2>&quot;CONTRIBUTING.md&quot;</span> <span class=o>|</span> <span class=nf>readMarkdownWithLinks</span> <span class=o>|</span> <span class=nf>dump</span> <span class=cp>}}</span>
<a id=__codelineno-34-70 name=__codelineno-34-70 href=#__codelineno-34-70></a>
<a id=__codelineno-34-71 name=__codelineno-34-71 href=#__codelineno-34-71></a><span class=w>            </span><span class=no>Architecture Documentation:</span>
<a id=__codelineno-34-72 name=__codelineno-34-72 href=#__codelineno-34-72></a><span class=w>            </span><span class=cp>{{</span> <span class=s2>&quot;docs/ARCHITECTURE.md&quot;</span> <span class=o>|</span> <span class=nf>readMarkdownWithLinks</span><span class=o>(</span><span class=nv>maxDepth</span><span class=o>=</span><span class=m>2</span><span class=o>)</span> <span class=o>|</span> <span class=nf>dump</span> <span class=cp>}}</span>
</code></pre></div> <div class=result markdown> <span> </span> </div></p> </details> <p><a href=https://github.com/linear-b/gitstream/tree/main/plugins/filters/readMarkdownWithLinks>Download Source Code</a></p> <hr> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 LinearB, Inc. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/linear-b/gitstream/ target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["header.autohide", "content.code.copy", "content.code.annotate", "content.action.edit"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.ce72ebac.min.js></script> </body> </html>