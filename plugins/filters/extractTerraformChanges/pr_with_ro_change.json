[
  {
    "original_file": "production/t1.hcl",
    "new_file": "production/t1.hcl",
    "diff": "@@ -56,7 +56,7 @@ inputs = {\n     },\n     {\n       user        = \"user_beta\"\n-      default_ttl = 60 * 60 * 6\n+      default_ttl = 60 * 60 * 7\n       max_ttl     = 60 * 60 * 24 * 7\n       type        = \"temporary\"\n       expires     = \"2025-12-31\"\n@@ -84,14 +84,13 @@ inputs = {\n     },\n     {\n       user        = \"user_delta\"\n-      default_ttl = 60 * 60 * 8\n+      default_ttl = 60 * 60 * 6\n       max_ttl     = 60 * 60 * 24 * 10\n       type        = \"temporary\"\n       expires     = \"2026-01-01\"\n       access = [\n         {\n           tables     = [\"logs\", \"events\"]\n-          schema     = \"monitoring\"\n           privileges = \"ro\"\n         }\n       ]\n",
    "original_content": "include \"root\" {\n  path = find_in_parent_folders(\"root.hcl\")\n}\n\ninclude \"dependencies\" {\n  path = find_in_parent_folders(\"dependencies.hcl\")\n}\n\nlocals {\n  service = read_terragrunt_config(find_in_parent_folders(\"service.hcl\")).locals\n}\n\nterraform {\n  source = \"${get_repo_root()}/modules/vault-database\"\n}\n\ndependency \"rds\" {\n  config_path = \"../rds\"\n  mock_outputs = {\n    engine  = \"mariadb\"\n    address = \"dummy-endpoint.rds.amazonaws.com\"\n  }\n  mock_outputs_allowed_terraform_commands = [\"validate\", \"fmt\", \"init\", \"plan\", \"providers\", \"show\", \"refresh\"]\n}\n\ninputs = {\n  domain_name      = local.service.account.vault_domain_name\n  env              = local.service.account.env\n  azuread_oidc     = dependency.vault_azuread.outputs.accessor\n  timestamp        = timestamp()\n  rotate_on_create = true\n\n  db = {\n    username      = \"vault\"\n    password      = \"vault\"\n    name          = local.service.name\n    endpoint      = dependency.rds.outputs.address\n    engine        = dependency.rds.outputs.engine\n    database_name = local.service.name\n  }\n\n  jits = [\n    {\n      user        = \"user_alpha\"\n      default_ttl = 60 * 60 * 24\n      max_ttl     = 60 * 60 * 24 * 30\n      type        = \"temporary\"\n      expires     = \"2026-04-01\"\n      access = [\n        {\n          tables     = [\"*\"]\n          schema     = \"schema_one\"\n          privileges = \"rw\"\n        }\n      ]\n    },\n    {\n      user        = \"user_beta\"\n      default_ttl = 60 * 60 * 6\n      max_ttl     = 60 * 60 * 24 * 7\n      type        = \"temporary\"\n      expires     = \"2025-12-31\"\n      access = [\n        {\n          tables     = [\"orders\", \"transactions\"]\n          schema     = \"sales\"\n          privileges = \"ro\"\n        }\n      ]\n    },\n    {\n      user        = \"user_gamma\"\n      default_ttl = 60 * 60 * 12\n      max_ttl     = 60 * 60 * 24 * 14\n      type        = \"temporary\"\n      expires     = \"2025-10-15\"\n      access = [\n        {\n          tables     = [\"*\"]\n          schema     = \"analytics\"\n          privileges = \"rw\"\n        }\n      ]\n    },\n    {\n      user        = \"user_delta\"\n      default_ttl = 60 * 60 * 8\n      max_ttl     = 60 * 60 * 24 * 10\n      type        = \"temporary\"\n      expires     = \"2026-01-01\"\n      access = [\n        {\n          tables     = [\"logs\", \"events\"]\n          schema     = \"monitoring\"\n          privileges = \"ro\"\n        }\n      ]\n    }\n  ]\n}\n",
    "new_content": "include \"root\" {\n  path = find_in_parent_folders(\"root.hcl\")\n}\n\ninclude \"dependencies\" {\n  path = find_in_parent_folders(\"dependencies.hcl\")\n}\n\nlocals {\n  service = read_terragrunt_config(find_in_parent_folders(\"service.hcl\")).locals\n}\n\nterraform {\n  source = \"${get_repo_root()}/modules/vault-database\"\n}\n\ndependency \"rds\" {\n  config_path = \"../rds\"\n  mock_outputs = {\n    engine  = \"mariadb\"\n    address = \"dummy-endpoint.rds.amazonaws.com\"\n  }\n  mock_outputs_allowed_terraform_commands = [\"validate\", \"fmt\", \"init\", \"plan\", \"providers\", \"show\", \"refresh\"]\n}\n\ninputs = {\n  domain_name      = local.service.account.vault_domain_name\n  env              = local.service.account.env\n  azuread_oidc     = dependency.vault_azuread.outputs.accessor\n  timestamp        = timestamp()\n  rotate_on_create = true\n\n  db = {\n    username      = \"vault\"\n    password      = \"vault\"\n    name          = local.service.name\n    endpoint      = dependency.rds.outputs.address\n    engine        = dependency.rds.outputs.engine\n    database_name = local.service.name\n  }\n\n  jits = [\n    {\n      user        = \"user_alpha\"\n      default_ttl = 60 * 60 * 24\n      max_ttl     = 60 * 60 * 24 * 30\n      type        = \"temporary\"\n      expires     = \"2026-04-01\"\n      access = [\n        {\n          tables     = [\"*\"]\n          schema     = \"schema_one\"\n          privileges = \"rw\"\n        }\n      ]\n    },\n    {\n      user        = \"user_beta\"\n      default_ttl = 60 * 60 * 7\n      max_ttl     = 60 * 60 * 24 * 7\n      type        = \"temporary\"\n      expires     = \"2025-12-31\"\n      access = [\n        {\n          tables     = [\"orders\", \"transactions\"]\n          schema     = \"sales\"\n          privileges = \"ro\"\n        }\n      ]\n    },\n    {\n      user        = \"user_gamma\"\n      default_ttl = 60 * 60 * 12\n      max_ttl     = 60 * 60 * 24 * 14\n      type        = \"temporary\"\n      expires     = \"2025-10-15\"\n      access = [\n        {\n          tables     = [\"*\"]\n          schema     = \"analytics\"\n          privileges = \"rw\"\n        }\n      ]\n    },\n    {\n      user        = \"user_delta\"\n      default_ttl = 60 * 60 * 6\n      max_ttl     = 60 * 60 * 24 * 10\n      type        = \"temporary\"\n      expires     = \"2026-01-01\"\n      access = [\n        {\n          tables     = [\"logs\", \"events\"]\n          privileges = \"ro\"\n        }\n      ]\n    }\n  ]\n}\n"
  }
]
